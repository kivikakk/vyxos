<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>kivikakk.ee</title>
 <link href="/atom.xml" rel="self"/>
 <link href="https://kivikakk.ee/"/>
 <updated>2025-02-20T23:12:38+11:00</updated>
 <id>https://kivikakk.ee</id>
 <author>
   <name>Asherah Connor</name>
   <email>ashe@kivikakk.ee</email>
 </author>

 
 <entry>
   <title>Cad√™ nossas mittens?</title>
   <updated>2025-02-20T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2025/02/20/cade-nossas-mittens</id>
    
     <link href="https://kivikakk.ee/2025/02/20/cade-nossas-mittens/"/>
     <content type="html">&lt;p&gt;I keep trying really hard to improve my situation, but reality proves a harsh
mistress. The other day my wife said ‚Äúit feels like our circle is getting
smaller‚Äù, and that‚Äôs something of a vibe.&lt;/p&gt;

&lt;p&gt;Health issues steadily worsen. Last month I was meant to try triggering the
arrhythmia with a Holter monitor, but my sleep started failing so much that I
couldn‚Äôt have put in the exertion required even if I wanted to. Around the same
time, my usual nightly cannabis started reliably provoking palpitations, so I
stopped it.&lt;/p&gt;

&lt;p&gt;Since then my ability to sleep has completely left the building. Coming off
nifedipine helped a little bit with inititation ‚Äî without cannabis, falling
asleep was impossible because of how much it fucked with my blood pressure/head
‚Äî but maintenance is still impossible. Duloxetine wakes me up every hour or
two in sweat without fail.  Pain levels have steadily grown.&lt;/p&gt;

&lt;p&gt;I started lactating last month (!), which was cool, though I‚Äôve also had a night
each month of really bad cramping since then too. Completely immobile from 8pm
to 4am last night, but without even the slightest chance of falling asleep or
dozing through parts of it; best I could do was rotate on the bed to try to
shift the sensation. Now it‚Äôs 10pm and I‚Äôve woken from a five hour ‚Äònap‚Äô and
ugh.&lt;/p&gt;

&lt;p&gt;Dissociative symptoms have grown &lt;em&gt;much&lt;/em&gt; worse since stopping regular cannabis
use, which was unexpected. I have a little note I add to when I notice psychosis
warning signs, which has been slowly growing, because I don‚Äôt know how else one
tracks this.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;‚Äúfeel like i‚Äôm a passenger in this body‚Äù&lt;/li&gt;
  &lt;li&gt;feelings of thought insertion from kin&lt;/li&gt;
  &lt;li&gt;‚Äúthis life simulation is starting to get real weird lately‚Äù (re: stuff on
kitchen counter/unreality of it)&lt;/li&gt;
  &lt;li&gt;‚ÄúI just can‚Äôt get a grasp on anything‚Äù&lt;/li&gt;
  &lt;li&gt;‚Äònegative‚Äô sx days esp. sleepless; anhedonia&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With continuous sleep deprivation being a trigger, it‚Äôs starting to get to a
point where I either fix that or fix this.&lt;/p&gt;

&lt;p&gt;It‚Äôs really unclear how I fix sleep. Coming off duloxetine without a replacement
is not an option, but another SNRI isn‚Äôt likely to be better (I remember night
sweats on desvenlafaxine), a plain SSRI isn‚Äôt likely to be good enough (last
time I was on escitalopram it wasn‚Äôt better than nothing), and while I don‚Äôt
have experience with other classes to know, it seems likely TCAs will share
this property. That said, they‚Äôd be new to me and therefore worth a shot.&lt;/p&gt;

&lt;p&gt;I could also try to force the issue by forcing sleep itself; temazepam is pretty
much a definite no given its long-term viability, trazodone is a maybe, and
z-drugs are what I‚Äôd like to angle for since they seem to fit the bill best.&lt;/p&gt;

&lt;p&gt;‚Äúangle for‚Äù because getting a psychiatrist within six months of asking for
one is pretty much impossible, as measured by kin who still hasn‚Äôt managed to
succeed in even getting a referral accepted ‚Äî there isn‚Äôt any expert help
available, so, as usual, the best I can do is make my case to my GP, who is
helpful, resourceful, and has always done what she can.&lt;/p&gt;

&lt;p&gt;Fixing psychosis-adjacent issues is the other option. I‚Äôd probably be willing
to try quetiapine again, despite my last experience. Brexpiprazole might be
OK again too (also &lt;a href=&quot;https://doi.org/10.1192/bjp.2021.159&quot;&gt;lol&lt;/a&gt; (also ‚Äúour
percentage of participants who identified as non-female (i.e. as male or
neither male nor female) was slightly larger (37%) than those in other studies
(approximately 25%)‚Äù, both figures incredible, BPD enbies represent!)). I list
only these two I‚Äôve had experience with as, again, it‚Äôs on me to make the case
for prescribing. Streamlined authority 4246 schizophrenia, woo.&lt;/p&gt;

&lt;p&gt;Seeing the doctor tomorrow (after a bit more than a 3 week wait, but hey at
least it‚Äôs not months), so we‚Äôll see.&lt;/p&gt;

&lt;p&gt;In other news, my last psychologist appointment went awfully ‚Äî after eight
years with him, it‚Äôs probably time to call it quits. Surprised the hell out
of me by spending our entire hour on his fears and prejudices. I just kind of
dissociatively fawned through the whole thing and spent the next few hours in
shock until I slowly realised what had happened.&lt;/p&gt;

&lt;p&gt;To be clear, eight years before hitting a wall you really need help scaling is
a very good run, but this particular wall I‚Äôve come up against repeatedly in the
last ~year and a half, this time most assuredly and directly, so.&lt;/p&gt;

&lt;p&gt;Still really enjoying Spanish and Portuguese. Daily meditation has been a bit
of an oasis. Home-cooked meals have suffered greatly as my sleep has. Char
decided to call it quits on Ava; once the editor (and its helper editor tool)
was ‚Äòdone‚Äô, she started back on some language features, but the more we did, the
more we realised we don‚Äôt particularly actually &lt;em&gt;want&lt;/em&gt; to write this language
as a ‚Äúfun thing to do‚Äù, and so the impetus for implementing all its gory details
went out the window. We‚Äôve been doing a bunch of CAD lately, though, since we
got a 3D printer, and that has been fun :) Likewise riding again with our kin.&lt;/p&gt;

&lt;p&gt;Finding the good where we can. Boa noite üß°&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Reincorporation</title>
   <updated>2025-01-26T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2025/01/26/reincorporation</id>
    
     <link href="https://kivikakk.ee/2025/01/26/reincorporation/"/>
     <content type="html">&lt;p&gt;I‚Äôm reincorporating posts made by a variety of no-longer-public-facing selves,
long into the past. They‚Äôre reposted on this blog under their original dates,
with an index in this post. Sorry in advance if these flood your RSS reader!&lt;/p&gt;

&lt;p&gt;May they help someone along their way.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;alex&quot;&gt;alex&lt;/h2&gt;

&lt;p&gt;Daily writing exercise for my then-Dom, shared privately with her.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2018-05-07: &lt;a href=&quot;/alex/2018/05/07/bullet-journal&quot;&gt;bullet journal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-08: &lt;a href=&quot;/alex/2018/05/08/laptop&quot;&gt;laptop&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-09: &lt;a href=&quot;/alex/2018/05/09/hypomania&quot;&gt;hypomania&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-10: &lt;a href=&quot;/alex/2018/05/10/bed&quot;&gt;bed&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-12: &lt;a href=&quot;/alex/2018/05/12/green-tea&quot;&gt;green tea&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-13: &lt;a href=&quot;/alex/2018/05/13/105-710&quot;&gt;105/710&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-14: &lt;a href=&quot;/alex/2018/05/14/prelude&quot;&gt;prelude&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-15: &lt;a href=&quot;/alex/2018/05/15/tired&quot;&gt;tired&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-16: &lt;a href=&quot;/alex/2018/05/16/train&quot;&gt;train&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-17: &lt;a href=&quot;/alex/2018/05/17/panic-disorder&quot;&gt;panic disorder&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-18: &lt;a href=&quot;/alex/2018/05/18/identity&quot;&gt;identity&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018-05-19: &lt;a href=&quot;/alex/2018/05/19/morgan&quot;&gt;morgan&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;xue&quot;&gt;xue&lt;/h2&gt;

&lt;p&gt;Exploring my identity, shared with select friends.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2019-12-09: &lt;a href=&quot;/xue/2019/12/09/knowing-is-too-late/&quot;&gt;knowing is too late&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2020-03-31: &lt;a href=&quot;/xue/2020/03/31/key/&quot;&gt;key&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2020-04-24: &lt;a href=&quot;/xue/2020/04/24/born-in-song/&quot;&gt;born in song&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2020-09-14: &lt;a href=&quot;/xue/2020/09/14/thorn/&quot;&gt;thorn&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2020-10-07: &lt;a href=&quot;/xue/2020/10/07/motherhood/&quot;&gt;motherhood&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2020-11-05: &lt;a href=&quot;/xue/2020/11/05/a-different-lens/&quot;&gt;a different lens&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-03-15: &lt;a href=&quot;/xue/2021/03/15/collared/&quot;&gt;collared&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-02: &lt;a href=&quot;/xue/2021/04/02/one-step-forward/&quot;&gt;one step forward&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-27: &lt;a href=&quot;/xue/2021/04/27/submission/&quot;&gt;submission&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;flashes&quot;&gt;flashes&lt;/h2&gt;

&lt;p&gt;Anonymous gemlog, stumbled upon by other users of &lt;a href=&quot;https://gemlog.blue&quot;&gt;gemlog.blue&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2021-03-25: &lt;a href=&quot;/flashes/2021/03/25/hostility&quot;&gt;hostility&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-03-29: &lt;a href=&quot;/flashes/2021/03/29/longing&quot;&gt;longing&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-03-31: &lt;a href=&quot;/flashes/2021/03/31/blocked&quot;&gt;blocked&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-03-31: &lt;a href=&quot;/flashes/2021/03/31/occlusion&quot;&gt;occlusion&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-03-31: &lt;a href=&quot;/flashes/2021/03/31/pull&quot;&gt;pull&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-04: &lt;a href=&quot;/flashes/2021/04/04/impinged&quot;&gt;impinged&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-06: &lt;a href=&quot;/flashes/2021/04/06/inscrutability&quot;&gt;inscrutability&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-19: &lt;a href=&quot;/flashes/2021/04/19/cycles&quot;&gt;cycles&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-21: &lt;a href=&quot;/flashes/2021/04/21/recapitulating&quot;&gt;recapitulating&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-23: &lt;a href=&quot;/flashes/2021/04/23/mouii&quot;&gt;mouii&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-27: &lt;a href=&quot;/flashes/2021/04/27/occlusion-ii&quot;&gt;occlusion II&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-27: &lt;a href=&quot;/flashes/2021/04/27/vacillation&quot;&gt;vacillation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-04-30: &lt;a href=&quot;/flashes/2021/04/30/summarised&quot;&gt;summarised&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-04: &lt;a href=&quot;/flashes/2021/05/04/kept&quot;&gt;kept&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-05: &lt;a href=&quot;/flashes/2021/05/05/kutuzyoku&quot;&gt;kutuzyoku&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-06: &lt;a href=&quot;/flashes/2021/05/06/siriai&quot;&gt;siriai&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-07: &lt;a href=&quot;/flashes/2021/05/07/p&quot;&gt;p&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-07: &lt;a href=&quot;/flashes/2021/05/07/zashchitnitsa&quot;&gt;zashchitnitsa&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-08: &lt;a href=&quot;/flashes/2021/05/08/excerpt&quot;&gt;excerpt&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-09: &lt;a href=&quot;/flashes/2021/05/09/title-i&quot;&gt;title I&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-10: &lt;a href=&quot;/flashes/2021/05/10/sequencer&quot;&gt;sequencer&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-11: &lt;a href=&quot;/flashes/2021/05/11/kekkyoku&quot;&gt;kekkyoku&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-11: &lt;a href=&quot;/flashes/2021/05/11/tumari&quot;&gt;tumari&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-12: &lt;a href=&quot;/flashes/2021/05/12/inscrutability-ii&quot;&gt;inscrutability II&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-18: &lt;a href=&quot;/flashes/2021/05/18/–æ—Ç—á—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å&quot;&gt;–æ—Ç—á—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-19: &lt;a href=&quot;/flashes/2021/05/19/iraira&quot;&gt;iraira&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-24: &lt;a href=&quot;/flashes/2021/05/24/various&quot;&gt;various&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-26: &lt;a href=&quot;/flashes/2021/05/26/„Åì„ÅÆ„Åæ„Åæ„Åò„ÇÉ&quot;&gt;„Åì„ÅÆ„Åæ„Åæ„Åò„ÇÉ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-27: &lt;a href=&quot;/flashes/2021/05/27/–≥—Ä—ë–∑–∞&quot;&gt;–≥—Ä—ë–∑–∞&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-05-31: &lt;a href=&quot;/flashes/2021/05/31/lustre&quot;&gt;lustre&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-04: &lt;a href=&quot;/flashes/2021/06/04/mikatralia&quot;&gt;mikatralia&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-05: &lt;a href=&quot;/flashes/2021/06/05/aside&quot;&gt;aside&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-05: &lt;a href=&quot;/flashes/2021/06/05/„Å§„ÅÑ„Åü&quot;&gt;„Å§„ÅÑ„Åü&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-08: &lt;a href=&quot;/flashes/2021/06/08/(un)monitored&quot;&gt;(un)monitored&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-08: &lt;a href=&quot;/flashes/2021/06/08/„Å§„ÅÑ„Åü„Å£„Å¶&quot;&gt;„Å§„ÅÑ„Åü„Å£„Å¶&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-09: &lt;a href=&quot;/flashes/2021/06/09/dasein-i&quot;&gt;dasein I&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-09: &lt;a href=&quot;/flashes/2021/06/09/dasein-ii&quot;&gt;dasein II&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-10: &lt;a href=&quot;/flashes/2021/06/10/dasein-iii&quot;&gt;dasein III&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-11: &lt;a href=&quot;/flashes/2021/06/11/–æ–±—ä–µ–∫—Ç&quot;&gt;–æ–±—ä–µ–∫—Ç&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-13: &lt;a href=&quot;/flashes/2021/06/13/–Ω—É–∂–Ω–æ&quot;&gt;–Ω—É–∂–Ω–æ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-15: &lt;a href=&quot;/flashes/2021/06/15/cartita&quot;&gt;cartita&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-15: &lt;a href=&quot;/flashes/2021/06/15/dasein-iv&quot;&gt;dasein IV&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-16: &lt;a href=&quot;/flashes/2021/06/16/ÂëΩ‰ª§&quot;&gt;ÂëΩ‰ª§&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-17: &lt;a href=&quot;/flashes/2021/06/17/—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ&quot;&gt;—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-18: &lt;a href=&quot;/flashes/2021/06/18/dasein-v&quot;&gt;dasein V&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-19: &lt;a href=&quot;/flashes/2021/06/19/flashes-end&quot;&gt;flashes: end&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;kwasticat&quot;&gt;kwasticat&lt;/h2&gt;

&lt;p&gt;Short-lived BDSM journal that mostly mirrored posts from ‚Äúflashes‚Äù after the
fact.  Resurrected from Wayback Machine; no idea how much I‚Äôve lost.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2021-06-22: &lt;a href=&quot;/kwasticat/2021/06/22/christening&quot;&gt;christening&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2021-06-23: &lt;a href=&quot;/kwasticat/2021/06/23/vision&quot;&gt;vision&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Nix humour</title>
   <updated>2025-01-04T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2025/01/04/nix-humour</id>
    
     <link href="https://kivikakk.ee/2025/01/04/nix-humour/"/>
     <content type="html">&lt;p&gt;Something about this really fucks.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/expected-scenario.png&quot; alt=&quot;Screenshot of an excerpt from a NixOS wiki page: &amp;quot;Tip - The above assumes
you have root access on the remote machine, that allows you to create such a
weakly priviledged user, or that you have good relationship with your system
administrator - which is the expected scenario if they have installed Nix
system-wide.&amp;quot;&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Fear</title>
   <updated>2025-01-03T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2025/01/03/fear</id>
    
     <link href="https://kivikakk.ee/2025/01/03/fear/"/>
     <content type="html">&lt;p&gt;content note: physical illness, death, suicide.&lt;/p&gt;

&lt;p&gt;one thing about spending enough time fearing death, for whatever reason and
reasons that may be, is that one end to it is not removing the originator of
that fear ‚Äî which depending on your psyche or conditions may not always be
possible ‚Äî but learning to not fear death instead.&lt;/p&gt;

&lt;p&gt;i basically think anyone who spends enough time in panic over enough years
is liable to end up this way. the alternatives are burning to a husk, loss of
reality checking, or suicide.&lt;/p&gt;

&lt;p&gt;personally still a bit afraid ‚Äî not so indifferent that i‚Äôd go hard for no
reason when exercising yesterday, for instance, i give my body what it asks
for (fluid movements, light effort, nothing anaerobic), but not so afraid that
i won‚Äôt do my best to purposefully trigger the new arrhythmia when doing the
holter monitor next week, despite risk inherent in inducing one.&lt;/p&gt;

&lt;p&gt;i find i keep having to say to myself, if this is all it would take to kill
me, then now or in two weeks accidentally say, it really makes no odds. that
i have to deploy this regularly to move forward with my days evinces a certain
something. and while the uncertainty itself is one degree of unbearable, a kind
of assertion that i cannot trust in my self-knowledge, the collective absence of
faith from others is another.&lt;/p&gt;

&lt;p&gt;if the condition finally gets worse after decades, if everyone‚Äôs been telling
you it‚Äôs false/‚ÄúJust Anxiety‚Äù/psychosomatic/‚Äúfunctional‚Äù (given decades of panic
disorder etc.), and now it‚Äôs enough to be visible, it‚Äôs a relief and starts to
feel your only ally ‚Äî the only true thing in all this time. i don‚Äôt know if it‚Äôs
true that the same death i feared and felt daily in my mid-teens until my early
20s &lt;em&gt;is&lt;/em&gt; this one, the one now manifesting so physically, or the one that stole
a few years away from me from 2016, but on reflection i‚Äôve spent most of the
last 22 years actively fearing and feeling death.&lt;/p&gt;

&lt;p&gt;an end to this uncertainty and the loneliness within it is not exactly an
unwelcome thing in and of itself. we were never promised even one day of the
beauty of life, y‚Äôknow? and i have experienced so much of it, awe-inspiring and
terrible and banal. nothing was ever ever promised.&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>2025</title>
   <updated>2025-01-02T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2025/01/02/2025</id>
    
     <link href="https://kivikakk.ee/2025/01/02/2025/"/>
     <content type="html">&lt;p&gt;Happy new year!&lt;/p&gt;

&lt;p&gt;I guess I‚Äôm taking a slightly more laid-back approach to goals this year.
&lt;a href=&quot;https://kivikakk.ee/2024/10/13/led/&quot;&gt;Health issues&lt;/a&gt; have unfortunately progressed; whatever pain relief I
was getting from the duloxetine (or otherwise), either that effect has worn
off or the pain levels have risen to break through.&lt;/p&gt;

&lt;p&gt;I‚Äôve also encountered a new arrhythmia, so ‚Äúsudden cardiac death‚Äù is back on the
menu of dread. Holter monitor next week where I‚Äôll try to reproduce that without
dying. Rheumatologist follow-up appointment where I expect to be diagnosed with
hEDS in ‚Ä¶ 12 weeks.  So it goes.&lt;/p&gt;

&lt;p&gt;Goals, then.&lt;/p&gt;

&lt;h3 id=&quot;keep-up-duolingo&quot;&gt;Keep up Duolingo.&lt;/h3&gt;

&lt;p&gt;866 days now; the streak isn‚Äôt the important thing, but it has been a really
good lesson in proving to myself I can stay consistent with things given
the right motivation. (In this case, being able to speak my partner‚Äôs native
language.)&lt;/p&gt;

&lt;p&gt;Duolingo isn‚Äôt for everyone, and the course quality varies wildly, but the
Spanish course for English speakers is incredible, and if you spend 15-20
minutes a day on it, and let it be your fallback activity when bored, you will
steadily but surely gain an extremely real facility with the language.&lt;/p&gt;

&lt;p&gt;(This much time is also enough to reliably sit around Obsidian/Diamond league,
and sometimes it can be a nice dopamine hit to make an effort to finish at #1.)&lt;/p&gt;

&lt;p&gt;I have the benefit of being around a native speaker all the time, but the first
year or so my level wasn‚Äôt anywhere near being able to use it casually without
it getting annoying for both of us. By now, we can switch in and out pretty
comfortably around the topics I‚Äôve covered lexicon for.&lt;/p&gt;

&lt;p&gt;I‚Äôve also added Portuguese on the side, spending roughly half my time each day
on each, and it works pretty well! I wouldn‚Äôt start two at once (especially
closely related languages like these; too confusing), but being a few years in
with one makes it an easy way to bootstrap another habit.  Portugu√™s √© estranho,
mas eu gosto :)  It‚Äôs a much shorter and less developed course than the Spanish
one, so I expect I‚Äôll finish it this year and start another in its stead.&lt;/p&gt;

&lt;h3 id=&quot;daily-meditation&quot;&gt;Daily meditation.&lt;/h3&gt;

&lt;p&gt;Planning to slot this in with my Duolingo practice.  I‚Äôve been an on-and-off
meditator for 20 years or so now.  I need the equanimity now more than ever.&lt;/p&gt;

&lt;h3 id=&quot;home-cooked-meals&quot;&gt;Home-cooked meals.&lt;/h3&gt;

&lt;p&gt;This has been a real struggle over the last year or two, with energy levels so
low (and no microwave in the Tallinn apartment!), but since moving into my new
place back in Melbourne it‚Äôs been a key focus.  Just need to keep it up.&lt;/p&gt;

&lt;h3 id=&quot;deliver-the-ava-mvp&quot;&gt;Deliver the Ava MVP.&lt;/h3&gt;

&lt;p&gt;Charlotte‚Äôs been working non-stop on &lt;a href=&quot;https://github.com/charlottia/ava&quot;&gt;Ava BASIC&lt;/a&gt; (&lt;a href=&quot;https://kivikakk.ee/zig/2024/08/06/t%C3%BC%C3%BCpiautomaat/&quot;&gt;previously&lt;/a&gt;) since
July, and hopefully we can get that into a complete MVP this year.&lt;/p&gt;

&lt;h3 id=&quot;secondary-project&quot;&gt;Secondary project.&lt;/h3&gt;

&lt;p&gt;Having an ‚Äúoff‚Äù project would be nice.  This is a vaguer goal, but I get the
feeling technical writing would be a good fit for us.&lt;/p&gt;

&lt;h3 id=&quot;keep-learning&quot;&gt;Keep learning.&lt;/h3&gt;

&lt;p&gt;So far I have an unsorted list of things I‚Äôd like to learn or improve at:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Formal methods in digital design. We‚Äôve played around with this a bit (e.g. with
&lt;a href=&quot;https://github.com/robertbaruch/amaranth-exercises&quot;&gt;Robert Baruch‚Äôs Amaranth exercises&lt;/a&gt;; solving Sudoku with
HDL and formal was a cool and unexpected twist), but not enough to usefully use it
in actual designs.&lt;/li&gt;
  &lt;li&gt;Likewise, something like &lt;a href=&quot;https://lean-lang.org/&quot;&gt;Lean&lt;/a&gt; and perhaps &lt;a href=&quot;https://github.com/informalsystems/quint&quot;&gt;Quint&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Stenography with &lt;a href=&quot;http://www.openstenoproject.org/&quot;&gt;Open Steno&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Training on the Africa Twin; I‚Äôve been rebuilding confidence since a fall
after a tyre replacement early last year, but I‚Äôd like some controlled
conditions to push the envelope a bit.&lt;/li&gt;
&lt;/ul&gt;

</content>
    
 </entry>
 
 <entry>
   <title>StaleObjectStateException</title>
   <updated>2024-12-30T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/12/30/StaleObjectStateException</id>
    
     <link href="https://kivikakk.ee/2024/12/30/StaleObjectStateException/"/>
     <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/post-img/StaleObjectStateException.jpg&quot; alt=&quot;Photograph of a Woolworths self-checkout machine, with an error message:
&amp;quot;Transaction concurrency error (StaleObjectStateException), Please retry&amp;quot;&quot; /&gt;&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>lottia notes continues</title>
   <updated>2024-12-24T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/12/24/lottia-notes-continues</id>
    
     <link href="https://kivikakk.ee/2024/12/24/lottia-notes-continues/"/>
     <content type="html">&lt;p&gt;A follow-up to &lt;a href=&quot;https://kivikakk.ee/2024/01/03/lottia-notes/&quot;&gt;lottia notes&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Charlotte continues to write &lt;a href=&quot;https://lottia.net/notes/&quot;&gt;there&lt;/a&gt; (though about more topics now, including Nix
and Git/jj), and I‚Äôm considering her readership bootstrapped after a year of
crossposts.  &lt;a href=&quot;https://lottia.net/notes/atom.xml&quot;&gt;Her Atom feed is linked&lt;/a&gt;.&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>Comptime, flow, and exhaustiveness</title>
   <updated>2024-12-17T21:02:36+11:00</updated>
   <id>https://kivikakk.ee/2024/12/17/comptime-flow-exhaustiveness</id>
    
      <link href="https://lottia.net/notes/0015-comptime-flow-exhaustiveness.html"/>
      <content type="html">Make your own exhaustiveness rules up.</content>
    
 </entry>
 
 <entry>
   <title>1.2E+2 Volts (AC)</title>
   <updated>2024-12-15T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/12/15/12e2v</id>
    
     <link href="https://kivikakk.ee/2024/12/15/12e2v/"/>
     <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/post-img/12e2v.png&quot; alt=&quot;Amazon entry excerpt which reads: &amp;quot;Voltage: 1.2E+2 Volts (AC)&amp;quot;&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Platform-specific hacks for high-DPI</title>
   <updated>2024-11-24T22:20:00+11:00</updated>
   <id>https://kivikakk.ee/2024/11/24/hidpi-platform-specific-hacks</id>
    
      <link href="https://lottia.net/notes/0014-hidpi-platform-specific-hacks.html"/>
      <content type="html">We need to avoid getting scaled by the compositor, to preserve our sharp edge.</content>
    
 </entry>
 
 <entry>
   <title>Git and jujutsu: in miniature</title>
   <updated>2024-11-09T14:30:00+11:00</updated>
   <id>https://kivikakk.ee/2024/11/09/git-jujutsu-miniature</id>
    
      <link href="https://lottia.net/notes/0013-git-jujutsu-miniature.html"/>
      <content type="html">A concrete example of Git and jujutsu usage compared.</content>
    
 </entry>
 
 <entry>
   <title>Soft skills: jujutsu early feelings</title>
   <updated>2024-11-07T17:55:00+11:00</updated>
   <id>https://kivikakk.ee/2024/11/07/soft-skills</id>
    
      <link href="https://lottia.net/notes/0012-soft-skills.html"/>
      <content type="html">Launching into jujutsu.</content>
    
 </entry>
 
 <entry>
   <title>Non-intrusive vtable</title>
   <updated>2024-10-29T19:06:00+11:00</updated>
   <id>https://kivikakk.ee/2024/10/29/non-intrusive-vtable</id>
    
      <link href="https://lottia.net/notes/0011-non-intrusive-vtable.html"/>
      <content type="html">OOP is the world's most consistently-used term in any field of any kind, ever.</content>
    
 </entry>
 
 <entry>
   <title>Reply to email, October 15</title>
   <updated>2024-10-29T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/10/29/reply-to-email-october-15</id>
    
     <link href="https://kivikakk.ee/2024/10/29/reply-to-email-october-15/"/>
     <content type="html">&lt;p&gt;The sender address bounced today, so I‚Äôm just publishing my reply here. Hope you
see it! :)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Hiya &amp;lt;3&lt;/p&gt;

&lt;p&gt;Thank you very much for your email; it was really lovely to receive. (Markdown
ecosystem work is not very rewarding a lot of the time, lol :p)&lt;/p&gt;

&lt;p&gt;But yeah ‚Äî I don‚Äôt think there‚Äôs anything in particular you could do, and
that‚Äôs quite OK! The thought by itself is enough, thank you :) Financially I‚Äôm
completely fine. So I hope you get that Clojure gig and get money to make your
own life even cooler! (Throwback to that time I wrote a
&lt;a href=&quot;https://web.archive.org/web/20130423114048/http://rouge.io/&quot;&gt;Clojure impl in Ruby!&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Be well &amp;lt;3&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>Peak performance</title>
   <updated>2024-10-28T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/10/28/peak-performance</id>
    
     <link href="https://kivikakk.ee/2024/10/28/peak-performance/"/>
     <content type="html">&lt;p&gt;&lt;img alt=&quot;A small bar graph from GitHub, titled &amp;quot;Languages&amp;quot;. The legend shows 81% Nix, 18.4% Shell, 0.6% HTML.&quot; src=&quot;/assets/post-img/peakperformance.png&quot; width=&quot;336&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You may not like it, but this is what peak performance looks like.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Led</title>
   <updated>2024-10-13T18:13:00+11:00</updated>
   <id>https://kivikakk.ee/2024/10/13/led</id>
    
     <link href="https://kivikakk.ee/2024/10/13/led/"/>
     <content type="html">&lt;p&gt;Content note: pain, bad mental health, health issues.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/eesti/2024/04/11/early-nyonks/&quot;&gt;Six months later&lt;/a&gt;, we‚Äôre back. It‚Äôs sad ‚Äî we were acclimating well,
met our neighbours, started riding all over the country, and then I started to
be in pain.&lt;/p&gt;

&lt;p&gt;Any kind of pain is bad, but the body part(s) affected really define the flavour
of the impact it has, I guess, and this has been the first time I‚Äôve had really
significant leg pain.  That‚Äôs sort of underselling it; it‚Äôs sometimes in my
knees, usually ankles, feet, and though it seems like it shouldn‚Äôt be related,
also in my elbows, fingertips, and even the sides of my neck, and it all feels
very much related.&lt;/p&gt;

&lt;p&gt;Still, for the most part it‚Äôs in my lower legs, and it. is. constant. I went
back on nifedipine, since a Raynaud‚Äôs ‚Äúdiagnosis‚Äù last year had me try that
and it sort of helped during winter. My hands and feet are always really cold,
and they were worse than usual, so I was hopeful it‚Äôd help. Estonia only had
the &lt;a href=&quot;https://www.health.nsw.gov.au/sabs/Documents/2021-sn-001.pdf&quot;&gt;‚Äúmedium acting‚Äù&lt;/a&gt; variant, and it felt a lot bumpier than the
modified-release ones in Australia.&lt;/p&gt;

&lt;p&gt;After that didn‚Äôt help at all, it was time to see the doctor. And see the
doctor I did. And again, and again. And a physiotherapist. And an orthopaedist.
Two X-rays, two different kinds of strong anti-inflammatory, three weeks of
gabapentin, a month and a half of physio, and three months later in total and
not even the slightest improvement. Exercising didn‚Äôt help, resting didn‚Äôt help.
Ruled out referred back pain, inflammation, neuropathy, muscular.&lt;/p&gt;

&lt;p&gt;Meanwhile, the time between appointments started to stretch out, I guess as
folks returned from summer holidays, and I was just miserable. I hadn‚Äôt been
able to do much of anything in a long time, and the &lt;a href=&quot;https://lobste.rs/s/jqfp5d/what_are_you_doing_this_week#c_hihjcw&quot;&gt;healthcare system in
Estonia&lt;/a&gt; was really making it hard. The pain on some days made me want
to beat whichever leg was hurting into a pulp, because that somehow was more
tractable and bearable.&lt;/p&gt;

&lt;p&gt;So we‚Äôre back. I‚Äôve had some relief since, in being able to switch back to
the modified-release nifedipine, as well as get back on an antidepressant ‚Äî
duloxetine, both for the general sense of despair I‚Äôve been accumulating this
last quarter of a year (!), and for its help with ?fibromyalgia. The pain is a
little bit more distant, but it‚Äôs still there and still getting worse.&lt;/p&gt;

&lt;p&gt;Finally getting some blood tests confirmed it‚Äôs not something easy (anaemia,
B12 deficiency) or obvious (cancer, RF+ RA). My money is on COVID-related
vasculopathy, but I guess it‚Äôs not so easy to confirm, deny, or help. With some
amazing luck, I managed to score an early rheumatologist appointment (someone
had just cancelled), which then got bumped forward another week, so that‚Äôs now
tomorrow.&lt;/p&gt;

&lt;p&gt;I can‚Äôt particularly have my hopes up ‚Äî we‚Äôre up to 4 months now since this
started to intrude on my life. &lt;a href=&quot;/2016/08/22/illness-1.html&quot;&gt;Last time I had a new chronic illness&lt;/a&gt;, it took more than a year for it to start subsiding regularly enough that
I could start to believe it might abate entirely. (It came back for months at a
time, years later.)&lt;/p&gt;

&lt;p&gt;And unlike that time, this one isn‚Äôt only in my head: my legs and feet are
increasingly randomly surfacing bruises that don‚Äôt clear up for &lt;em&gt;months&lt;/em&gt; at
a time. A few days ago while out to therapy, there was a particularly sharp
ache across the top of my left foot, and when I got home, I took my shoe off
and found that a vein had just turned completely black in a spot right there.
There‚Äôs a blue patch on the back of my right leg (the one that hurts less on
average!) that hasn‚Äôt gone away in the whole four months. And as my doctor here
said, it‚Äôs entirely possible that at the end of all our investigations, I‚Äôll
still have this pain to manage, maybe indefinitely.&lt;/p&gt;

&lt;p&gt;Which, y‚Äôknow? That kind of thing just happens in life.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>RSS autodiscovery</title>
   <updated>2024-10-13T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/10/13/rss-autodiscovery</id>
    
     <link href="https://kivikakk.ee/2024/10/13/rss-autodiscovery/"/>
     <content type="html">&lt;p&gt;It‚Äôs come to my attention that some folks don‚Äôt know my blog has an &lt;a href=&quot;https://kivikakk.ee/atom.xml&quot;&gt;RSS feed&lt;/a&gt;!
This is kind of astonishing to me as it suggests people actually manually check
blogs for new posts sometimes?!&lt;/p&gt;

&lt;p&gt;At any rate, it does, it‚Äôs just not linked anywhere explicitly ‚Äî but it is
supported via &lt;a href=&quot;https://dri.es/rss-auto-discovery&quot;&gt;RSS autodiscovery&lt;/a&gt;, which I just kind of .. assumed everyone
used, relied on, knew about? But apparently not!&lt;/p&gt;

&lt;p&gt;I guess I‚Äôll add a link, just in case. :)&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>T√º√ºpiautomaat: automated testing of a compiler and target against each other</title>
   <updated>2024-08-06T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/zig/2024/08/06/t√º√ºpiautomaat</id>
    
     <link href="https://kivikakk.ee/zig/2024/08/06/t%C3%BC%C3%BCpiautomaat/"/>
     <content type="html">&lt;p&gt;I‚Äôm currently working on a bit of a &lt;a href=&quot;https://github.com/charlottia/ava&quot;&gt;long-winded project&lt;/a&gt; to recapture
&lt;a href=&quot;https://en.wikipedia.org/wiki/QuickBASIC&quot;&gt;QuickBASIC&lt;/a&gt;, the environment I learned to program in, in a bit of
a novel way, while remaining highly faithful to the original. (I actually
started a related project &lt;a href=&quot;https://github.com/kivikakk/kyuubey&quot;&gt;9 years ago&lt;/a&gt; (!), and I‚Äôll be able to reuse
some of what I did back then!)&lt;/p&gt;

&lt;p&gt;The new project involves compiling the BASIC down into a bytecode suitable for
a stack machine, and an implementation of such a stack machine. Importantly,
there‚Äôll soon be a second implementation which runs on a different architecture
entirely: namely, it‚Äôll be an implementation &lt;em&gt;of&lt;/em&gt; this architecture on an FPGA.
So the machine needs to be reasonably easy to implement in hardware ‚Äî if it
simplifies the gateware design, I‚Äôll happily take tradeoffs that involve making the
compiler more complicated, or the ISA more verbose.&lt;/p&gt;

&lt;p&gt;The ISA started out with opcodes like:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Opcode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_IMM_INTEGER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_IMM_LONG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x02&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_IMM_SINGLE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x03&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_IMM_DOUBLE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_IMM_STRING&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PUSH_VARIABLE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x0a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;OPERATOR_ADD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xd0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;OPERATOR_MULTIPLY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xd1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;OPERATOR_NEGATE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xd2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the binary operations, the stack machine would pop off two elements, and then
look at the types of those elements to determine how to add them. This is easy to
do in Zig, but this is giving our core a lot of work to do ‚Äî especially when we
consider how extensive the rules involved are:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/typeconversions.png&quot; alt=&quot;Screenshot of QuickBASIC 4.5 open to the &amp;quot;Type Conversions&amp;quot; help page.
It&apos;s scrolled some way down and yet the screen is full of text describing how
operands are converted to the same degree of precision, and further how result
types may affect that.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ideally, the executing machine doesn‚Äôt &lt;em&gt;ever&lt;/em&gt; need to check the type of a value
on the stack before doing something with it ‚Äî the bytecode itself can describe
whatever needs to happen instead.&lt;/p&gt;

&lt;p&gt;In other words, when compiling this&lt;sup id=&quot;fnref:highlighting&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:highlighting&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;       &lt;span class=&quot;err&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;an&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INTEGER&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32768&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32767&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32800&lt;/span&gt;    &lt;span class=&quot;err&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LONG&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2147483648&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2147483647&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;should&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32758&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;py&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smaller&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;would&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overflow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;‚Ä¶ instead of having an op stream like this:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;PUSH_IMM_INTEGER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_IMM_LONG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_VARIABLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_VARIABLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;OPERATOR_SUBTRACT&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;// runtime determines it must promote RHS and do LONG subtraction&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CAST_INTEGER&lt;/span&gt;          &lt;span class=&quot;c&quot;&gt;// runtime determines it has a LONG to demote&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;‚Äî and so leaving the runtime environment to decide when to promote, or demote,
or coerce, and when to worry about under/overflow ‚Äî we instead have this:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;PUSH_IMM_INTEGER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_IMM_LONG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_VARIABLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUSH_VARIABLE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PROMOTE_INTEGER_LONG&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;// compiler knows we&apos;re about to do LONG subtraction&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;OPERATOR_SUBTRACT_LONG&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;COERCE_LONG_INTEGER&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;// compiler knows we&apos;re assigning to an INTEGER&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A proliferation of opcodes results, but crucially it means most operations
execute unconditionally, resulting in a far simpler design when it comes to
putting this on a chip.&lt;/p&gt;

&lt;p&gt;The upshot of this design, however, is that the compiler needs a far greater degree
of awareness and ability:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;It needs to be aware of what types the arguments to the binary operation are.&lt;/p&gt;

    &lt;p&gt;In the example above, we have a LONG and an INTEGER. This appears trivial, but
we need to keep in mind that the arguments can be arbitrary expressions.&lt;/p&gt;

    &lt;p&gt;We need this in order to determine the opcode that gets emitted for the
operation, and to know if any operand reconciliation is necessary.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It needs to be able to reconcile different types of operands, where necessary.&lt;/p&gt;

    &lt;p&gt;BASIC‚Äôs rules here are simple: we coerce the lesser-precision
value to the greater precision. In effect the rule is
INTEGER¬†&amp;lt;¬†LONG¬†&amp;lt;¬†SINGLE¬†&amp;lt;¬†DOUBLE.&lt;/p&gt;

    &lt;p&gt;STRING is not compatible with any other type ‚Äî there‚Äôs no &lt;nobr&gt;&lt;code&gt;&quot;x&quot; * 3 = &quot;xxx&quot;&lt;/code&gt;&lt;/nobr&gt; here.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It needs to be aware of what type a binary operation‚Äôs result will be in.&lt;/p&gt;

    &lt;p&gt;I started out with the simple rule that the result will be of the same type
of the (reconciled) operands. This worked fine when I just had addition,
subtraction and multiplication; above, we add a LONG and an INTEGER, the INTEGER
gets promoted to a LONG, and the result is a LONG.&lt;/p&gt;

    &lt;p&gt;Division broke this assumption, and resulted in the motivation for this
write-up.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It needs to be able to pass that information up the compilation stack.&lt;/p&gt;

    &lt;p&gt;Having calculated the result is a LONG, we need to return that information to
the procedure that compiled this expression, as it may make decisions based
on what‚Äôs left on the stack after evaluating it ‚Äî such as in the first
dot-point here, or when assigning to a variable (which may be of any type, and
so require a specific coercion).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This all kind of Just Worked, right up until I implemented division. I
discovered QuickBASIC actually has floating &lt;em&gt;and&lt;/em&gt; integer division! Young me
was not aware of the backslash ‚Äú&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;‚Äù operator (or any need for it, I suppose).
Floating division always returns a floating-point number, even when the inputs
are integral. Integer division always returns an integral, even when the inputs
are floating. The precision of the types returned in turn depends on that of the
input types.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;operands&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;fdiv ‚Äú&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt;‚Äù&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;idiv ‚Äú&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;‚Äù&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;INTEGER&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;SINGLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;INTEGER&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;LONG&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;DOUBLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;LONG&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;SINGLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;SINGLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;INTEGER&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;DOUBLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;DOUBLE&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;LONG&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;center&gt;&lt;em&gt;Output types of each division operation given (reconciled) input type.&lt;/em&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;This presented a problem for the existing compiler, which assumed the result
would be the same type of the operands: having divided two INTEGERs, for
example, the bytecode emitted &lt;em&gt;assumed&lt;/em&gt; there would be an INTEGER left on the
stack, and so further emitted code would carry that assumption.&lt;/p&gt;

&lt;p&gt;Upon realising how division was supposed to work, the first place I made the
change was in the actual stack machine: correct the behaviour by performing
floating division when floating division was asked for, regardless of the
operand type. Thus dividing two INTEGERs pushed a SINGLE. The (Zig) machine then
promptly asserted upon hitting any operation on that value at all, expecting an
INTEGER there instead. (The future gateware implementation would probably not
assert, and instead produce confusing garbage.)&lt;/p&gt;

&lt;p&gt;And so opened up a new kind of bug to look out for: a mismatch between (a)
the assumptions made by the compiler about the effects on the stack of the
operations it was emitting, and (b) the actual effects on the stack produced by
those operations running on the stack machine.&lt;/p&gt;

&lt;p&gt;Rather than just some isolated tests (though short of creating some whole
contract interface between compiler and machine ‚Äî maybe later), why not be
thorough while using the best witness for behaviour there is? Namely, the
compiler and stack machine themselves:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;compiler and stack machine agree on binop expression types&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tyLhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tyRhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Compiler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;allocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;deinit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compilerTy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;compileExpr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;binop&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;lhs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;oneImm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tyLhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}),&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WithRange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}),&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rhs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;oneImm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tyRhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}),&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;TypeMismatch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// keelatud eine&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;TestEffects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;allocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;TestEffects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
                    &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;deinit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;toOwnedSlice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;allocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;allocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expectEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expectEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compilerTy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We go as follows:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;For all binary operations, enumerate all permutations of left- and right-hand
side types.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;For each such triple, try compiling the binary operation with the ‚Äúone‚Äù-value&lt;sup id=&quot;fnref:one&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:one&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;
of each type as its operands. (For integrals, it‚Äôs literally the number one.)&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;If we get a type error from this attempt, skip it ‚Äî we don‚Äôt care that we can‚Äôt
divide a DOUBLE by a STRING, or whatever.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;If not, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compileExpr&lt;/code&gt; method returns to us the type of what it believes
the result to be. This is the same information used elsewhere in the
compiler to guide opcode and coercion decisions.&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create a stack machine, and run the compiled code.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Seeing as we didn‚Äôt actually compile a full statement, we expect the result
of the operation to be left sitting on the stack. (Normally a statement
would ultimately consume what‚Äôs been pushed.)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Assert that the type of the runtime value left on the stack is the same as
what the compiler expects!&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I love how much this solution takes care of itself. While it lacks the
self-descriptive power of a more coupled approach to designing the compiler and
runtime, it lets the implementations remain quite clear and straightforward to
read. It also lets them stand alone, which is handy when a second implementation
of the runtime part is forthcoming, and is (by necessity) in a completely
different language environment.&lt;/p&gt;

&lt;p&gt;There was greater value than just from floats, of course: relational operators
like equal ‚Äú&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=&lt;/code&gt;‚Äù, not equal ‚Äú&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;&amp;gt;&lt;/code&gt;‚Äù, etc. all return INTEGERs 0 or -1, but
can operate with any combination of numeric types, or with pairs of STRINGs.
Bitwise operators like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AND&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OR&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XOR&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMP&lt;/code&gt; (!), etc. can operate with any
combination of numeric types, but coerce any floats to integrals before doing
so. I bet there‚Äôll be more to uncover, too.&lt;/p&gt;

&lt;p&gt;Hope this was fun to read!&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:highlighting&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;I will get some real BASIC highlighting up here by the next
             post on this!¬†&lt;a href=&quot;#fnref:highlighting&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:one&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;I first used each type‚Äôs zero value, but then we get division by zero errors while trying
    to execute the code!¬†&lt;a href=&quot;#fnref:one&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Kalakarp</title>
   <updated>2024-07-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/27/kalakarp</id>
    
     <link href="https://kivikakk.ee/2024/07/27/kalakarp/"/>
     <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/post-img/kalakarp.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Feeling very seen by fish today.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Ravimid</title>
   <updated>2024-07-26T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/26/ravimid</id>
    
     <link href="https://kivikakk.ee/2024/07/26/ravimid/"/>
     <content type="html">&lt;p&gt;Reviewing all the medications I‚Äôve ever been on. This will be intensely specific to my experiences;
YMMV! Content note: mentions of mental illness, suicidal feelings, assault, sex.&lt;/p&gt;

&lt;h2 id=&quot;mental-health-ish&quot;&gt;mental health(-ish)&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;escitalopram
    &lt;ul&gt;
      &lt;li&gt;A day or two after starting it I felt like the world had colour in it again for the first time.&lt;/li&gt;
      &lt;li&gt;Not very effective for anything other than ‚Äúlight depression‚Äù (?) imo.&lt;/li&gt;
      &lt;li&gt;Prescribed initially for depression/I‚Äôm 23 And Life Is Generally Hard, was on it for two years.&lt;/li&gt;
      &lt;li&gt;Later prescribed in an attempt to counter chronic idiopathic nausea, to no effect.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;quetiapine
    &lt;ul&gt;
      &lt;li&gt;Wow! I didn‚Äôt know what ‚Äúsuicidal compulsion‚Äù actually felt like until I took my first dose.
That was also my last dose.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;desvenlafaxine
    &lt;ul&gt;
      &lt;li&gt;Going up from 100mg to 200mg, I‚Äôd just stop knowing how to form sentences halfway through them.&lt;/li&gt;
      &lt;li&gt;Effective on moderate GAD-type symptoms.&lt;/li&gt;
      &lt;li&gt;Coming off it was, contrary to all expectations, pretty uneventful. Except that for about three
weeks, all I could smell was blood, with no apparent source.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;brexpiprazole
    &lt;ul&gt;
      &lt;li&gt;If you close your eyes, you will fall asleep. At any time.&lt;/li&gt;
      &lt;li&gt;Definitely calm.&lt;/li&gt;
      &lt;li&gt;Much too sleepy to continue, but it definitely brought me down after increasingly intensifying
distress post-sexual assault.&lt;/li&gt;
      &lt;li&gt;As with any antipsychotic/dopamine antagonist, &lt;a href=&quot;https://en.wikipedia.org/wiki/Tardive_dyskinesia&quot;&gt;not particularly inclined&lt;/a&gt; to remain on one
for any longer period of time.&lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;At the time I was put on it, the &lt;em&gt;only&lt;/em&gt; article in the literature about it had the (actually!)
reassuring title: &lt;a href=&quot;https://pubmed.ncbi.nlm.nih.gov/26913177/&quot;&gt;‚ÄúBrexpiprazole: so far so good‚Äù&lt;/a&gt;.&lt;/p&gt;

      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;lamotrigine
    &lt;ul&gt;
      &lt;li&gt;Unclear whether I felt much of anything on this, even after three years at 200mg.&lt;/li&gt;
      &lt;li&gt;Coming off it: ANGER. Wow. (Remember to titrate; SJS can be triggered both on increase and
decrease, apparently.)&lt;/li&gt;
      &lt;li&gt;After coming off it: oh my goodness I suddenly feel like being creative again.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;mirtazapine
    &lt;ul&gt;
      &lt;li&gt;eeeeeeeepy and hunnnnggggy.&lt;/li&gt;
      &lt;li&gt;Extremely and rapidly effective with chronic idiopathic nausea. &lt;em&gt;Nothing&lt;/em&gt; else worked.&lt;/li&gt;
      &lt;li&gt;Weight gain pretty woof. That said, the weight I gained on it, I managed to drop while still on
it.&lt;/li&gt;
      &lt;li&gt;I don‚Äôt remember if I maxed out at 30mg or 45mg ‚Äî at higher doses the dissociation made
memory very wonky.&lt;/li&gt;
      &lt;li&gt;Discontinuation meant a lot of rebound nausea and anxiety. It took me about 4 attempts, over
several years, with various titration schedules; the successful attempt was just dropping from
a sustained 15mg to 0. Trying to step it down at 7.5mg only prolonged the unpleasantness and
resulted in aborting the attempt ‚Äî subtherapeutic but side-effects remain.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;duloxetine
    &lt;ul&gt;
      &lt;li&gt;Really pleasant and noticeable, even at 30mg. Everything feels a bit lighter, and mild
neuropathy totally neutralised.&lt;/li&gt;
      &lt;li&gt;Night sweats :( Became intolerable not long after increasing to 60mg, and didn‚Äôt subside after
reducing again.&lt;/li&gt;
      &lt;li&gt;Discontinuation was reasonably uneventful; (manageably) shorterer temper and very mild nausea.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;gabapentin
    &lt;ul&gt;
      &lt;li&gt;I just started this! Early effects for neuropathy are promising. Slightly dissociative/floaty.&lt;/li&gt;
      &lt;li&gt;Was always curious about gabapentin/pregabalin since I first started having noticeable anxiety,
so I‚Äôm glad I‚Äôve gotten to try it. Definitely somewhat calming.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;diazepam
    &lt;ul&gt;
      &lt;li&gt;It is what it is.&lt;/li&gt;
      &lt;li&gt;Avoid taking on an empty stomach if you‚Äôre having issues with nausea ‚Äî it can get so much
worse.&lt;/li&gt;
      &lt;li&gt;I treat it with extreme caution. I‚Äôve read so many personal horror stories about benzodiazepine
dependence and it takes a really bad time for me to consider taking even 2.5mg. I‚Äôll go up to
5mg if need be, but in general would refuse to take it if I‚Äôve had any separate dose within the
last week.&lt;/li&gt;
      &lt;li&gt;For the above reason, despite having been in some very bad places (where doctors were
prescribing it in larger quantities at a time), I‚Äôve maybe taken 100mg total over the last
decade. Just not worth the risk.&lt;/li&gt;
      &lt;li&gt;Even less inclined to if I‚Äôve taken stimulants on the same day, but I‚Äôve only ever once
(namely, in a life-threatening situation) had to even consider diazepam since getting medicated
for ADHD 2 years ago. Funny how that works!&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;temazepam
    &lt;ul&gt;
      &lt;li&gt;Not a fan; taken a handful of times ever, mostly at music festivals.&lt;/li&gt;
      &lt;li&gt;I have chronic insomnia and this is just not any part of an answer to it.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;adhd&quot;&gt;ADHD&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;dextroamphetamine
    &lt;ul&gt;
      &lt;li&gt;Current weapon of choice. Calm, alert, focussed.&lt;/li&gt;
      &lt;li&gt;Latent anxiety is reduced a lot, probably because it lets me have some agency in my own head.&lt;/li&gt;
      &lt;li&gt;My doctor gradually increased my dose to 10mg, 4 times a day. This is absolutely fucking nuts.
Don‚Äôt do that.&lt;/li&gt;
      &lt;li&gt;After 1.5 years I‚Äôve settled on 2.5mg, twice a day at a 4 hour interval, and it‚Äôs completely
adequate.&lt;/li&gt;
      &lt;li&gt;If I‚Äôm having a very long day, a third dose is fine too. 2.5mg doses are very light.&lt;/li&gt;
      &lt;li&gt;For a long while there I was finding myself increasing my dose by 2.5mg or 5mg (per day) every
week or so since the tolerance builds so rapidly. You will deplete every last monoamine you
have like this. I managed to tolerate 40mg/day (after a buildup) for about two days before I 
crashed. Do Not.&lt;/li&gt;
      &lt;li&gt;Sometimes 2.5mg doses can feel a little bit &lt;em&gt;too&lt;/em&gt; light, but my health right now is such that
increasing even just one of the doses leaves me feeling empty the next day. I‚Äôm glad to have
something that works.&lt;/li&gt;
      &lt;li&gt;Small doses is also good because I‚Äôve yet to see a psychiatrist in Estonia to get a
prescription here, so I‚Äôm working through my stock from Australia very slowly. As far as I can
tell, currently authorised dextroamphetamine products &lt;a href=&quot;https://www.ravimiregister.ee/publichomepage.aspx?pv=PublicMedDetail&amp;amp;vid=988182bb-38b5-4201-bc1f-8ec0eeb820fb&quot;&gt;haven‚Äôt been imported to Estonia&lt;/a&gt;,
so it‚Äôs unclear how easy it‚Äôd be to access it.&lt;/li&gt;
      &lt;li&gt;There‚Äôs &lt;a href=&quot;https://www.ravimiregister.ee/publichomepage.aspx?pv=PublicMedDetail&amp;amp;vid=7e33f799-6b5e-402f-b654-cda2d0e5fe66&quot;&gt;this one&lt;/a&gt;, but it‚Äôs only available in 10mg? And searching for it online shows up
something with the same name, but it‚Äôs &lt;a href=&quot;https://www.google.com/search?hl=en&amp;amp;q=attentin+10mg&amp;amp;udm=2&quot;&gt;atomoxetine&lt;/a&gt; instead? Very suss on that.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;lisdexamfetamine
    &lt;ul&gt;
      &lt;li&gt;Hrrrrrrr. Not a fan.&lt;/li&gt;
      &lt;li&gt;Something about this leaves me feeling depleted at any effective dose. I think I like the
little humps I get between dex doses ‚Äî lisdex is just exhausting, and an absolute pain if you
wake up late.&lt;/li&gt;
      &lt;li&gt;30mg? Not enough to feel anything ‚Äî too spread out.&lt;/li&gt;
      &lt;li&gt;40mg? I kinda feel something. It‚Äôs a bit eh.&lt;/li&gt;
      &lt;li&gt;50mg? Yeah, okay, maybe this starts to feel like I‚Äôm having an OK dose of dex ‚Äî I can think,
focus, actually listen to people when they talk to me. I feel like I am spread very thin.&lt;/li&gt;
      &lt;li&gt;60‚Äì70mg? Effective ‚Äî wired ‚Äî but also I start sleeping longer and longer because of how
exhausted it leaves me, making my doses later and later, in turn fucking up my sleep schedule;
not to mention the pervasive sense of Bad that starts to accumulate. No ty.&lt;/li&gt;
      &lt;li&gt;My god. I tried combining ~low dose lisdex with a small dex booster in the afternoon. Quick way
to know what it feels like to fry your brain. You can do all the stimulant equivalence
arithmetic you want, it just doesn‚Äôt add up that way.&lt;/li&gt;
      &lt;li&gt;If I was offered lisdex or nothing, it‚Äôs not clear to me that I would take it.&lt;/li&gt;
      &lt;li&gt;In general, I‚Äôm not sold on long-acting stimulants. I get the abuse angle (it‚Äôs what I was put
on first, for this reason), and I do read stories of folks who find it legitimately helpful ‚Äî
like most others with ADHD, I regularly forget to take my stimulants ‚Äî but there was no way
to make it work for me. It‚Äôs too inflexible, and there‚Äôs some (possibly fear-mongering) news
out there that suggests long-acting stimulants carry a greater risk of psychosis than
short-acting ones?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;methylphenidate
    &lt;ul&gt;
      &lt;li&gt;Very conflicted on this. (Annoying that it‚Äôs so much more readily available, especially in
Europe.)&lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;a href=&quot;https://elifesciences.org/articles/68165&quot;&gt;Possibly neuroprotective vs. an active COVID infection!&lt;/a&gt; I was on MPH when I finally
got COVID, and was wondering if I should keep taking stimulants through a moderately bad case
of it or not. This article swayed me in favour of maintaining it:&lt;/p&gt;

        &lt;blockquote&gt;
          &lt;p&gt;Remarkably, several drugs acting on receptors to neurotransmitters also appear to decrease
hospitalization risk: rizatriptan (OR=0.118, CI 0.003 to 0.750), bupropion (OR=0.399, CI
0.136 to 0.976), and methylphenidate (OR=0.444, CI 0.178 to 0.972).&lt;/p&gt;
        &lt;/blockquote&gt;

        &lt;p&gt;I‚Äôll take an OR of 0.444ish. I had to argue with a doctor from the government(!) to avoid
hospitalisation, but avoid it I did.&lt;/p&gt;

      &lt;/li&gt;
      &lt;li&gt;I haven‚Äôt gotten a sense for how shared this is, but I get noticeable euphoria when starting on
10mg, and it makes one very inclined to up the dose when you stop getting that response after a
few days.&lt;/li&gt;
      &lt;li&gt;Dragon-chasing aside, MPH consistently produces a sort of global ‚Äúbad‚Äù sensation that I just
cannot with. Even with the initial euphoria, it‚Äôs still noticeable ‚Äî there‚Äôs just this
unpleasant but persistent background qualia, almost a certain flavour of experience. Unclear if
shared or just me.&lt;/li&gt;
      &lt;li&gt;All that notwithstanding, from 10mg it feels 70‚Äì80% as effective as dex at ~equivalent dose
(5mg dex ‚âà 10mg MPH).&lt;/li&gt;
      &lt;li&gt;5mg didn‚Äôt feel like it had any impact at all, but that was a while ago, and I‚Äôd revisit it
if I had to.&lt;/li&gt;
      &lt;li&gt;If I was offered MPH or nothing, I would probably take it.&lt;/li&gt;
      &lt;li&gt;If I was offered MPH or lisdex, I would probably take MPH.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vascular&quot;&gt;vascular&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;propranolol
    &lt;ul&gt;
      &lt;li&gt;Very chill. Noticeable sensation in the chest.&lt;/li&gt;
      &lt;li&gt;I once had a kind of shock reaction to a piercing which resulted in a really high heart rate,
intense and sudden nausea, cold shivers all over, and me on the floor. (I find lying on a cold
hard floor fixes most things.) The next time I went for a piercing I took 10mg propranolol
before and it was easy.&lt;/li&gt;
      &lt;li&gt;Initially prescribed to try to combat panic disorder/idiopathic nausea. It at least brought my
heart rate down and made it possible to eat again.&lt;/li&gt;
      &lt;li&gt;Later took it for arrythmia on demand. Reasonable at this ‚Äî would often get painful(!)
arrythmia at night which would make sleep impossible, and leave me feeling sore (and exhausted)
the whole next day. 10mg propranolol would usually convert it within half an hour.&lt;/li&gt;
      &lt;li&gt;100‚Äì200mg magnesium seems to work for that too.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;nifedipine
    &lt;ul&gt;
      &lt;li&gt;Certainly feel that one on starting. Not like I didn‚Äôt already have some orthostatic
hypotension ‚Ä¶&lt;/li&gt;
      &lt;li&gt;Take for Raynaud‚Äôs in the Australian winter/unspecified (micro?)vascular issues. Recently my
legs have been feeling Not OK and so I‚Äôve restarted it. Unfortunately, we don‚Äôt seem to have
the modified-release ones here, so I have to dose twice a day.&lt;/li&gt;
      &lt;li&gt;Doesn‚Äôt impair exercise.&lt;/li&gt;
      &lt;li&gt;Not to be combined with propranolol (or magnesium, possibly).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;gastric&quot;&gt;gastric&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;esomeprazole/omeprazole
    &lt;ul&gt;
      &lt;li&gt;Unremarkable. Not super effective for (probably stress-induced) heartburn/reflux.&lt;/li&gt;
      &lt;li&gt;Was also prescribed it at one point as an attempt to help with idiopathic nausea ‚Äî no
response.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ondansetron
    &lt;ul&gt;
      &lt;li&gt;This is meant to be the Big Guns when it comes to nausea, and it did nothing for mine.&lt;/li&gt;
      &lt;li&gt;I was scrambling to find something that would work ‚Äî it‚Äôd slowly subsided on desvenlafaxine
in the first instance, and I‚Äôd tapered off that after about a year and was all good. A
particularly bad anxiety attack provoked it into a full reoccurrence, which was terrifying. I
wasn‚Äôt inclined to retry stepping up on desvenlafaxine and waiting it out to see if it‚Äôd work
again ‚Äî I felt like it might‚Äôve also just been a matter of time, then, as it remitted only 
after more than a year of (essentially constant) suffering! ‚Äî so I looked for other things.&lt;/li&gt;
      &lt;li&gt;My research lead me to mirtazapine; &lt;a href=&quot;https://en.wikipedia.org/wiki/Mirtazapine#Pharmacodynamics&quot;&gt;there‚Äôs a number of different ways in which it‚Äôs
antiemetic&lt;/a&gt;. My GP at the time was happy to prescribe it for me based on my conviction,
but wanted to try ondansetron first to see if it‚Äôd work as a circuit breaker (and thus avoid
necessitating something taken over a longer time). Alas.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;cannabidiol&quot;&gt;cannabidiol&lt;/h2&gt;

&lt;p&gt;Usual effects of cannabis products apply.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;THC oil
    &lt;ul&gt;
      &lt;li&gt;First trials found it to be extremely intense and disorienting.&lt;/li&gt;
      &lt;li&gt;Retrying years later (once I was using flower more medicinally and regularly), found it to be a
nice way to dose THC in a more controlled manner, without the usual associations that come with
vaping bud (i.e. ‚ÄúTime To Relax, And Perhaps Eat Much ≈†okolaadi.‚Äù)&lt;/li&gt;
      &lt;li&gt;Slower onset can be quite pleasant.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;CBD oil
    &lt;ul&gt;
      &lt;li&gt;First trials found it to make me feel generally unwell!&lt;/li&gt;
      &lt;li&gt;Later trials together with THC oil found it to be a nice way to dampen some aspects of the THC
high, if needed.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;cannabis flower
    &lt;ul&gt;
      &lt;li&gt;Nothing much to report here. Australian medicinal cannabis was decent, actually decent value
(per volume), and there was a reasonable variety of strains to choose from, which improved over
the years. Doctors were not inclined to gatekeep (&lt;a href=&quot;https://www.abc.net.au/news/2024-07-21/medicinal-cannabis-psychosis-harm-risk-prescription-marijuana/104116952&quot;&gt;perhaps concerningly so&lt;/a&gt;) or judge.&lt;/li&gt;
      &lt;li&gt;Driving was a bit nerve-wracking; regular use builds up a level in the blood which can be
detected by roadside random breath tests even if you‚Äôve not used any that day, so I was pretty
much always on alert/police-avoidance mode. It was a pretty strong deterrent, but I lived in a
public transport deadzone so there wasn‚Äôt much choice.&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://www.abc.net.au/news/2024-05-21/victoria-medicinal-cannabis-driving-cbd-thc-explainer/103872650&quot;&gt;This may be changing soon in Victoria!&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;misc&quot;&gt;misc&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;naproxen
    &lt;ul&gt;
      &lt;li&gt;Prescribed for leg pain which was suspected referred back pain.&lt;/li&gt;
      &lt;li&gt;Came in a combination form with esomeprazole because &lt;a href=&quot;https://en.wikipedia.org/wiki/Nonsteroidal_anti-inflammatory_drug#Gastrointestinal&quot;&gt;COX inhibitors be wild&lt;/a&gt;.&lt;/li&gt;
      &lt;li&gt;No effect.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;tadalafil/sildenafil
    &lt;ul&gt;
      &lt;li&gt;Mildly effective for antiandrogen-related difficulties with penetrative sex.&lt;/li&gt;
      &lt;li&gt;Not a fan of the way these make my heart feel; wouldn‚Äôt opt for tadalafil again since it‚Äôs just
the same but for days instead of hours.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;emtricitabine+tenofovir
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Pre-exposure_prophylaxis_for_HIV_prevention&quot;&gt;PrEP&lt;/a&gt;. This is important, good stuff!&lt;/li&gt;
      &lt;li&gt;Mild nausea during the first two weeks of starting it, otherwise side-effect-free.&lt;/li&gt;
      &lt;li&gt;Been on and off it a half-dozen times over the last 8 years as my risk factors have increased
or decreased. I have nothing but good things to say about PrEP.&lt;/li&gt;
      &lt;li&gt;Caution while travelling; less progressive governments may infer any number of things about you
based on the medication you carry.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;hrt&quot;&gt;HRT&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;oestradiol valerate
    &lt;ul&gt;
      &lt;li&gt;Standard first-line transfem primary HRT.&lt;/li&gt;
      &lt;li&gt;In the first few years I seemed to manage decent levels while increasing to 8mg/day, but over
time I seemed to stop being able to absorb oral oestrogen and had to switch off.&lt;/li&gt;
      &lt;li&gt;Not particularly sad about that: other forms are less work for my liver.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;oestradiol gel
    &lt;ul&gt;
      &lt;li&gt;Absorbs well. A little bit annoying to make your skin sticky twice a day but wycd ¬Ø\_(„ÉÑ)_/¬Ø&lt;/li&gt;
      &lt;li&gt;Seems to be widely available; the last few years have had many HRT shortages, but I‚Äôve not had
issues with this.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;micronised progesterone
    &lt;ul&gt;
      &lt;li&gt;Preferred over synthetics (e.g. levonorgestrel) due to much reduced blood clotting risk, fewer
negative mood side-effects.&lt;/li&gt;
      &lt;li&gt;Helpful for sleep ‚Äî take at night.&lt;/li&gt;
      &lt;li&gt;First time I started it, within days I was sobbing (+) while watching Frozen. Really unlocks
some emotions.&lt;/li&gt;
      &lt;li&gt;200-300mg is an actual recreational high (N.B.! loss of consciousness/respiratory depression
may result at extreme doses).&lt;/li&gt;
      &lt;li&gt;Also an antiandrogen!&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;spironolactone
    &lt;ul&gt;
      &lt;li&gt;At least in Australia, first-line antiandrogen.&lt;/li&gt;
      &lt;li&gt;Diuretic and generally not fun. At the doses required for me, also precipitated pretty intense
low mood which abated upon discontinuation.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;cyproterone
    &lt;ul&gt;
      &lt;li&gt;Antiandrogen. Extremely effective in even tiny doses.&lt;/li&gt;
      &lt;li&gt;My doctor started me on 50mg a day. I don‚Äôt have a good analogy for how nuclear this is.&lt;/li&gt;
      &lt;li&gt;May need more initially to get levels down, but (depending on prevailing E levels) you may be
fine with 12.5 mg &lt;strong&gt;once a week&lt;/strong&gt;, i.e. 3.6% of the dose I was started on.&lt;/li&gt;
      &lt;li&gt;Some folks report low mood on cypro; it hasn‚Äôt been an issue for me.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

</content>
    
 </entry>
 
 <entry>
   <title>VyxOS</title>
   <updated>2024-07-19T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/19/vyxos</id>
    
      <link href="https://lottia.net/notes/0010-vyxos.html"/>
      <content type="html">Nix configuration revealed!</content>
    
 </entry>
 
 <entry>
   <title>Sada p√§eva</title>
   <updated>2024-07-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/18/sada-p√§eva</id>
    
     <link href="https://kivikakk.ee/2024/07/18/sada-p%C3%A4eva/"/>
     <content type="html">&lt;p&gt;Yesterday was our 100th day in Estonia. Taking a little bit of stock of what we‚Äôve managed:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Visited the 4 largest cities in the country.&lt;/li&gt;
  &lt;li&gt;Rented an apartment in the biggest one!&lt;/li&gt;
  &lt;li&gt;Furnished what the apartment didn‚Äôt come with.&lt;/li&gt;
  &lt;li&gt;Shipped our things from Australia. (Maybe a month off those arriving.)&lt;/li&gt;
  &lt;li&gt;Got our motorcycles; put 900km on each.&lt;/li&gt;
  &lt;li&gt;Got medium-term visa for A, and long-term one applied for.&lt;/li&gt;
  &lt;li&gt;Got our medications prescribed locally.&lt;/li&gt;
  &lt;li&gt;Financial/bureaucratic overhead.&lt;/li&gt;
  &lt;li&gt;Changed my name and got new ID.&lt;/li&gt;
  &lt;li&gt;Got onto a good family doctor‚Äôs list.&lt;/li&gt;
  &lt;li&gt;Kept in touch with families and psychologists.&lt;/li&gt;
  &lt;li&gt;Vaccinations.&lt;/li&gt;
  &lt;li&gt;Saw the border.&lt;/li&gt;
  &lt;li&gt;Went to a cat caf√©.&lt;/li&gt;
  &lt;li&gt;Went to sauna.&lt;/li&gt;
  &lt;li&gt;Concluded jaanip√§ev with clothes smelling deeply of bonfire.&lt;/li&gt;
  &lt;li&gt;Went to a live show (Estonian).&lt;/li&gt;
  &lt;li&gt;Went to a live show (non-Estonian).&lt;/li&gt;
  &lt;li&gt;Walked about 500km.&lt;/li&gt;
  &lt;li&gt;Taken a lot of public transport.&lt;/li&gt;
  &lt;li&gt;Met a range of people.&lt;/li&gt;
  &lt;li&gt;Spoken quite a bit of Estonian.&lt;/li&gt;
  &lt;li&gt;Kept up with projects.&lt;/li&gt;
  &lt;li&gt;Finished a diary!&lt;/li&gt;
  &lt;li&gt;Grew a lot.&lt;/li&gt;
&lt;/ul&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Activity period</title>
   <updated>2024-07-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/09/activity-period</id>
    
     <link href="https://kivikakk.ee/2024/07/09/activity-period/"/>
     <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/post-img/eesti/activityperiod.png&quot; alt=&quot;Screenshot of a website. The title is &amp;quot;Activity period&amp;quot;. Text underneath reads: &amp;quot;The sole proprietor may notify the registrar in advance of the suspension of activities, temporary activities or set periods of seasonal activities. Below that is a timeline with &amp;quot;2024&amp;quot; underneath it, and 12 points marked along the timeline. All 12 points have the legend &amp;quot;Invalid Date&amp;quot;.&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Time travel</title>
   <updated>2024-07-06T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/07/06/time-travel</id>
    
      <link href="https://lottia.net/notes/0008-time-travel.html"/>
      <content type="html">The typical hypothetical ‚Äúwho are you coding for‚Äù example meant to shock you into writing better code is ‚Äúyourself in six months‚Äù, but it turns out four is completely adequate to get lost.</content>
    
 </entry>
 
 <entry>
   <title>Python still surprises</title>
   <updated>2024-06-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/06/27/python-still-surprises</id>
    
     <link href="https://kivikakk.ee/2024/06/27/python-still-surprises/"/>
     <content type="html">&lt;p&gt;After the better part of 20 years working with Python, it still managed to
surprise me today.&lt;/p&gt;

&lt;p&gt;I‚Äôm so used to languages treating &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x += y&lt;/code&gt; et al. as pure sugar for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x = x + y&lt;/code&gt;
that it skipped my mind that some don‚Äôt.&lt;/p&gt;

&lt;p&gt;I‚Äôm not surprised that you &lt;em&gt;can&lt;/em&gt; override them separately in some languages (e.g.
I simply assume this to be the case in C++, and on checking it turns out to
be true ‚Äî but that seems fair enough given the scope of the language), but I
really am so accustomed to them being only sugar in Ruby that I assumed the same
would hold, at least in effect, in Python.&lt;/p&gt;

&lt;p&gt;Thus my surprise on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;some_list += x&lt;/code&gt; modifying &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;some_list&lt;/code&gt; in place (unlike
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;some_list = some_list + x&lt;/code&gt;), but once observed, I realised there‚Äôd be a
separately-overridden operator function ‚Äî namely &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__iadd__&lt;/code&gt; ‚Äî and so I
figured it ‚Äúhad‚Äù to be that way.&lt;/p&gt;

&lt;p&gt;Or did it? I then found myself assuming it‚Äôs because these operators can‚Äôt
actually reassign the receiver, but in fact they can and do: the return value is
what‚Äôs assigned to the LHS. So it‚Äôs just a matter of convention.&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>sint</title>
   <updated>2024-06-22T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/06/22/sint</id>
    
     <link href="https://kivikakk.ee/2024/06/22/sint/"/>
     <content type="html">&lt;p&gt;Notes.app, kell 08:03:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;my new theory is that satan Crept into this world through signed integers&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
 </entry>
 
 <entry>
   <title>zxxrtl</title>
   <updated>2024-06-17T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/digital/2024/06/17/zxxrtl</id>
    
     <link href="https://kivikakk.ee/digital/2024/06/17/zxxrtl/"/>
     <content type="html">&lt;p&gt;I‚Äôve been getting back into using &lt;a href=&quot;https://yosyshq.readthedocs.io/projects/yosys/en/latest/cmd/write_cxxrtl.html&quot;&gt;CXXRTL&lt;/a&gt; and &lt;a href=&quot;https://ziglang.org&quot;&gt;Zig&lt;/a&gt; together, so I‚Äôve extracted
and rendered somewhat reusable the bindings I made to use them together!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/kivikakk/zxxrtl&quot;&gt;zxxrtl&lt;/a&gt; uses CXXRTL‚Äôs C API to provide a somewhat idiomatic way to access,
manipulate, and respond to events happening in the design. Its README covers the
setup ‚Äî it‚Äôs a bit involved as it‚Äôs necessarily something of a build system,
but once you‚Äôre done it‚Äôs good to go and flexible enough to be instrumented from
a higher build system.&lt;/p&gt;

&lt;p&gt;I‚Äôm going to paste the example usage here; this doesn‚Äôt use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sample&lt;/code&gt; API for
edge detection, and just drives the simulation while optionally recording VCD:&lt;/p&gt;

&lt;div class=&quot;language-zig highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cxxrtl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;@import&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;zxxrtl&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Initialise the design.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Optionally start recording VCD. Assume `vcd_out` is `?[]const u8` representing an&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;// optional output filename.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Vcd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd_out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;Vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;deinit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;deinit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Get handles to the clock and reset lines.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;clk&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rst&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;rst&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// These are of type `Cxxrtl.Object(bool)`.&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Reset for a tick.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;clk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;clk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;rst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Play out 10 cycles.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;clk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;clk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cxxrtl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// Assume `alloc` exists.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vcdh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;createFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vcd_out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{});&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;writeAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hopefully this is useful to someone else!&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>fren</title>
   <updated>2024-06-13T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/06/13/fren</id>
    
     <link href="https://kivikakk.ee/eesti/2024/06/13/fren/"/>
     <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/post-img/eesti/fren.jpg&quot; alt=&quot;low-exposure photograph of a cat walking along the ground&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>T√§na</title>
   <updated>2024-06-06T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/06/06/t√§na</id>
    
     <link href="https://kivikakk.ee/eesti/2024/06/06/t%C3%A4na/"/>
     <content type="html">&lt;p&gt;T√§na oli saunap√§ev. ^_^&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Chisel and C++, recorded at last</title>
   <updated>2024-05-29T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/digital/2024/05/29/chisel-and-cxx-recording</id>
    
     <link href="https://kivikakk.ee/digital/2024/05/29/chisel-and-cxx-recording/"/>
     <content type="html">&lt;p&gt;Yay! &lt;a href=&quot;https://www.youtube.com/watch?v=_-oqnf9gYuE&quot;&gt;Here‚Äôs the recording&lt;/a&gt; for &lt;a href=&quot;https://kivikakk.ee/digital/2024/05/28/chisel-and-cxx/&quot;&gt;Chisel and C++, together at last&lt;/a&gt;.&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>Chisel and C++, together at last</title>
   <updated>2024-05-28T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/digital/2024/05/28/chisel-and-cxx</id>
    
     <link href="https://kivikakk.ee/digital/2024/05/28/chisel-and-cxx/"/>
     <content type="html">&lt;p&gt;I gave a lightning talk at last night‚Äôs &lt;a href=&quot;https://blog.yosyshq.com/p/yosys-users-group/&quot;&gt;Yosys Users Group&lt;/a&gt; about combining
Chisel and &lt;nobr&gt;C++&lt;/nobr&gt; with Yosys/CXXRTL. &lt;del&gt;I think there‚Äôll be a recording
of them that goes up on YouTube eventually?&lt;/del&gt;&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/_-oqnf9gYuE?si=sOh9tujGCab9fHcZ&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Here‚Äôs my &lt;a href=&quot;https://f.hrzn.ee/chiselcxx.pdf&quot;&gt;slides&lt;/a&gt;; the transcript follows.&lt;/p&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.001.jpeg&quot; alt=&quot;Chisel and C++, together at last. Yosys% speedrun. 2024.05.27 ‚Äî @kivikakk&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hi folks! I‚Äôm kivikakk, and I‚Äôm here to talk about connecting Chisel and C++,
leaning on Yosys for all the hard work.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.002.jpeg&quot; alt=&quot;@kivikakk ‚Äî no verilog pls. Senior systems engineer; no EE/DD background. Australian startups, agencies, GitHub. Started playing with FPGAs early 2023, OSS toolchains only. ~40 commits in Yosys, mostly in support of CXXRTL and alternative frontends. To the right of the slide is a snapshot of my GitHub profile showing recent work, and an excerpt of my commits in Yosys.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the workplace I‚Äôm a ‚Äúsystems engineer‚Äù, which usually means weaving together
low- and high- level languages in dark ways; think writing Erlang C nodes,
combining Ruby, Go and C++, that kind of thing.&lt;/p&gt;

&lt;p&gt;In open source, I‚Äôm regrettably best-known for my work with Markdown. I have
zero electrical or digital background ‚Äî or formal education ‚Äî but after
microcontrollers failed to capture my interest, FPGAs succeeded, and I started
exploring in earnest last year.&lt;/p&gt;

&lt;p&gt;Now, this is something I do for fun, which meant Verilog and VHDL were
completely capable of turning me off this path forever. I‚Äôm really into
programming language theory and design, and uh, well, Verilog sure could‚Äôve used
some of either. I found Amaranth (formerly nMigen) pretty quickly, and so I
started hacking on Yosys too. I‚Äôve particularly enjoyed working on CXXRTL, which
is the focus of this talk. I spent about 9 months learning with Amaranth, but‚Äî&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.003.jpeg&quot; alt=&quot;A labrador in a science lab wearing safety goggles, pouring a beaker into a mug, with the text superimposed: &amp;quot;I have no idea what I&apos;m doing.&amp;quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I‚Äôm still this dog, and there are more perspectives out there.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.004.jpeg&quot; alt=&quot;Screenshot of the Chisel homepage, an excerpt of Chisel code, and the SystemVerilog generated from that code.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I decided to learn Chisel, which is an HDL in Scala like Amaranth is an HDL in
Python. These aren‚Äôt high-level synthesis tools, you still describe hardware in
them, just using DSLs embedded in a regular programming language.&lt;/p&gt;

&lt;p&gt;You write code which generates hardware, in a metaprogramming kind of way,
except the metaprogramming is regular programming and the programming is circuit
definition instead. You run your code,&lt;/p&gt;

&lt;p&gt;and out pops something that can go into your toolchain‚Äôs frontend. Chisel
outputs SystemVerilog, and is easily configured to avoid constructs Yosys
doesn‚Äôt like.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.005.jpeg&quot; alt=&quot;Screenshot of SystemVerilog code with an arrow pointing to the Yosys cat logo. From the Yosys logo arrows point to a Lattice iCE40 chip with the associated text &amp;quot;Project IceStorm, nextpnr-ice40&amp;quot;, a Lattice ECP5 chip with the text &amp;quot;Project Trellis, nextpnr-ecp5&amp;quot;, and a cute C++ logo.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we have our Verilog, and we feed it into Yosys.&lt;/p&gt;

&lt;p&gt;Using the rest of the suite, we can synthesise for iCE40, ECP5 and more, but we can also target C++!&lt;/p&gt;

&lt;p&gt;Yosys has its own C++ backend, CXXRTL. It‚Äôs similar to Verilator, but has some
unique advantages. For starters, if you‚Äôre using Yosys anyway, we can avoid
adding another tool. Moreover, the C++ comes directly from Yosys‚Äô internal RTL
model ‚Äî you can perform transforms and optimisations and then generate the
simulation without a Verilog roundtrip. It also supports runtime introspection
of the design, as well as exposing its API to C. This makes it feasible to use
the generated simulations from any language with C FFI, like Rust or Zig.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.006.jpeg&quot; alt=&quot;Screenshot of Chisel code describing an instruction set for a stack machine and the core logic of the stack machine, as well as some code that shows a memory read port generated from a static ROM.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;One of the most fun parts, though, is the ability to instantiate blackboxes
anywhere in your hierarchy, which you implement in C++. I‚Äôm going to show you
real fast what that can look like.&lt;/p&gt;

&lt;p&gt;Here‚Äôs a tiny stack machine. It knows how to read and write bytes on UART, some
trivial stack manipulation, and how to jump back to zero. The implementation
itself isn‚Äôt very challenging, but the important part is that it gets its
instructions from a synchronous memory.&lt;/p&gt;

&lt;p&gt;For unit tests  in Chisel, I instantiate a vector like a ROM, and implement the
other side side of the read port, making sure to return data in the right cycle.
So far so good.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.007.jpeg&quot; alt=&quot;C++ logo in the middle with a small flash chip above it. Three dot points are listed: A. Emulate in gateware. B. Emulate in C++ by monitoring the top-level IO pins. C. Emulate in C++ with a &amp;quot;whitebox&amp;quot; implementation that responds to your module&apos;s IOs.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Let‚Äôs initialise our instruction memory from SPI flash. The iCEBreaker I‚Äôm using
as a dev board puts its bitstream on one, and there‚Äôs plenty of room left for
user data. So I flash my little ‚ÄúROM‚Äù into the upper half, and on reset the
gateware‚Äôs SPI reader module populates the memory from it before starting the
stack machine.&lt;/p&gt;

&lt;p&gt;What about our C++ simulation? We have a few options that are more interesting
than ‚Äúignore the flash reader‚Äù:&lt;/p&gt;

&lt;p&gt;A, we can do like we did with the static memory and emulate the SPI flash in
gateware, and put that into the design when elaborating for CXXRTL.&lt;/p&gt;

&lt;p&gt;This approach is fine for simple external interfaces, but for more complex ones,
such an implementation may not be feasible, and writing gateware for sim means
writing testbenches for your sim gateware. It‚Äôs also going to run as slow as any
other logic.&lt;/p&gt;

&lt;p&gt;B, we can emulate the SPI flash in C++ by watching the top-level output pins and
toggling input pins as necessary. This is straight-forward, though it means you
have to co-simulate your peripheral at the same time as stepping the design.&lt;/p&gt;

&lt;p&gt;C, we can drop a blackbox into the design, and hook up the SPI reader module to
the blackbox instead of external IO. Then, we implement the blackbox internals
in C++.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.008.jpeg&quot; alt=&quot;Chisel code sample that describes a whitebox, pointing to a C++ class definition that matches it with no implementation details, pointing in turn to a subclass of that class which overrides and fills out the logic.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is where CXXRTL‚Äôs blackbox support comes in: you give it a module interface
definition, and it generates a C++ class for it the same way it would for any
other non-flattened module in your design. Then you subclass it, implementing
logic internal to the blackbox in C++, reacting to events at the simulation step
level, without having to rewrite your whole simulation driver into an event
loop.&lt;/p&gt;

&lt;p&gt;This is super powerful, and it‚Äôs a lot easier to implement a peripheral in
full-blown C++ than it is in gateware.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.009.jpeg&quot; alt=&quot;C++ logo in the middle with the flash chip again. Now a fourth point is added: D. Simulate the module itself with a blackbox implementation that produces the right IOs.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, I tend to call this approach a ‚Äúwhitebox‚Äù implementation, to contrast with‚Äî&lt;/p&gt;

&lt;p&gt;D, take the SPI reader out of the design, and drop in a blackbox which emulates
the reader‚Äôs interface instead.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.010.jpeg&quot; alt=&quot;Chisel code sample that dsecribes a blackbox, and the C++ logic in its subclass.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So whereas the whitebox watches chip-select and data-in and toggles data-out
accordingly, painstakingly pretending to be a real flash module, this blackbox
goes one level higher, and monitors the read strobe from your design and
responds to it directly. This can significantly speed up your simulation,
particularly if your design clock rate is high but the peripheral‚Äôs is much
lower, like in I¬≤C.&lt;/p&gt;

&lt;p&gt;As with the other non-gateware options, you can source the data from a file on
disk, a buffer compiled in, or from the network or whatever you like, it‚Äôs your
C++ code.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.011.jpeg&quot; alt=&quot;Chisel code sample showing target specific wiring for three platforms: IceBreaker, CXXRTL whitebox, CXXRTL blackbox.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is the target-specific gateware for this example, all in the top-level
module. Most of this depends on my little framework for Chisel, but it‚Äôs all
just ergonomics and instrumenting Yosys really.&lt;/p&gt;

&lt;p&gt;For iCEBreaker, we instantiate a real UART driver and wire it up to the IO pins;
its control interface is connected to the stack machine. The CXXRTL targets skip
the UART and just expose the control interface at the top level. Those are what
the C++ sim driver interacts with.&lt;/p&gt;

&lt;p&gt;Similarly, for iCEBreaker we instantiate the flash reader, connect its pins and
hook its control interface to a wire bundle. The whitebox also instantiates the
flash reader and wires the control interface, but connects its pins to the C++
whitebox module instead. The blackbox skips the reader entirely, and instead
connects the control interface wire bundle to the C++ blackbox module.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.012.jpeg&quot; alt=&quot;Two README screenshots both demonstrating hardware and matching software simulations. On the left is a photograph of a 4-digit 7-segment display spelling out the word &amp;quot;pong&amp;quot;. Underneath is a screenshot of software showing the same display and the same output. On the right is a screenshot of some software demonstrating a 128x128 OLED with some text and ASCII drawing characters on it. There&apos;s a photograph of an OLED display wired up to an IceBreaker showing the same output.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So, I really enjoy this approach! It‚Äôs a lot of fun, and being able to stub out
my design at various levels turns out to be really handy as my logic gets more
involved. CXXRTL‚Äôs simulation isn‚Äôt as fast as Verilator‚Äôs, but it‚Äôs within the
same order of magnitude, and it lets me make these changes essentially
hot-swappable, because the blackboxes are instantiated if and where they occur
in the design.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/chiselcxx/slides.013.jpeg&quot; alt=&quot;A list of links and acknowledgements, included below the text that follows.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And that‚Äôs it! The main takeaway really is that you can do this kind of thing
with Yosys with any HDL ‚Äî none of this is Chisel specific, it‚Äôs just what I
happened to pick. Thanks all.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/kivikakk/spifrbb&quot;&gt;SPI flash reader example&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/chryse-hdl/chryse&quot;&gt;Chryse, experimental framework for Chisel/Yosys&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tomverbeure.github.io/2020/08/08/CXXRTL-the-New-Yosys-Simulation-Backend.html&quot;&gt;CXXRTL primer (a little out of date now)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://x.com/sawaratsuki1004&quot;&gt;C++ logo by Sawaratsuki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Digital design bash.org</title>
   <updated>2024-05-10T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/05/10/digital-design-bash-org</id>
    
     <link href="https://kivikakk.ee/2024/05/10/digital-design-bash-org/"/>
     <content type="html">&lt;p&gt;Identities changed to protect the innocent.&lt;/p&gt;

&lt;p&gt;&lt;code style=&quot;font-family: monospace;&quot;&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; How do you do 128bit memory buses and stuff like that&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; Like what is going on in those 128 bits&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: orange&quot;&gt;Rice&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; uh, data that&apos;s being read from or written to memory?&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: orange&quot;&gt;Rice&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; What is the issue you&apos;re not understanding&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;opacity: 0.6&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: orange&quot;&gt;Rice&lt;/span&gt; What is transferred over it&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: pink&quot;&gt;HamSandwich&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; data that&apos;s being read from or written to memory üëÄ&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;opacity: 0.6&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: pink&quot;&gt;HamSandwich&lt;/span&gt; Yea. How do you manage 128 bits though. That&apos;s a lot&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: pink&quot;&gt;HamSandwich&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; They are written to and from caches via the cache controller, not the core. The core has a maximum of 32-bit access.&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: orange&quot;&gt;Rice&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;opacity: 0.6&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt; ...the same way you handle 32 or 64 bits of data, just double or quadruple?&lt;br /&gt;
&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: green&quot;&gt;pestopasta&lt;/span&gt;&lt;span style=&quot;opacity: 0.6&quot;&gt;&amp;gt;&lt;/span&gt; I don&apos;t know what you mean. Is there a video explaining this?
&lt;/code&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Amaranth to Chisel</title>
   <updated>2024-05-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2024/05/09/amaranth-to-chisel</id>
    
      <link href="https://lottia.net/notes/0007-amaranth-to-chisel.html"/>
      <content type="html">Learning your second HDL is kinda like learning your second programming language. Or just learning your second language.</content>
    
 </entry>
 
 <entry>
   <title>Post-vaccination advice by country</title>
   <updated>2024-05-03T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/05/03/post-vaccination-advice-by-country</id>
    
     <link href="https://kivikakk.ee/eesti/2024/05/03/post-vaccination-advice-by-country/"/>
     <content type="html">&lt;p&gt;As dispensed by the vaccinating staff:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Australia: Now, no heavy lifting for a few hours!&lt;/li&gt;
  &lt;li&gt;Estonia: Mm.. probably better not to go in sauna today.&lt;/li&gt;
&lt;/ul&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Volbrip√§ev</title>
   <updated>2024-05-01T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/05/01/volbrip√§ev</id>
    
     <link href="https://kivikakk.ee/eesti/2024/05/01/volbrip%C3%A4ev/"/>
     <content type="html">&lt;p&gt;&lt;a href=&quot;https://kivikakk.ee/eesti/2024/04/29/naming/&quot;&gt;Never mind that&lt;/a&gt;, lol. I have to update my Estonian documents to match
my Australian ones for my partner‚Äôs immigration, so back to Ashe it is!&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>Naming</title>
   <updated>2024-04-29T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/04/29/naming</id>
    
     <link href="https://kivikakk.ee/eesti/2024/04/29/naming/"/>
     <content type="html">&lt;p&gt;Noting that, having moved (‚Äúreturned!‚Äù) to Estonia, I‚Äôm going by Amelia (or Amy)
again, since it‚Äôs the name on all my documentation here.
&lt;a href=&quot;/assets/post-img/eesti/head-isu.jpg&quot; title=&quot;Photo of a power distribution box, with graffiti art of a very long, splotchy, odd looking dog, and the text &apos;Head isu! #14&apos; above it.&quot;&gt;Head isu!&lt;/a&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Continued ny√µnks</title>
   <updated>2024-04-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/04/18/continued-nyonks</id>
    
     <link href="https://kivikakk.ee/eesti/2024/04/18/continued-nyonks/"/>
     <content type="html">&lt;p&gt;It‚Äôs been a week since I last wrote. Some more little bits and pieces.&lt;/p&gt;

&lt;p&gt;The DPDR/dissociation has become even bit worse; somehow still keeping it
together. Watching The Princess Bride with Annie last night helped.&lt;/p&gt;

&lt;p&gt;Miscellany:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Presented to the Police and Border Guard Board office to renew my ID card. Sat
down in front of the worker once my number was called and asked, ‚Äúkas te
r√§√§gite inglise keelt?‚Äù (do you speak English?). With almost a tinge of pride,
she replied, ‚Äúei!‚Äù (no!). It took everything in me not to &lt;a href=&quot;https://youtu.be/CgjMfaQ94Co?si=Qig3i8dlKwjSIOC3&amp;amp;t=117&quot;&gt;burst out
laughing&lt;/a&gt;.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;There‚Äôs an oddity in that I can pronounce Estonian very well, despite not
really knowing much of it (i.e. reading out text, like from a menu or Google
Translate or whatever, I sound semi-native, but actually producing that text
myself I‚Äôm nowhere near yet). This makes for fun situations.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;We have a new home :) An r/eesti comment mentioned someone once found an
apartment in Tallinn on day 5 and was moved in by day 7. That was encouraging,
if a little unrealistic-seeming. But nope: we inspected ours on day 4 (!), and
moved in on day 8. Now we can ship our boxes from Australia.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Food‚Äôs so nice here.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Sure it‚Äôs 2¬∞ outside, that‚Äôs no problem, but then you walk into any building
and it‚Äôs 22¬∞ and you‚Äôre shedding layers as fast as you can. Other people just
seem not to?! I don‚Äôt get it.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;The worst part for me is that, even with all our apartment floor-heating
turned ‚Äúoff‚Äù (or as off as you can, which is to say, the set point is set
lower than the actual point), we‚Äôre on the top of the building, so it‚Äôs over
20¬∞ regardless. This is troublesome at night, and the street noise might be
a bit much to open the windows, but using the aircon when it‚Äôs below zero
outside feels a bit ‚Ä¶&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;Also, sharing a bedroom for the first time in so many years is a strange
experience, like I‚Äôm cosplaying being a different kind of adult.&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Public transport‚Äôs so nice here ‚Äî it‚Äôs already happened that we‚Äôve taken
train+bus+tram all in the one day just out of convenience.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Not that I‚Äôve worked out how to get the free transit for locally-registered
residents working on my √úhiskaart yet.&lt;/p&gt;

        &lt;ul&gt;
          &lt;li&gt;
            &lt;p&gt;Is it only on TLT-operated busses? Is that it?? The information‚Äôs all very
vague.&lt;/p&gt;

            &lt;ul&gt;
              &lt;li&gt;DISREGARD THAT I S‚Äîeem to have gotten it on a further attempt with the
card reader.&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It just started snowing!?!!?&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;/assets/post-img/eesti/juustuga.png&quot; title=&quot;Screenshot of a food delivery app, automatically translated from Estonian.
The section header is &apos;With justice&apos;, and the options are &apos;Without cheese&apos; and
&apos;With justice&apos;.&quot;&gt;Without cheese or with justice?&lt;/a&gt; (&lt;a href=&quot;https://en.wiktionary.org/wiki/juust#Estonian&quot;&gt;juust&lt;/a&gt;)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Early ny√µnks</title>
   <updated>2024-04-11T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/eesti/2024/04/11/early-nyonks</id>
    
     <link href="https://kivikakk.ee/eesti/2024/04/11/early-nyonks/"/>
     <content type="html">&lt;p&gt;We‚Äôve been in the country a little over two days now. It‚Äôs been one of the most
serene times of my life, and even the flights from Australia seemed to pass in
an instant.&lt;/p&gt;

&lt;p&gt;This is in some part due to intense derealisation, but as uncanny as life has
seemed for months now, I can‚Äôt say I hate it ‚Äî I‚Äôve been able to do so many
things without crushing anxiety killing it, whether due to COVID or whatever
else. (Not that the skin on my face is recovered yet from the 30 hours of
wearing an elastomeric respirator.)&lt;/p&gt;

&lt;p&gt;Some fun moments and things I don‚Äôt want to forget:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;We had 6 hours to kill between getting out of Tallinn airport and our
temporary accommodation becoming available to us. We walked around the Old
Town after storing our bags, still wearing the clothes from our flights. I had
on a plain blue dress and black knee-high compression socks, and didn‚Äôt
realise quite how I looked until we spotted two men, bottles in hand and
visibly drunk, who spotted us in turn and called out to me, ‚Äú–ì–µ—Ä–º–∞–∞–∞–∞–∞–Ω–∏—è!
–ê–π–∞–π–∞–π–∞–π—è–∞–∞!‚Äù, and all four of us were laughing.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;/assets/post-img/eesti/thisguy.jpg&quot; title=&quot;A photograph of an ape (?)
sculpture (??) painted bright red, sitting in the front garden of some house.
A large EU flag is visible hanging on an adjacent property.&quot;&gt;This guy&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;/assets/post-img/eesti/thisgirl.jpg&quot; title=&quot;A photograph of Annie
standing in front of a wall covered in various graffiti, herself right next to
a pretty flower in red and white. Also visible is &apos;follow sheep, not the
state&apos; next to an anarchist circle-A symbol. In the background are trees
(without leaves yet) and tourists.&quot;&gt;This girl&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Beer and cider at 3pm in an upstairs nook of a caf√© with no-one in it but us
(still waiting for our accommodation to become available). The owner came up
and gave us some cake that was left-over from a birthday party.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Walking to the Rimi express on my own first thing in the morning to get cereal
and &lt;del&gt;milk&lt;/del&gt; oat drink. I feel so calm here.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Bike riding to Rocca al Mare :) We took panniers and had probably the nicest
and most ‚Äúsuccessful‚Äù shopping experience of my life. (warm clothes for the
new climate!)&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;NEXT TIME HIRING A MOUNTAIN BIKE, PLEASE, ‚ÄúCITY BIKES‚Äù ARE A GRIFT&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Vapiano vegan chicken pastaaaaaaaaa, next time I will take much more bread&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Going from straight-up pre-emptive ‚ÄúInglise keel?‚Äù at the beginning of
exchanges with service staff to full Estonian in the course of a day, and just
hoping I was guessing the questions right when I didn‚Äôt know the operative
words. (usually assuming it‚Äôs ‚Äúdo you have a membership with us?‚Äù, since ‚Äúei
ole‚Äù seems to get me through ‚Ä¶)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;We were having a sit in the square after exploring the new town today,
people-watching, when we noticed a group of younger Russian girls having fun,
chasing pigeons, etc. After a while, I began to notice the most adventurous
one tracing out a circuitous path from their spot under the town hall over to
us, inverted phone in hand, ready to record an exchange.&lt;/p&gt;

    &lt;p&gt;Without much ado, she finally came over and sat down right next to me, holding
her phone up and asking something in somewhat-shy-and-therefore-mumbled
Russian. I just said ‚Äú–ß—Ç–æ?‚Äù, and even more embarrassed she repeated her
question. I got the gist of it and first said ‚Äú–Ø –Ω–µ –∑–Ω–∞—é —Ä—É—Å—Å–∫–∏–π.. English?‚Äù
She haltingly replied, ‚Äúm-maybe?‚Äù, and so I finally answered her question and
said ‚ÄúHalf-half‚Äù, using a gesture to reinforce the meaning.&lt;/p&gt;

    &lt;p&gt;The question was if I was a boy or a girl, which is a pretty common one when
I‚Äôve been overseas. She then apologised and said she didn‚Äôt mean to be rude,
and that she thought it was a totally fine thing to be different and not at
all a problem here, and I made sure she knew I didn‚Äôt mind the question at
all! It was pretty daring of her to just come over and ask; I think she and
her friends must‚Äôve been observing us two as much as we had been watching
them. It was a really nice exchange across cultures and generations.&lt;/p&gt;

    &lt;p&gt;(I only realised once home that I was wearing a &lt;a href=&quot;https://transjustice.org.au/&quot;&gt;Trans Justice
Project&lt;/a&gt; T-shirt underneath my coat! Missed
opportunity.)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Tomorrow we take a train trip out to Narva so I can renew my ID card, explore
there for a day, and then get back in time for an evening inspection of what
might be our future home. Fingers crossed :)&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Literate pickle</title>
   <updated>2024-04-03T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/04/03/literate-pickle</id>
    
     <link href="https://kivikakk.ee/2024/04/03/literate-pickle/"/>
     <content type="html">&lt;p&gt;I‚Äôve been deleting hundreds of accounts and cleaning up many more while
preparing for the move, and I found I have an npm account with one (1)
package, last published May 2012 (!): &lt;a href=&quot;https://www.npmjs.com/package/allium&quot;&gt;allium&lt;/a&gt;,
a parser for the &lt;a href=&quot;https://en.wikipedia.org/wiki/Cucumber_(software)#Gherkin_language&quot;&gt;‚ÄúGherkin‚Äù syntax&lt;/a&gt;
used to define Cucumber BDD tests, back when that was all the rage.&lt;/p&gt;

&lt;p&gt;The README captured by npm refers to the literate source code as once published
on GitHub Pages. That was long ago, but I figured it might be fun to look at
again. And it is! Have look: &lt;a href=&quot;https://f.hrzn.ee/allium/&quot;&gt;https://f.hrzn.ee/allium/&lt;/a&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Eesti keele abilised</title>
   <updated>2024-03-25T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/03/25/eesti-keele-abilised</id>
    
     <link href="https://kivikakk.ee/2024/03/25/eesti-keele-abilised/"/>
     <content type="html">&lt;p&gt;Here‚Äôs a little tool I‚Äôve made to help my partner and I while learning Estonian.
Very much nothing special, but I‚Äôll hopefully find more resources to add to it
over time!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://eka.kivikakk.ee&quot;&gt;Eesti keele abilised&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Previously on this topic: &lt;a href=&quot;https://kivikakk.ee/estonian/2016/04/18/estonian-morphology-guide-mirror.html&quot;&gt;Estonian Morphology Guide
(mirror)&lt;/a&gt;.
I no longer collect analytics on my site, but when I did it was consistently one
of the most-visited parts of it, presumably because the link broke at some
point. I‚Äôve just found its new canonical home, though, so I‚Äôve updated the
link!)&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>lottia notes</title>
   <updated>2024-01-03T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/01/03/lottia-notes</id>
    
     <link href="https://kivikakk.ee/2024/01/03/lottia-notes/"/>
     <content type="html">&lt;p&gt;I‚Äôve been writing notes on FPGA/digital design and Nix over at
&lt;a href=&quot;https://lottia.net/notes&quot;&gt;&lt;em&gt;lottia notes&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Comrak on Akkoma</title>
   <updated>2024-01-02T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2024/01/02/comrak-on-akkoma</id>
    
      <link href="https://lottia.net/notes/0006-comrak-on-akkoma.html"/>
      <content type="html">I've barely touched Elixir before. How hard could shoving a Rust dependency into it be?</content>
    
 </entry>
 
 <entry>
   <title>Jambalam</title>
   <updated>2023-09-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2023/09/18/jambalam</id>
    
      <link href="https://lottia.net/notes/0005-jambalam.html"/>
      <content type="html">Have it your way.</content>
    
 </entry>
 
 <entry>
   <title>Happy birthday!</title>
   <updated>2023-08-23T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2023/08/23/happy-birthday</id>
    
      <link href="https://lottia.net/notes/0004-happy-birthday.html"/>
      <content type="html">It's always your birthday!</content>
    
 </entry>
 
 <entry>
   <title>Nix revisited</title>
   <updated>2023-07-15T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2023/07/15/nix-revisited</id>
    
      <link href="https://lottia.net/notes/0003-nix-revisited.html"/>
      <content type="html">An unsystematic collection of thoughts while adopting Nix.</content>
    
 </entry>
 
 <entry>
   <title>Untangling cycles</title>
   <updated>2023-06-29T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2023/06/29/untangling-cycles</id>
    
      <link href="https://lottia.net/notes/0002-untangling-cycles.html"/>
      <content type="html">Wherein the author perceives time in multiple lights, simultaneously, and logic does too, but, uh, differently.</content>
    
 </entry>
 
 <entry>
   <title>Installing an HDL toolchain from source</title>
   <updated>2023-06-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2023/06/27/hdl-toolchain-source</id>
    
      <link href="https://lottia.net/notes/0001-hdl-toolchain-source.html"/>
      <content type="html">A fairly detailed guide on building and installing a gateware toolchain in a self-contained and repeatable way.</content>
    
 </entry>
 
 <entry>
   <title>DDR the second!!</title>
   <updated>2021-08-16T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2021/08/16/ddr-the-second</id>
    
     <link href="https://kivikakk.ee/2021/08/16/ddr-the-second/"/>
     <content type="html">&lt;p&gt;Two weeks gets incremental improvements.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/moreonenight2.jpg&quot; alt=&quot;More One Night score (AAA 97.13%)&quot; /&gt;
&lt;img src=&quot;/assets/post-img/badapple2.jpg&quot; alt=&quot;Bad Apple!! score (AAA 97.57%)&quot; /&gt;
&lt;img src=&quot;/assets/post-img/danceallnight2.jpg&quot; alt=&quot;DANCE ALL NIGHT score (AAA 98.55%)&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>DDR</title>
   <updated>2021-08-02T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2021/08/02/ddr</id>
    
     <link href="https://kivikakk.ee/2021/08/02/ddr/"/>
     <content type="html">&lt;p&gt;Not much to report lately.  DDR continues to be fun, though I think given these
timings I‚Äôm past due for replacing the control board in the pad so I can get
better than 8ms resolution on steps.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/moreonenight.jpg&quot; alt=&quot;More One Night score (AA 97.13%)&quot; /&gt;
&lt;img src=&quot;/assets/post-img/badapple.jpg&quot; alt=&quot;Bad Apple!! score (AAA 96.65%)&quot; /&gt;
&lt;img src=&quot;/assets/post-img/danceallnight.jpg&quot; alt=&quot;DANCE ALL NIGHT score (AAA 98.34%)&quot; /&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>vision</title>
   <updated>2021-06-23T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/kwasticat/2021/06/23/vision</id>
    
     <link href="https://kivikakk.ee/kwasticat/2021/06/23/vision/"/>
     <content type="html">&lt;p&gt;Today‚Äôs been hard. My autistic tendencies have flared up ‚Äî perhaps from
overworking myself these past few days ‚Äî and made communication with Miss I.
difficult.&lt;/p&gt;

&lt;p&gt;We cleared up heavy matters in the afternoon, but this evening I started to find
myself talking in loops again, until Isabelle finally interrupted me.&lt;/p&gt;

&lt;p&gt;Putting one hand on my knee and looking straight at me, she got my attention and
said plainly: ‚ÄúI ban you from speaking.‚Äù&lt;/p&gt;

&lt;p&gt;For the next ten minutes, I felt my mind slowly unspool.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>christening</title>
   <updated>2021-06-22T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/kwasticat/2021/06/22/christening</id>
    
     <link href="https://kivikakk.ee/kwasticat/2021/06/22/christening/"/>
     <content type="html">&lt;p&gt;I‚Äôve not known myself to be the kind of person to crave submissive humiliation
or punishment. But as I made progress in what you might call my personal
&lt;a href=&quot;https://slaveshae.wordpress.com/2021/04/26/finding-your-submissive-self/&quot;&gt;submissive inventory&lt;/a&gt;,
others‚Äô writings ‚Äî and their emphasis on the importance of these aspects ‚Äî led
me to wonder whether or not I‚Äôve ever even quite experienced these. How can you
know if you want something or not if you‚Äôve never felt it? I set to find out.&lt;/p&gt;

&lt;p&gt;Miss Isabelle set me the goal of not picking at or biting my fingernails.
This is truly harder than you might expect ‚Äî despite being a grown woman, it‚Äôs
something I‚Äôve struggled with my whole life. No amount of encouragement, reward,
or disincentive successfully turned me off the habit as a child or teenager,
and repeated attempts later in life always ended in lasting failure. I much
&lt;em&gt;prefer&lt;/em&gt; having long nails, but there‚Äôs three decades of neural pathways to
fight against.&lt;/p&gt;

&lt;p&gt;We‚Äôre evaluating my performance on a weekly basis, and at the end of the first
week she‚Äôd caught me biting or picking at my fingernails two or three times. I
really enjoy pain, so this was always going to be an uphill battle, but Isabelle
wanted to determine if a regular spanking (with implements) might have the
desired effect anyway, if there was enough force and no warm up.&lt;/p&gt;

&lt;p&gt;What &lt;em&gt;is&lt;/em&gt; the desired effect? When I pick at or bite my nails, it‚Äôs not a
decision I make consciously; it happens entirely habitually, usually amplified
when I‚Äôm feeling anxious or unsettled. (There is probably some attachment model
or Freudian lens to apply here.) The punishment experience needs to be aversive
and &lt;em&gt;felt&lt;/em&gt; deeply enough that it sinks into my subconscious that this is
something we need to avoid; it needs to be pre-thought if it‚Äôs going to alter a
behaviour which itself is pre-thought.&lt;/p&gt;

&lt;p&gt;We found out pretty quickly that this kind of pain was not going to have an
impact. I‚Äôd recently had an experience where a particular kind of beating had
gotten me close to tears, and I feel like breaking down in tears is a signal
that something‚Äôs happening inside. It seemed like we couldn‚Äôt repeat that here.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The next week went very well for me. Isabelle was talking up the reward I‚Äôd be
getting for preserving my nails as we neared Sunday evening, but in the car that
morning as we talked her eyes suddenly widened at me, and I realised what I was
already doing.&lt;/p&gt;

&lt;p&gt;It so happened we were going to a kink store that afternoon, and while I
looked at the things I was there for, she busied herself looking at the hot
wax candles. I find wax a bit hard to deal with ‚Äî the sharp heat can be a lot,
especially as the body warms ‚Äî and have a fresh memory of two enthusiastic
Dommes dripping a candle each on me at the same time.&lt;/p&gt;

&lt;p&gt;I realised something was up when we went to pay and the girl behind the counter
asked, ‚Äúyou know this one is extra hot, right?‚Äù&lt;/p&gt;

&lt;p&gt;Isabelle laughed. ‚ÄúOh yes, I know. How much hotter is it?‚Äù&lt;/p&gt;

&lt;p&gt;The cashier looked at me. ‚ÄúIt certainly &lt;em&gt;feels&lt;/em&gt; hotter. It‚Äôs meant to be about 4
degrees more.‚Äù&lt;/p&gt;

&lt;p&gt;I must‚Äôve visibly deflated. At the time I didn‚Äôt quite know how obvious the
arrangement was, but in retrospect, Isabelle was confident, and I was wearing a
collar. Welp.&lt;/p&gt;

&lt;p&gt;That evening after dinner, she had me set a towel out on the floor of the living
room and fetch a lighter.&lt;/p&gt;

&lt;p&gt;‚ÄúI‚Äôm going to punish you now, for biting your nails. You were doing so well,
too, but I need you to know that my orders are to be followed. Take off all your
clothes, lie down on your front, and close your eyes.‚Äù&lt;/p&gt;

&lt;p&gt;I complied.&lt;/p&gt;

&lt;p&gt;I could hear her unwrapping the new candle, and I started to tremble.&lt;/p&gt;

&lt;p&gt;‚ÄúThis is going to be very hot. Tell me if it‚Äôs too much to bear.‚Äù&lt;/p&gt;

&lt;p&gt;Quietly, I started to panic a little bit. I heard her flick the lighter. I
waited what seemed like minutes but was probably less than ten seconds.&lt;/p&gt;

&lt;p&gt;‚ÄúIt takes a bit to melt. Okay, here it comes.‚Äù&lt;/p&gt;

&lt;p&gt;The first drip hit my back, searing hot. Before I could register it fully, the
next drip hit, and then the next, and I whimpered, trying to keep it together.&lt;/p&gt;

&lt;p&gt;She didn‚Äôt let up, and I could feel my body trembling, tears coming fully
unbidden. I‚Äôd never cried from wax before, but this was all so much; the heat so
much harder than anything I‚Äôd had to endure before.&lt;/p&gt;

&lt;p&gt;It can‚Äôt have been more than a minute or two before she stopped. I was shaking
from the tears, and ‚Äî I kind of can‚Äôt believe this ‚Äî but I can feel them coming
on again now, writing this up days later. I guess it really did sink in.&lt;/p&gt;

&lt;p&gt;It‚Äôs all the more surprising because it was at that point that she came down
to my level and brought the candle she used into view. It was purple. One she‚Äôs
used on me many times before. The new candle ‚Äî black ‚Äî was sitting proudly on
the coffee table, untouched.&lt;/p&gt;

&lt;p&gt;I laughed hard.&lt;/p&gt;

&lt;p&gt;She did end up trying the new, ‚Äúextra hot‚Äù candle on me after that, and I
barely felt it! If anything, it felt less hot than the regular purple one. Maybe
post-fear endorphins masked the pain? In a feigned huff, Isabelle declared that
next time we were back at the kink store she‚Äôd report back to the girl I was
‚Äútoo much of a slut to get hurt by it‚Äù.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I‚Äôve noticed, in the days since, a tiny moment of time opening up, a breath of
consciousness ‚Äî the instant when one of my fingernails is pressed to another,
before any damage is done. The desired effect.&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>flashes: end</title>
   <updated>2021-06-19T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/19/flashes-end</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/19/flashes-end/"/>
     <content type="html">&lt;p&gt;flashes: end&lt;/p&gt;

&lt;p&gt;Quoting ‚Äú(un)monitored‚Äù:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I have no idea if anyone reads this. It &lt;em&gt;is&lt;/em&gt; linked from one of our blogs, but you have to look to even find that blog, let alone notice the link. [‚Ä¶] On the other hand, &lt;em&gt;because&lt;/em&gt; of this, I am able to write more openly. If I knew I had any kind of readership at all, I might not write some things, or might write differently.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, the spell was broken; the wave function collapsed; the superposition observed; the duality reduced to one.  This girl always worked better in the in-betweens.&lt;/p&gt;

&lt;p&gt;A reader reached out and, though I was extremely flattered at first, now I can‚Äôt feel the same way about writing here.&lt;/p&gt;

&lt;p&gt;I was never meant to be someone in your story‚ÄîI was meant to be an exhibit of open life, to be appreciated, not touched.&lt;/p&gt;

&lt;p&gt;Godspeed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=-ZuyB-S-O9Q&quot;&gt;Dollscythe - Flashes (Extended)&lt;/a&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>dasein V</title>
   <updated>2021-06-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/18/dasein-v</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/18/dasein-v/"/>
     <content type="html">&lt;p&gt;For the third time in ten days, C has come over.&lt;/p&gt;

&lt;p&gt;It‚Äôs 1am and I‚Äôm sitting alone on my bed, in my slave‚Äôs quarters, such as they are.&lt;/p&gt;

&lt;p&gt;It‚Äôs been wholesome, honestly; we ordered food delivery and it never came, so the three of us went out for what was by then a very late dinner. N suddenly wanted ice cream, and it turned out we were 20 metres away from a great vegan gelato and ice cream place, so we had that to follow. Then, on the way back, a surprise drug test for the driver from the local police! Even though I don‚Äôt use cannabis regularly, and what I do use is a legitimate prescription, there was still some nerves wracked and a feeling of the three of us bonding while waiting for that result. Then we were on our way.&lt;/p&gt;

&lt;p&gt;Perhaps less wholesome: I‚Äôve been fucked while wearing a &lt;em&gt;straitjacket&lt;/em&gt; now. N took photos and it is so goddamned hot. We look like we‚Äôre right out of some amazing kinky queer German porn. God damn.&lt;/p&gt;

&lt;p&gt;A wonderful night, and I‚Äôm so glad C was able to stay over.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</title>
   <updated>2021-06-17T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/17/—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/17/%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5/"/>
     <content type="html">&lt;p&gt;I really do struggle to maintain a positive connection with people who seem to idle as their default.&lt;/p&gt;

&lt;p&gt;This is at least partly a failing of mine; for so many people they simply don‚Äôt have the option of study or paid work. I &lt;em&gt;consciously&lt;/em&gt; recognise that many of the opportunities I‚Äôve had are privileged ones, lucky, or both, but I wonder if subconsciously I don‚Äôt factor that in enough and still think ‚Äî somewhere deep down ‚Äî ‚Äúwell, I dealt with childhood trauma, an abusive marriage, a full-blown nervous breakdown, rape, bipolar/borderline diagnosis, and still have managed to be successful and independent since I turned 18, so why don‚Äôt they?‚Äù&lt;/p&gt;

&lt;p&gt;Again, I don‚Äôt like to think I believe that, but nonetheless people who have no life direction generate something like repulsion in me, so much so that my last major falling out with a friend was ‚Äî on my part ‚Äî kinda due to their having no goals or purposes in life.&lt;/p&gt;

&lt;p&gt;This ties in a little bit to generally wanting to be led, in my relationships. If someone doesn‚Äôt even lead their own, I don‚Äôt trust or respect them enough to have them lead mine; heck, not even enough to let them lead it the tiny bit that a normal, balanced friendship or relationship inevitably entails between two people, let alone as much as I‚Äôd like to.&lt;/p&gt;

&lt;p&gt;I think I want to be led because, generally speaking, I have my shit very sorted out. I am happy on my own, take care of myself fully, and can be left to my own devices indefinitely. I have my interests and I engage in communities relating to them comfortably. So if I‚Äôm going to be close to someone, it‚Äôs not really because I have a lot of things I‚Äôve been waiting to show someone, or because I‚Äôve been dying to let someone in close. I already do those things ‚Äî such is the spot on the aro-spectrum I sit, where my proclivity for openness and truthfulness means I have closer and more romantic connections with friends than many do with their romantic partners.&lt;/p&gt;

&lt;p&gt;Instead, it‚Äôs because I want them to show me and take me places in the abstract space of (relational) possibility; to put me somewhere in their world and let me play into the role they‚Äôve marked out for me. And to believe that‚Äôs possible, I need to see them starting with themselves first; to see them actually lead a role in a world that‚Äôs their own.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>ÂëΩ‰ª§</title>
   <updated>2021-06-16T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/16/ÂëΩ‰ª§</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/16/%E5%91%BD%E4%BB%A4/"/>
     <content type="html">&lt;p&gt;Exhausted by Comirnaty #2, I‚Äôm on the couch in the living room today as N works at the desk nearby.&lt;/p&gt;

&lt;p&gt;At some point she got horny and commanded me over to take care of her. I‚Äôm a little impressed by her audacity, ordering me specifically as a sex slave while I‚Äôm nominally ‚Äúsick‚Äù enough not to be working today.&lt;/p&gt;

&lt;p&gt;Later she mentioned in passing that it was actually C‚Äôs idea to have me do that. Jesus.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>dasein IV</title>
   <updated>2021-06-15T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/15/dasein-iv</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/15/dasein-iv/"/>
     <content type="html">&lt;p&gt;We were visited by C again! Twice in five days. It would appear she‚Äôs rather keen. Some haphazard notes:&lt;/p&gt;

&lt;p&gt;This might be the most immature thing in the world, but after she left ‚Äî I got back from vaccine appointment #2 around 5pm, we all started playing almost immediately, and she left by quarter-to-midnight ‚Äî I put this on the TV:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=lQlIhraqL7o&quot;&gt;https://www.youtube.com/watch?v=lQlIhraqL7o&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can‚Äôt help myself sometimes, and ending a multiple-year dry spell by being fucked by your partner/Domme‚Äôs toppy friend in front of her? Yep. I‚Äôm gonna call that one a win.&lt;/p&gt;

&lt;p&gt;Incidentally, the collar never did come off after C visited the first time. Previously it‚Äôd stimmed me in a weird and bad way and it was impossible to fall asleep; it‚Äôd start feeling like the metal was too heavy on my neck when my head was on the pillow and I‚Äôd start to get into a weird anxiety loop. I was so tired that night that I just passed out near as soon as I lay down.&lt;/p&gt;

&lt;p&gt;Haven woken up once with it still on (and thus serving as a physical demonstration to my panicky subconscious that no, this won‚Äôt somehow block an artery to your head while you sleep and kill you), I‚Äôve not needed to remove it since. I might ask at some point that Miss takes the key from me at last, and really relinquish that.&lt;/p&gt;

&lt;p&gt;To review thoughts about whether these experiences will shift anything in me ‚Äî I think so far the answer has been no. C is not particularly experienced in dominance or the psychological aspects of kink, and so it ends up being just the three of us having fun, with me being distinguished as ‚Äúthe one who can take absolutely inordinate amounts of pain‚Äù (and now fucking). I‚Äôm not complaining, but it does leave my longing for a more extreme submission still unattended to.&lt;/p&gt;

&lt;p&gt;I‚Äôm worn out!&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>cartita</title>
   <updated>2021-06-15T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/15/cartita</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/15/cartita/"/>
     <content type="html">&lt;p&gt;Words fail to capture how delighted I was to receive a letter today.&lt;/p&gt;

&lt;p&gt;Thank you &amp;lt;3 x&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>–Ω—É–∂–Ω–æ</title>
   <updated>2021-06-13T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/13/–Ω—É–∂–Ω–æ</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/13/%D0%BD%D1%83%D0%B6%D0%BD%D0%BE/"/>
     <content type="html">&lt;p&gt;Someone who wants to take me out of sheer lust.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>–æ–±—ä–µ–∫—Ç</title>
   <updated>2021-06-11T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/11/–æ–±—ä–µ–∫—Ç</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/11/%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82/"/>
     <content type="html">&lt;p&gt;Well.&lt;/p&gt;

&lt;p&gt;It turns out being constantly stimmed on my back makes me a catty bitch liable to meltdown frequently. This morning things got too much and I started being unreasonable at N, and yet managed to keep enough presence of mind to tell her that her taking control of the situation could remedy things quickly.&lt;/p&gt;

&lt;p&gt;One of the objects of my unreasonableness was the kettle (and its not being filled up), and, in view of my having just filled it up ‚Äî it‚Äôs like a 3 or 4 litre urn-type deal ‚Äî she ordered me to go into the kitchen and watch it until it boiled.&lt;/p&gt;

&lt;p&gt;The kettle has the decency to show the current temperature of its contents and a minute-granularity estimate of how long it‚Äôll take until it‚Äôs boiled. Seeing that ‚Äú14‚Äù on the display as I entered the room really added something to the experience.&lt;/p&gt;

&lt;p&gt;It did the trick more perfectly than I could‚Äôve anticipated.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>dasein III</title>
   <updated>2021-06-10T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/10/dasein-iii</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/10/dasein-iii/"/>
     <content type="html">&lt;p&gt;Body‚Äôs in struggletown.&lt;/p&gt;

&lt;p&gt;Feels like I‚Äôm in full-on repair mode. Upper back still feels white hot; N‚Äôs focus there was perhaps overenthusiastic. The constant stim has also made me feel a bit less people-capable than usual, at least irl. Tired!&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>dasein II</title>
   <updated>2021-06-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/09/dasein-ii</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/09/dasein-ii/"/>
     <content type="html">&lt;p&gt;My head is still swimming in endorphins, an hour later.&lt;/p&gt;

&lt;p&gt;It was three full hours non-stop, and then a short lull, and then half an hour more. I am more thoroughly rekt than I‚Äôve been in.. years.&lt;/p&gt;

&lt;p&gt;And glowing.&lt;/p&gt;

&lt;p&gt;C exceeded my expectations ‚Äî the stamina of that girl! ‚Äî and I think it definitely drew N out as well. The actual domination aspects were light but still felt; a few times each they pulled me up on address or responsiveness and it was quite delightful. C has a very cute face yet pulls off ‚Äúhot and in control‚Äù almost effortlessly.&lt;/p&gt;

&lt;p&gt;It was also just so good to be one of three girls in a bed together again. This was N‚Äôs and my first time doing something together with another, too. As expected, no problems there. I think our comfort with each other and in the relationships we hold with each other is at an all-time high. I could just relax into the pain, the submission, the sometimes-brutality of it.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>dasein I</title>
   <updated>2021-06-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/09/dasein-i</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/09/dasein-i/"/>
     <content type="html">&lt;p&gt;It‚Äôs time to put some stuff right out there. I want to track exactly what happens, internally, emotionally, spiritually?, and for that I need to get literal so tomorrow-me doesn‚Äôt reconstruct now out of later‚Äôs emotional residues.&lt;/p&gt;

&lt;p&gt;Miss N‚Äôs current bestie/intimate partner C is coming over tonight, and what was alluded to in „Äå„Å§„ÅÑ„Åü„Äç (2021-06-05) will come to some sort of fruition; the three of us are to have a discussion regarding terms, desires, and limits, regarding N ‚Äúloaning her sub‚Äù to C. Which is to say, me. Thereafter some actualisation of what was discussed. N and I have been productively working on defining ourselves with each other, finding our way to common terminology, and it feels like we‚Äôre similarly oriented. She‚Äôs keen to demonstrate that she‚Äôs an M-type of action and not just words, and well, here we are, perhaps 4 hours out from C‚Äôs arrival.&lt;/p&gt;

&lt;p&gt;She collared me this morning and made it clear she wouldn‚Äôt be removing it until after C had gone home. So I‚Äôve been sitting here today accompanied by the sense that this thing around my neck won‚Äôt come off until my being someone‚Äôs slave ‚Äî someone‚Äôs property, transferrable and all ‚Äî finds itself more reified than I could‚Äôve imagined not long ago.&lt;/p&gt;

&lt;p&gt;I wonder if this will shift something in me. What will it be like to be put under the control of someone I‚Äôve never been intimate with before? If it were someone I‚Äôd been close with before, I think it might not have such an impact, but the closest I‚Äôve been with C is hugging, twice. For someone like that to go full throttle on me would be unreal. I‚Äôm imagining a slave-y kind of headspace might result, but it‚Äôs a vague sensation. Perhaps this will make it more real.&lt;/p&gt;

&lt;p&gt;I wonder if this will shift something in her. What will it be like for her to see someone else using the authority she‚Äôs delegated to them; to see how far can be taken something she herself has? Will it be inspiring?&lt;/p&gt;

&lt;p&gt;It‚Äôs possible nothing will come of it ‚Äî maybe C will get cold feet. Or perhaps just not tonight; she might not be feeling it. (Word is she is usually feeling it, though.) Or perhaps she won‚Äôt know what to do with me. (If she‚Äôs feeling it, there should be at least one obvious activity.)&lt;/p&gt;

&lt;p&gt;My indefatigable pessimism aside, what seems more likely than not is that tonight the three of us will have a talk after dinner, and then I‚Äôll end up being ‚Äî as N so delicately worded it ‚Äî 2v1‚Äôd in her bedroom. What exactly that will entail physically I‚Äôm not sure, but apparently C is game to fuck, and well, I‚Äôm game to be fucked. Likewise some intense pain. The 3 person scenario is apparently just for the first time, so everyone can be comfortable with a familiar presence.&lt;/p&gt;

&lt;p&gt;N seems to envision that in future this‚Äôll mean when C comes to hang out, the two of us can retire to the bedroom for a bit while she plays games so that C can get what she needs out of her system on me. This is entirely welcome news.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>„Å§„ÅÑ„Åü„Å£„Å¶</title>
   <updated>2021-06-08T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/08/„Å§„ÅÑ„Åü„Å£„Å¶</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/08/%E3%81%A4%E3%81%84%E3%81%9F%E3%81%A3%E3%81%A6/"/>
     <content type="html">&lt;p&gt;That germinated!&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>(un)monitored</title>
   <updated>2021-06-08T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/08/(un)monitored</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/08/(un)monitored/"/>
     <content type="html">&lt;p&gt;There‚Äôs a peculiar duality afforded by a gemlog ‚Äî especially one I don‚Äôt host.&lt;/p&gt;

&lt;p&gt;I have no idea if anyone reads this. It &lt;em&gt;is&lt;/em&gt; linked from one of our blogs, but you have to look to even find that blog, let alone notice the link. Then you have to work out how to follow a gemini:// url. I assume most don‚Äôt. Accordingly, I may well be just using this as a barely-public private journal. It is technically open, and maybe multiple people subscribe and read what I write. Maybe someone will stumble upon it someday and read the whole backlog. Maybe it‚Äôs never been seen by anyone and never will. There are no logs for me to access, no Referers or User-Agents to analyse for signs of life. Even Lia‚Äôs blog gets a few unique non-bot readers a day on average. This one? It is unknowable.&lt;/p&gt;

&lt;p&gt;On the one hand, I repeatedly get the niggling sensation that writing here is a kind of pointlessness. I could just write in Notes.app, and sometimes do (though so far I‚Äôve always used it as a staging for drafts that end up here ‚Äî don‚Äôt want a downed Safari tab to destroy my work, especially on mobile). The local niceties are that you can call a piece done, which a note in Notes.app never really is, and that I can mirror them into a git repository programmatically for my own archival purposes. Notes.app is not very instrumentable.&lt;/p&gt;

&lt;p&gt;On the other hand, &lt;em&gt;because&lt;/em&gt; of this, I am able to write more openly. If I knew I had any kind of readership at all, I might not write some things, or might write differently. It is completely plausible that this will never be seen, and so I can say whatever I want to myselves. It is freeing despite-of-slash-because-of the potential pointlessness. I get the impression I am baring my true self to the world, perhaps, because I am possibly not doing that at all.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>„Å§„ÅÑ„Åü</title>
   <updated>2021-06-05T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/05/„Å§„ÅÑ„Åü</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/05/%E3%81%A4%E3%81%84%E3%81%9F/"/>
     <content type="html">&lt;p&gt;That‚Äôs it!&lt;/p&gt;

&lt;p&gt;The feeling of something being beyond you; of it being out of your hands and knowledge. The distance itself‚Äî&lt;/p&gt;

&lt;p&gt;of not only being aligned.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>aside</title>
   <updated>2021-06-05T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/05/aside</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/05/aside/"/>
     <content type="html">&lt;p&gt;Hope doesn‚Äôt feel like it exists within my phenomenological horizon any more.&lt;/p&gt;

&lt;p&gt;What lies in that direction only feels like a false, baseless optimism, which I naturally eschew.&lt;/p&gt;

&lt;p&gt;Probably not the healthiest, but that‚Äôs the truth of it. I haven‚Äôt known how to hope in a long time. It‚Äôs hard to explain how thorough that is. I get by without it, and things are generally okay, but it definitely is a thing that alters my experience with others.&lt;/p&gt;

&lt;p&gt;Not to say any worse of the referent of last entry. That is just nice. But it doesn‚Äôt mean I could choose to consider the actual fulfilment even the slightest bit more likely, out of some ardent desire that overturns this exacting algorithm of ‚Äúrealistic optimism‚Äù. I don‚Äôt let myself hope, wouldn‚Äôt know how to if I wanted; it‚Äôs just fun to consider as one unlikely result among many.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>mikatralia</title>
   <updated>2021-06-04T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/06/04/mikatralia</id>
    
     <link href="https://kivikakk.ee/flashes/2021/06/04/mikatralia/"/>
     <content type="html">&lt;p&gt;triad feels are so strong. what is it about them? there‚Äôs something about the pull and push of being with two different people who are also with each other.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;the contrast of two as opposed to the undifferentiated wholeness of one [We feel this internally!]&lt;/li&gt;
  &lt;li&gt;being able to appreciate their dyadic love [Like compersion but from both sides at once, to both sides at once.]&lt;/li&gt;
  &lt;li&gt;knowing you‚Äôve all decided on something strongly enough together
    &lt;ul&gt;
      &lt;li&gt;that involves an element of self-sacrifice?&lt;/li&gt;
      &lt;li&gt;[Like, any two people can decide to be in a dyadic relationship, but to agree on a triad means all three think there‚Äôs something worth devoting oneself so completely to, even though ‚Äòa third of it‚Äô is not about you, or at least doesn‚Äôt involve you directly. It is all of you, even if sometimes it is not you.]&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;it‚Äôs unusual. like trans love or incest love, it‚Äôs remarkable and breathtaking because it is so opposed to norms.
    &lt;ul&gt;
      &lt;li&gt;[Maybe we‚Äôre just sluts for being different, as hard as we can? It would explain the trans, poly, plural.] is there a cf. here? i think there‚Äôs a cf. here. cf. bi/pan, furry, which are hard to not want to do. i‚Äôd have to be trans to be trans, but being pan or a furry is just the sensible thing.&lt;/li&gt;
      &lt;li&gt;note for anyone reading at home: no, alas, i‚Äôm not incestuous, i just have a normal, tumblr-level amount of feelings around incest in fiction. like, whatever jaime and cersei had going, it was strong enough that they committed a huge taboo to do it. in my mind, that kind of resolve puts you on a whole different level, and what‚Äôs important is it isn‚Äôt about any individual‚Äôs resolve, but about their joint resolve.
        &lt;ul&gt;
          &lt;li&gt;[Triads are like that. Joint resolve, but this time involving one extra node in the network. What‚Äôs the maths here? That‚Äôs like three times as impressive or somethin.]&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;i keep thinking about enumerating past experiences, past glimpses of these feelings before, but i don‚Äôt want to live in the past. suffice to say, there was K and S, K and E, and later J and D. (some weird brushes with it with D and M, M and J, J and A, and N and L ‚Äî these eight all no relation.) [Writing these all out does make me think p e r h a p s we do have a little more experience than average.] all such different feelings.&lt;/p&gt;

&lt;p&gt;what i‚Äôd be hoping for out of next time is something closer to how J and D was with me‚Äîa triad entered into intentionally, all three finding different things in each other to adore. the mika+atra+kudelia style isn‚Äôt bad at all either‚Äîa shared common love of a hinge that progresses into full tertiacy.&lt;/p&gt;

&lt;p&gt;[So. What do we already have goin then? You have your certain love for N, and we separately have an actually ethereal, transcendent, somewhat sisterly (cough) bond.]&lt;/p&gt;

&lt;p&gt;do we approximate any of what we like so much in mika+atra+lia by differentiating your bond to N? as an aside, there‚Äôs one reason for liking mikatralia so much: we can really identify with all three of them &amp;lt;3_&amp;lt;3&lt;/p&gt;

&lt;p&gt;[a-hem. Mmaybe? What does that look like? What do we feel like when we make more of an effort to differentiate like that? Do we.. end up feeling more for each other too?]&lt;/p&gt;

&lt;p&gt;really puts a spin on ‚Äúi‚Äôm my own primary,‚Äù as quoted from polyland, connecting with what led to it about co-primaries. [This all found while trying to find a better word for ‚Äòtertiacy‚Äô, mind you.] we kind of already are each other‚Äôs co-primaries, but strengthening the bonds that run separately through you might do us all good.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;is&lt;/em&gt; it maybe just a desire for novelty, the hedonistic treadmill? i dunno. i don‚Äôt think so. seeing mikatralia definitely stirs some specific feelings. perhaps it‚Äôs just felt so strongly because it‚Äôs a particular kind of extreme non-conformity we‚Äôve achieved in parts here and there before? or perhaps it‚Äôs because it‚Äôs about love, specifically, and that is something that is very near to our heart.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>lustre</title>
   <updated>2021-05-31T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/31/lustre</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/31/lustre/"/>
     <content type="html">&lt;p&gt;Not feeling it lately. Some unsorted thoughts:&lt;/p&gt;

&lt;p&gt;A couple times now I‚Äôve asked her to make me feel, to make me &lt;em&gt;really&lt;/em&gt; feel. Like I‚Äôm owned; like I‚Äôm property; like I‚Äôm hers; like I belong. She keeps demurring, saying she doesn‚Äôt want to ‚Äúrush to the end‚Äù, as if her making me feel that once would mean I actually would assent to becoming her thing.&lt;/p&gt;

&lt;p&gt;I‚Äôve tried to say a few times now‚Äîafter she repeated the line about not wanting to rush‚Äîthat I‚Äôm in no rush myself. I don‚Äôt know how to say the more blunt thing: that, if I was asked to make a decision now, I‚Äôd turn her down. It‚Äôs not a desire to rush to the end; I need to know if she‚Äôs capable of it to even know whether I want to continue, let alone increase the commitment!&lt;/p&gt;

&lt;p&gt;As it stands we‚Äôre trialling, and I am‚Äîhonestly speaking‚Äînot very satisfied. Even the small amounts of play we have done recently, the energy‚Äôs been off. I guess she feels like it is going okay? And that itself is a cause for concern and something to be addressed. Okay.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>–≥—Ä—ë–∑–∞</title>
   <updated>2021-05-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/27/–≥—Ä—ë–∑–∞</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/27/%D0%B3%D1%80%D1%91%D0%B7%D0%B0/"/>
     <content type="html">&lt;p&gt;A charged dream of Dragon.&lt;/p&gt;

&lt;p&gt;Keen for something.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>„Åì„ÅÆ„Åæ„Åæ„Åò„ÇÉ</title>
   <updated>2021-05-26T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/26/„Åì„ÅÆ„Åæ„Åæ„Åò„ÇÉ</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/26/%E3%81%93%E3%81%AE%E3%81%BE%E3%81%BE%E3%81%98%E3%82%83/"/>
     <content type="html">&lt;p&gt;„ÉÄ„É°„Åã„Å™Ôºü&lt;/p&gt;

&lt;p&gt;„ÅÇ„Åæ„Çä‰ºù„Åà„Å¶„Å®„Å©„Åë„Å™„ÅÑ„Åß„Åç„Å™„ÅÑ„ÄÅÊ∑±„ÅÑÊ∞óÊåÅ„Å°„ÅØ„ÄÇ&lt;/p&gt;

&lt;p&gt;Ëá™ÂàÜ„ÅÆ„Åü„ÇÅ„Å´„ÄÅ„ÇÇ„Å£„Å®Êé¢„Åó„Å´Ë°å„Åè„Çì„Å†„ÄÇ&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>various</title>
   <updated>2021-05-24T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/24/various</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/24/various/"/>
     <content type="html">&lt;p&gt;Went to high tea for our anniversary (both quite ‚Äúin role‚Äù, too), spent both days of the weekend just lying on the grass in a park reading phenomenology ‚Äî a rare weekend of sunny days ‚Äî and today, a first dose of BNT162b2.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>iraira</title>
   <updated>2021-05-19T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/19/iraira</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/19/iraira/"/>
     <content type="html">&lt;p&gt;Feeling a bit angry today.&lt;/p&gt;

&lt;p&gt;Irritated, annoyed, moody. I‚Äôm coming to the end of my progesterone cycle, and just as well. I feel a lot of it directed at her but I‚Äôm not certain how much is warranted.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>–æ—Ç—á—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å</title>
   <updated>2021-05-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/18/–æ—Ç—á—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/18/%D0%BE%D1%82%D1%87%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C/"/>
     <content type="html">&lt;p&gt;There‚Äôs a curious detachment that arises out of this experience.&lt;/p&gt;

&lt;p&gt;I noticed it first when I wore almost nothing to the queer rave, though at the time I ascribed it to the natural high‚Äîof being out for the first time in years, of trying something a bit daring, of submitting in a public place. (And what a high it was, make no mistake.)&lt;/p&gt;

&lt;p&gt;Yesterday I wore what could only be called a servant‚Äôs uniform, or perhaps even a seneschal‚Äôs; it was absolutely not vanilla. And we went out at lunch time, to the post office, to get lunch, to take care of some medical appointments. This is a full-body uniform‚Äîin no way titillating, or anything like that, but nonetheless very conspicuous‚Äîand I had no feelings about it. I chose to wear it as part of my submission for the day, and then we were heading out, so I wore it out. I don‚Äôt even know if I attracted any glances or looks for wearing it; it wasn‚Äôt on my mind.&lt;/p&gt;

&lt;p&gt;If someone looked at me, they weren‚Äôt really looking at &lt;em&gt;me&lt;/em&gt;, just a presentation of me. While I dress to communicate certain things, this.. hardening of my exterior, as I learn to give up my ego, means that what people say or make of those things don‚Äôt say anything about me. It‚Äôs strange.&lt;/p&gt;

&lt;p&gt;Similarly, the behavioural modification inherent in referring to someone previously close-and-same as ‚ÄúMiss‚Äù in deference, habitually, instinctively, might have once made me feel.. I don‚Äôt know, self-conscious? Or something? But when it comes as part of submission, it‚Äôs just another part of how I choose to yield, and thus doesn‚Äôt feel like a hit to me.&lt;/p&gt;

&lt;p&gt;I feel like I need to take some care here not to detach so completely that my submission doesn‚Äôt arise from my own core. I don‚Äôt think that‚Äôs what‚Äôs happening ‚Äî I think instead I am perhaps learning some humility? But it‚Äôs clear, writing this out, that there is a risk that I could shear away from this and wind up fragmented. Need to concentrate my selves.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>inscrutability II</title>
   <updated>2021-05-12T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/12/inscrutability-ii</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/12/inscrutability-ii/"/>
     <content type="html">&lt;p&gt;From the inscrutability of dreams to that of a Master or Mistress, huh?&lt;/p&gt;

&lt;p&gt;Allowing yourself to follow a path that‚Äôs been opened up for you; not demanding to understand motives.. funny to see this written so soon after ‚Äòocclusion‚Äô.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/flashes/2021/04/06/inscrutability&quot;&gt;inscrutability&lt;/a&gt;&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>tumari</title>
   <updated>2021-05-11T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/11/tumari</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/11/tumari/"/>
     <content type="html">&lt;p&gt;While doing our grocery shopping for the week, Mistress picked some recipes rather arbitrarily.&lt;/p&gt;

&lt;p&gt;A nice looking bolognese (vegan), which required I go to the bottle shop after work to fetch a suitable wine for cooking.&lt;/p&gt;

&lt;p&gt;I started cooking proper at 5.30pm; a slight pause to make up some parmesan (vegan), receive the grocery delivery, learn how to use a Swiss army knife‚Äôs corkscrew to open the bottle.&lt;/p&gt;

&lt;p&gt;Turns out mincing half a kilo of mushrooms takes some time.&lt;/p&gt;

&lt;p&gt;All told it‚Äôs quarter to 9pm and dinner is nearly done. I remarked to Miss how late it had gotten, and‚Äîperhaps to my surprise‚Äîshe said, ‚Äúnext time you‚Äôll be quicker!‚Äù&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>kekkyoku</title>
   <updated>2021-05-11T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/11/kekkyoku</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/11/kekkyoku/"/>
     <content type="html">&lt;p&gt;All I wanted was to be someone‚Äôs property. It really has always been that simple. Ugh!&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>sequencer</title>
   <updated>2021-05-10T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/10/sequencer</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/10/sequencer/"/>
     <content type="html">&lt;p&gt;I‚Äôm finding, more and more, that I discover things about myself in the process of serialising my consciousness into words.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Those words formed themselves without my input&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Huh. Who knew.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It seems to me that, as long as I keep writing, keep the channel of my being open, keep making myself vulnerable (unto what? the world itself?), discovery will continue.&lt;/p&gt;

&lt;p&gt;(And so it happens here; the first line originally came out as ‚Äú[‚Ä¶] that I discover things about them [‚Ä¶]‚Äù, and I am not fully sure how to understand it, other than to accept that, while in many ways a merging of identities is at play in this acceptance of my submissive, slave-ish self, my reflexive knowledge still very much applies the lens of a third party.)&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>title I</title>
   <updated>2021-05-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/09/title-i</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/09/title-i/"/>
     <content type="html">&lt;p&gt;Seneschal.&lt;/p&gt;

&lt;p&gt;This can only be the first of so many titles, I take it.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>excerpt</title>
   <updated>2021-05-08T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/08/excerpt</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/08/excerpt/"/>
     <content type="html">&lt;p&gt;Motivations for Service&lt;/p&gt;

&lt;p&gt;Why bother to serve? Why do s-types do it? Besides, of course, ‚Äú‚Ä¶because it‚Äôs what subs/slaves do, so I‚Äôm doing it.‚Äù? In watching and talking to s-types for many years, we‚Äôve discerned that there seem to be three basic types of motivation for service. We‚Äôre calling them Transactional, Devotional, and Positional, and we‚Äôll discuss each of them separately.&lt;/p&gt;

&lt;p&gt;However, as you read this, it‚Äôs important to keep in mind that each person is a complicated mix of motivations. Even if those motivations might fall into three categories, people don‚Äôt. Our motivations may shift from person to situation to activity; we may manifest any of these at various times. These categories are presented so that people can have words for why they do things, and perhaps identify if one of these is more dominant than others in their personality.&lt;/p&gt;

&lt;p&gt;Transactional Service&lt;/p&gt;

&lt;p&gt;In transactional motivations for service, the individual is serving because they are getting a direct benefit from it. Ideally this is an exchange of equal value to them, or they would refuse to do it. The most obvious example of this is paid service ‚Äì the cleaning lady and the waiter do their jobs because they are getting a paycheck at the end of the day. With unpaid situations, the exchange can be more or less overt or subtle; some people spell it all out in a contract, while for others it‚Äôs just ‚Äúassumed‚Äù that ‚ÄúI do this for you now because I know that you‚Äôll do that for me later, so it‚Äôs worth it.‚Äù&lt;/p&gt;

&lt;p&gt;There are all sorts of reasons why people might consider service worth doing even if it isn‚Äôt attractive on its own merits. A live-in houseboy or housemaid might clean the house because they‚Äôre getting free rent and a certain amount of dominance from a trustworthy M-type. A part-time sub might fetch their dominant drinks at the bar because they know they‚Äôre going to get some kinky action later, or because it adds to the fun of temporarily imagining themselves to be a slave, forced to serve or else something vague and terrible and titillating might happen. Another might serve because it gets them the appreciation of the people that they‚Äôre serving, and they like to know that they can make a positive impact on the lives of others.&lt;/p&gt;

&lt;p&gt;Every power dynamic should have at least a small amount of transactional motivation, because it keeps the servant in touch with their needs and whether those needs are actually getting met. If the servant is no longer getting what they need and what they believe that the master is obligated to give them, they‚Äôll become resentful and eventually leave. This is one reason why it‚Äôs good to have largely transactional relationships clearly delineated; the master needs to know what the servant believes that they are supposed to be getting from them. Sometimes these relationships are built entirely on assumptions, and if those assumptions are not in line with each other, it will fail very quickly. Of course, this also means that the servant needs to be completely honest ‚Äì not only with the master but with themselves as well ‚Äì about what it is that they expect from the bargain. With straightforward honesty, this kind of service can work out very well in a long-distance relationship, or one where both parties can only see each other periodically, where the other motivations would be more painful and difficult.&lt;/p&gt;

&lt;p&gt;One of the drawbacks to transactional service is that while it can work very well for short-term encounters, it‚Äôs not so useful for long-term, 24/7, emotionally intimate relationships where boundaries can blur and ‚Äúrewards‚Äù can get put off due to the vagaries of life interfering. The constant ‚Äúaccounting‚Äù gets tricky when it‚Äôs every minute of every day, and sooner or later someone will start feeling shortchanged. Another drawback is that this motivation can only be pushed so far, as it is easily swayed by personal desires and selfishness. It‚Äôs not necessarily the best foundation for a property-ownership situation, for example, or a no-recourse commitment where the slave is expected to be there permanently.&lt;/p&gt;

&lt;p&gt;Devotional Service&lt;/p&gt;

&lt;p&gt;Devotional motivations for service happen when the submissive serves out of love. It doesn‚Äôt have to be romantic love ‚Äì although it often is ‚Äì but there is usually a feeling of ‚ÄúYou are such a wonderful person that I am moved to do things for you, and I want very much to please you and to make you happy.‚Äù Deep satisfaction is gained from helping the object of their warm feelings, in a way that wouldn‚Äôt happen if they were rendering that service to some random person.&lt;/p&gt;

&lt;p&gt;Love is an amazingly strong motivation, and can carry someone a long way in the face of difficulty. Therefore, this motivation lends itself best to long-term romantic relationships, and secondarily to relationships where the sub looks up to and admires the master as a person. There may also be a desire for the feeling of ‚Äúbelonging‚Äù ‚Äì to a person, to a family, to a cause. Since devotional service is usually very one-pointed ‚Äì ‚ÄúI serve you and no other!‚Äù ‚Äì the master needs to be very careful about lending their servant to others. Long-distance relationships are the hardest for someone with this motivation, for obvious reasons.&lt;/p&gt;

&lt;p&gt;The drawbacks to devotional service is that inevitably, a day will come when the servant doesn‚Äôt feel all that loving, and may decide that service isn‚Äôt being rendered on that day. We‚Äôre all human, and eventually every couple ‚Äì especially if they are living together ‚Äì has a moment of ‚ÄúDamn it, today I just hate you!‚Äù Even if they get over it in a matter of hours, during that time their service will often be sabotaged by the lack of positive feelings. This can be particularly problematic with the combination of an emotionally volatile servant and ‚Äúmission critical‚Äù tasks. A servant motivated primarily by devotion would do well to cultivate a little of the other two types of motivation to pull them through the ‚ÄúI hate you today‚Äù mornings.&lt;/p&gt;

&lt;p&gt;Positional Service&lt;/p&gt;

&lt;p&gt;Positional motivations for service come from the servant‚Äôs strong sense of identity of themselves as a service-oriented person. They serve because it‚Äôs part of who they are, and to refuse to serve would be to sabotage their own self-worth, which is often based on how well a job they do. Positionally-motivated servants take pride in serving as perfectly as possible, and they are the ones who get up to help because it needs doing, regardless of who is asking. They are the most likely to attempt to cultivate ‚Äúpure‚Äù service, treating it as an art and requiring little in the way of appreciation. This category is the ‚Äúideal‚Äù slave in Laura Antoniou‚Äôs fictional Marketplace series, where slaves are sold to random wealthy owners who may or may not be even remotely worthy as people, and the slaves are expected to serve their monied masters to the best of their ability anyway. As you might imagine, positionally-motivated servants do ‚Äúlend out‚Äù quite well, should a master want such a thing.&lt;/p&gt;

&lt;p&gt;Putting the chairs away after the BDSM potluck munch for the fiftieth time won‚Äôt fly for the transactionally-motivated servant (‚ÄúWhat‚Äôs in it for me?‚Äù) or the devotionally-motivated servant (‚ÄúI don‚Äôt love you; why should I do what you say?‚Äù), but the positionally-motivated servant will get up and do it anyway every time, because it‚Äôs what they do. It is central to how they see themselves. However, one of the drawbacks to being a positionally-motivated servant is that their need to serve anyone, anything, for their own self-worth, can get them taken advantage of by unscrupulous people who want something for nothing.&lt;/p&gt;

&lt;p&gt;Another drawback to this motivation is that it does tend to objectify dominants and perhaps see them as interchangeable. In contrast to the devotionally-motivated submissive who is fiercely bound to one particular person, the positionally-motivated servant may be happy to serve anyone for the sake of the service. Alongside the potential problems of choosing a less-than-worthy master, they might also irritate some dominants with their seeming lack of caring about whom they serve. Many dominants want to be seen as special, at least by their submissives, and they may be put off by the idea that they might as well be anyone else who would accept the submissive‚Äôs service. Adding a bit of devotion to the mix will help in that regard, and cultivating some transactional motivations will help to keep them from being taken advantage of too often.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>zashchitnitsa</title>
   <updated>2021-05-07T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/07/zashchitnitsa</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/07/zashchitnitsa/"/>
     <content type="html">&lt;p&gt;I was away, in my own head.&lt;/p&gt;

&lt;p&gt;In the imaginal, I was yours. You‚Äôd given me to Audrey for a night, who in turn used me very, very roughly, late into the night. The next morning, she met with you for coffee, slave girl in tow ‚Äî who‚Äôd been very good, she assured ‚Äî and you received me back.&lt;/p&gt;

&lt;p&gt;In the real ‚Äî just minutes later ‚Äî you addressed my subconscious, asking me to let you protect me in my dreams.&lt;/p&gt;

&lt;p&gt;And in a funny way, you just had. As another has written before me:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I can‚Äôt not be submissive, whether owned or unowned, whether actively dominated or not, whether bound or free. My constant inclination is to submit to any other person around me, which apart from a slave master or mistress, is dangerous and leaves me susceptible. For me and others like me, there is a saving grace in being owned by another, for then I am protected from my own submissive vulnerability.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;Being given&lt;/em&gt; was protection, for in that world I was yours to give; the comfort of being given ‚Äî that of knowing one‚Äôs place to begin with.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>p</title>
   <updated>2021-05-07T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/07/p</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/07/p/"/>
     <content type="html">&lt;p&gt;My god, progesterone turns me into such a bitch. Literally over night. Guess the world has to deal with this for the next two weeks.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>siriai</title>
   <updated>2021-05-06T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/06/siriai</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/06/siriai/"/>
     <content type="html">&lt;p&gt;Geez. I even knew a slave girl!&lt;/p&gt;

&lt;p&gt;Worked with her; gave her a lift home more than once! Saw her at PAX a decade later. I suspect I follow her on Instagram even now. At the time I simply didn‚Äôt understand.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>kutuzyoku</title>
   <updated>2021-05-05T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/05/kutuzyoku</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/05/kutuzyoku/"/>
     <content type="html">&lt;p&gt;I am not sure I have experienced submissive humiliation. This is probably the next thing to ascertain.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>kept</title>
   <updated>2021-05-04T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/05/04/kept</id>
    
     <link href="https://kivikakk.ee/flashes/2021/05/04/kept/"/>
     <content type="html">&lt;p&gt;I‚Äôve always wanted to be kept.&lt;/p&gt;

&lt;p&gt;For as long as I can recall. My very first long-form creative writing endeavour (age 7) was an obvious self-insert; an anthropomorphic rabbit, kept. Collared in all but name; a wrist cuff, unable to be removed. In a cell, somewhere far away.&lt;/p&gt;

&lt;p&gt;Fantasies of being like Mewtwo in the first Pok√©mon movie, kept in a lab somewhere, never let out. Actually trying to roleplay that out at a friend‚Äôs once (age 9ish). He thought I was weird. I guess he was right. We stopped hanging out.&lt;/p&gt;

&lt;p&gt;There was the time I had a different, much closer friend &lt;em&gt;literally&lt;/em&gt; tie me to his bed (age 13; what we had on hand to effect this purpose was, uh, socks). Cue EXTREME scrambling to cover this up somehow when his mother well-intendingly burst in at the late hour that it was. I should ask him what he made of my asking to do that at the time.&lt;/p&gt;

&lt;p&gt;Hell, it‚Äôs not a stretch to see it in the way I‚Äôd given myself to romantic relationships up until a few years back. Total abnegation of the self. The subconscious rebels, though, because what I want to give is not even what the most possessive of my partners wanted to take. Not that I really had a clue about myself then, either; it was all these strange, wordless longings, and they‚Äôd seem to contradict themselves in ways I couldn‚Äôt grasp.&lt;/p&gt;

&lt;p&gt;The most frustrating thing was always myself, in the end.&lt;/p&gt;

&lt;p&gt;This quest for self-knowledge in earnest has been apace for more than 18 months, now, and I think we‚Äôre approaching the last crescendo before the home stretch. Not to suggest I‚Äôll be ever truly &lt;em&gt;finished&lt;/em&gt; with it, by any means, but once I‚Äôve found it ‚Äî once I‚Äôve locked eyes with my soul and &lt;em&gt;listened&lt;/em&gt; ‚Äî I suspect that same, once-eternal dread of facing up to what I‚Äôve made for myself will no longer feature.&lt;/p&gt;

&lt;p&gt;And maybe I‚Äôll find myself a keeper or two.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>summarised</title>
   <updated>2021-04-30T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/30/summarised</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/30/summarised/"/>
     <content type="html">&lt;p&gt;For me, the pleasure comes out of being obedient, and doing it really well; being used for others‚Äô pleasure, and putting in a lot of effort.&lt;/p&gt;

&lt;p&gt;At the moment I find a lot of pleasure in the idea of, I guess, being someone who holds herself in pretty high regard, but is regardless so willing to be used and to devote herself to that, if that makes sense. There‚Äôs a kind of humiliation in that which makes me super blush-y to think about.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>submission</title>
   <updated>2021-04-27T13:49:00+10:00</updated>
   <id>https://kivikakk.ee/xue/2021/04/27/submission</id>
    
     <link href="https://kivikakk.ee/xue/2021/04/27/submission/"/>
     <content type="html">&lt;p&gt;&lt;a href=&quot;https://slaveshae.wordpress.com/2021/04/26/finding-your-submissive-self/&quot;&gt;‚Äúfinding your submissive
self‚Äù&lt;/a&gt;
by shae hits so hard it &lt;em&gt;hurts&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Transcluding here for our future study and contemplation, emphases mine.  The
degree to which most of this is felt is unreal.&lt;/p&gt;

&lt;p&gt;(The one exception is vis-√†-vis degradation, but that‚Äôs not something I feel an
acute absence of, but rather a questionmark regarding.  There‚Äôs a big extent to
which I wonder how much I inhibit my own desires due to internalised shame ‚Äî
it‚Äôs not something I feel on the surface, nor is it an emotionality most would
associate with our public personae.&lt;/p&gt;

&lt;p&gt;So it‚Äôs not that I don‚Äôt desire degradation, or that I do; not that I don‚Äôt
know shame, or that I do.  Just that I have no insight into it one way or
another.  What &lt;em&gt;does&lt;/em&gt; resonate in that part is reference to needing that which
I would protest to; indeed, one of my peak submission experiences so far was
one in which I was helplessly trying to object to what was happening, so much
so that my body was acting under its own will, trying to push away the
dominant; me, awkwardly trying to tell her that despite this, I wanted her to
continue.)&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Recently I‚Äôve used this phrase in some of my posts. I thought I might look at
‚Äúfinding your submissive self‚Äù through the lens of my own life.&lt;/p&gt;

  &lt;p&gt;I‚Äôm going back about eight years to a time before I was in a D/s life. I was
in my real estate career, living a very vanilla life, dissatisfied and not
sure what to do. I had been aware for some time that I was submissive, though
na√Øve about it, but &lt;strong&gt;now I was beginning to think about it as more
significant in me than I‚Äôd realized before.&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;I made a lot of mistakes in my early exploration of my submissive sexuality,
but maybe this was something I did right: I dedicated time to assess my
submissive feelings and inclinations ‚Äî sort of a personal, submissive
inventory. &lt;strong&gt;I really focused on it&lt;/strong&gt;. That sounds so Tony Robbins, but for
me it was less of a self-improvement technique than an inner exploration
about strange desires I just needed to figure out.&lt;/p&gt;

  &lt;p&gt;Probably the most obvious thing to me then was my &lt;strong&gt;persistent longing to be
obedient in an extreme way&lt;/strong&gt;. I couldn‚Äôt make sense of that, but I knew it
was there in me. ‚ÄúObedience‚Äù to me &lt;strong&gt;wasn‚Äôt simply about being a follower&lt;/strong&gt;,
nor was it about being, say, a housewife in the old traditional sense,
deferring passively to a husband. My longing was something else, deeper and
more extreme. Of course back then my definition of ‚Äúextreme‚Äù was more modest
than I consider it now, but even then I had a clear sense that my longing
required something beyond normal.&lt;/p&gt;

  &lt;p&gt;I remember being at parties with real estate colleagues, sitting and sipping
cocktails. &lt;strong&gt;A particular man there, just by his presence, compelled certain
submissive feelings in me&lt;/strong&gt;. I remember having a longing to sit on the floor
at his feet. In the social context there that would have been so
inappropriate and odd, yet I wanted that, maybe &lt;strong&gt;precisely because it would
have been a socially embarrassing demonstration of my obedience&lt;/strong&gt;. I didn‚Äôt
even know the man.&lt;/p&gt;

  &lt;p&gt;I realized as well that my submissiveness also involved the desire to be
taken into experiences I never could or would take myself. At the time, I
couldn‚Äôt specifically identify what those experiences were ‚Äî I was too new to
it all. But &lt;strong&gt;I had a palpable sense that I needed someone to command my
being and push me into life events of doing and being that were otherwise
beyond me&lt;/strong&gt;.&lt;/p&gt;

  &lt;p&gt;At the time, I was also going through a kind of sexual awakening. I‚Äôve
written many times about how my sexual development was repressed in my early
years, and so I was at twenty-seven just beginning to open up sexually to who
I was. This led to a brief but serious relationship with a man and also a
girl-crush on a colleague of mine, which led to my first sexual relationship
with a woman.&lt;/p&gt;

  &lt;p&gt;But I was given advice from someone, I forget who, to imagine my
submissiveness apart from my sexuality and any sexual experience. D/s, it was
said to me, is not about sex, but about a radical abandonment of one‚Äôs self
to another‚Äôs dominion. The point was that as I assessed my submissive self,
would I still feel what I felt submissively if I took sexual attraction and
sex itself out of the picture?&lt;/p&gt;

  &lt;p&gt;As I worked this through, my answer was yes. That desire to be ‚Äútaken into
experiences I never could or would take myself‚Äù was not primarily, to my
mind, about sex. I could imagine sexual things, yes, but &lt;strong&gt;it was for me
really about a different kind of relationship in which I was treated in a
non-traditional way, taken into life experiences of submission and
obedience&lt;/strong&gt; ‚Äî again, admittedly, vague and undefined. My submissiveness just
had a craving sense these ‚Äúother experiences‚Äù awaited me out there.&lt;/p&gt;

  &lt;p&gt;The further realization I came to was troubling to me. But it was strong and
unavoidable. It was, simply, a strong wish for my own degradation.&lt;/p&gt;

  &lt;p&gt;What I didn‚Äôt know then, but believe now, is that this is possibly the core
of submissive psychology. &lt;strong&gt;My submissive desire was to be humiliated and
degraded&lt;/strong&gt;. I didn‚Äôt feel this to be a kind masochism, a ‚Äúhurt so good‚Äù
desire.  It was different. &lt;strong&gt;It was something I would likely protest and
object to in reality, yet something I knew I somehow needed&lt;/strong&gt;. Again it was
ambiguous as to what and how (indeed, in my writing now, I‚Äôm still trying to
figure this out), but it was a strong, driving submissive desire in me.
Troubling but true.&lt;/p&gt;

  &lt;p&gt;There were other things too, other evidences, &lt;strong&gt;such as how dominance in
persons across a crowded room would somehow melt me, and how I started to
imagine myself in a kind of servitude to particular men or women&lt;/strong&gt;.
Traditional people‚Äôs fantasies look like a Hallmark movie, mine looked like
‚ÄúThe Story of O.‚Äù&lt;/p&gt;

  &lt;p&gt;It took a long time. I was sorting out my life in a handful of different ways
‚Äî my relationship with my mother and my father, my beliefs and faith, my
bisexuality, my career and why it was disappointing‚Ä¶ and now this, my
submissive nature, which started to loom as a bigger reality in my life than
any of the others.&lt;/p&gt;

  &lt;p&gt;My ‚Äúsubmissive self-assessment inventory‚Äù took me about a year and a half. It
was never so formal a project as that, but that‚Äôs kind of what it was. It
yielded the self-revelations I share here, but slowly and often messily.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;At a point, I started to accept my being submissive&lt;/strong&gt;. And then &lt;strong&gt;becoming
open to being &lt;em&gt;extremely&lt;/em&gt; submissive&lt;/strong&gt;. And then &lt;strong&gt;allowing myself to
identify primarily as &lt;em&gt;a submissive&lt;/em&gt;, taking on the label, allowing myself to
be defined by it&lt;/strong&gt;: ‚ÄúMy name is Shae and I‚Äôm a submissive.‚Äù&lt;/p&gt;

  &lt;p&gt;There were still questions for me to figure out. Namely would my submissive
identity need to be a full-time life? And then, how to find a dominant person
who would take me places I couldn‚Äôt take myself.&lt;/p&gt;

  &lt;p&gt;But I came to this point when I was twenty-eight where I could say I found my
submissive self. I knew this is what I was.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Do I know what I am?&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>You Got Me</title>
   <updated>2021-04-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2021/04/27/you-got-me</id>
    
     <link href="https://kivikakk.ee/2021/04/27/you-got-me/"/>
     <content type="html">&lt;center&gt;&lt;iframe style=&quot;border: 0; width: 350px; height: 442px;&quot; src=&quot;https://bandcamp.com/EmbeddedPlayer/track=3439825641/size=large/bgcol=333333/linkcol=fe7eaf/tracklist=false/transparent=true/&quot; seamless=&quot;&quot;&gt;&lt;a href=&quot;https://tanoc.bandcamp.com/track/you-got-me&quot;&gt;You Got Me by USAO &amp;amp; Shandy Kubota&lt;/a&gt;&lt;/iframe&gt;&lt;/center&gt;
</content>
    
 </entry>
 
 <entry>
   <title>vacillation</title>
   <updated>2021-04-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/27/vacillation</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/27/vacillation/"/>
     <content type="html">&lt;p&gt;We waver‚Äîbetween passivity and anger, steeped rich in disappointment; between a resignation blended with hope that this could be enough, and a rejection, filled with the knowledge that we are worth more than this.&lt;/p&gt;

&lt;p&gt;It is hard to know whose is whose.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>occlusion II</title>
   <updated>2021-04-27T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/27/occlusion-ii</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/27/occlusion-ii/"/>
     <content type="html">&lt;p&gt;I suspect the answer is ‚Äúsubmission‚Äù, ‚Äúsubmissiveness‚Äù, or even ‚Äúbeing a submissive‚Äù‚Äînot just an occasional partaker of, but as core.&lt;/p&gt;

&lt;p&gt;What am I if not someone that earnestly desires?&lt;/p&gt;

&lt;p&gt;Fuck, man. Those words formed themselves without my input. There we were, not long ago at all, contending with the issue of having no contact with our desires, of not knowing at all. There‚Äôs embers smouldering under wraps, and I think it is f i n a l l y time to fan those flames fully.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;What, if accepted, would let me go even further in my quest for self-knowledge?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I‚Äôm inclined to believe that all my identity labels can be bound up in one another; that each can be a lens unto the others. If it‚Äôs not obvious, it probably just means there‚Äôs a surprising takeaway to be found. I don‚Äôt mean to be dogmatic about it, but let‚Äôs run with it and see? Quoting our homepage:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Trans. Well, this one‚Äôs kind of obvious. (You have to admit some gender essentialism, but this kind of ~lens work~ necessarily admits essentialism on every axis it looks at. I think that‚Äôs unavoidable.) tl;dr: gender, with all of its norms, ascribes submissive, obedient behaviour to one of its two main categories. Doesn‚Äôt take much thinking to realise which. If I were born cis, I don‚Äôt think I‚Äôd be trans. (Which is a funny way of validating my transition choices, really.)&lt;/li&gt;
  &lt;li&gt;Plural. Developing plurality gave my identity the flexibility and leeway it needed to lean into new spheres. A lot of our internal work has been developing an internal sense of obedience; of testing out and playing with the idea of one of us (Ashe) being subservient to the other (Lia). Wherein Lia‚Äôs been acting as the frontrunner of our identity, this inner-play has been one way of promoting behaviour in the main front, Ashe; the identity we desire to embrace is that of a submissive, and so we provide space within for Ashe to submit. Lia‚Äôs dominance isn‚Äôt fake, but it‚Äôs also not the goal here; it‚Äôs a scaffold. Frontrunning is complex; here it‚Äôs closer to shaping.&lt;/li&gt;
  &lt;li&gt;Poly. This basically indexes ‚Äúnon-traditional relationship style‚Äù. I think the Venn diagram of relationship escalators and compatibility with the depths of my submissiveness are two completely separate circles.&lt;/li&gt;
  &lt;li&gt;Furry. I‚Äôm a fucking bunny. This identifier alone got us into our only actual correctly-oriented D/s relationship so far‚Äî‚Äùso, the bunny thing written on your AD account‚Ä¶ is that like, a kink, rope-bunny thing? or a furry thing?‚Äù ‚Äúwell.. I only really meant the latter when I wrote it, but the former too now that I think about it?‚Äù nek minit I‚Äôm tied up on her living room floor.&lt;/li&gt;
  &lt;li&gt;Asexual. This has taken quite some time to resolve completely, but exploring it in depth has provided clues, maybe even answers. Asexual as in ‚Äúdoesn‚Äôt experience sexual attraction‚Äù, yes. But even a hint of dominance, of assertion, of even just &lt;em&gt;presuming&lt;/em&gt; that part of me might be yours to take, and I am suddenly extremely, intensely needy. As with almost every part of my self that I‚Äôve come to embrace, ‚Äúsubsexual‚Äù is the kind of term I would have scoffed at even just months ago. Now I think it‚Äôs probably the closest thing to a ‚Äòsexual orientation‚Äô I might possess. I get turned on by submission, by obedience, by enforced compliance; by boundaries disregarded in a wider context of consent. By accepting what I am; by being brought to that acceptance.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We‚Äôve a lot to contemplate.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>MAX 300</title>
   <updated>2021-04-24T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/2021/04/24/max-300</id>
    
     <link href="https://kivikakk.ee/2021/04/24/max-300/"/>
     <content type="html">&lt;p&gt;&lt;a href=&quot;https://remywiki.com/MAX_300&quot;&gt;MAX 300&lt;/a&gt; was the first&lt;sup id=&quot;fnref:sakura&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:sakura&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; level 10
song I cleared at the arcade.  I learned to play DDR with my older brother; I
distinctly recall the sensation of finally being better than him at a
game‚Äîwhether it was Descent, StarCraft, anything, he always had such a lead.&lt;/p&gt;

&lt;p&gt;I started DDR a bit later than him and had some catching up to do, but
eventually crossed the level 9 mark before he did.  It turned out rhythm games
would be a good place for me to excel.&lt;/p&gt;

&lt;p&gt;He lives overseas now, and at some point got an &lt;a href=&quot;https://www.maty-taneczne.pl&quot;&gt;L-TEK DDR
pad&lt;/a&gt;.  I was a bit envious, but felt the shipping
expense‚Äîfar worse to Australia than the US‚Äîwas too hard to justify.
Pandemic closing the gym made it muuuuuch more palatable, and plus it‚Äôd mean
I‚Äôd get to play DDR with my brother again in a way.&lt;/p&gt;

&lt;p&gt;It‚Äôs been a very good way to get fit again, and hitting old milestones again is
a lot of fun.  I‚Äôve done some other harder ones already, but today was the day
for clearing MAX&lt;nobr&gt; &lt;/nobr&gt;300 again.  My scores are &lt;em&gt;much&lt;/em&gt; better than my
13-year-old self‚Äôs, even though my endurance isn‚Äôt.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/max-300.jpg&quot; alt=&quot;MAX 300 score (87.23%)&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:sakura&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Not counting Ê°ú or bag here.¬†&lt;a href=&quot;#fnref:sakura&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 
 <entry>
   <title>mouii</title>
   <updated>2021-04-23T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/23/mouii</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/23/mouii/"/>
     <content type="html">&lt;p&gt;I‚Äôm fucking sick of feeling like I‚Äôm talking past everyone; like none of my words actually register.&lt;/p&gt;

&lt;p&gt;I don‚Äôt know if it‚Äôs this pandemic or what, but so decreasingly do I get the impression anyone cares to actually see me, to communicate soul to soul, real living being to real living being. (My nestmate is a beautiful exception, but then that‚Äôs why we‚Äôve endured as we have.)&lt;/p&gt;

&lt;p&gt;I‚Äôve had it with lowering the bar. Fucking get on my level.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>recapitulating</title>
   <updated>2021-04-21T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/21/recapitulating</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/21/recapitulating/"/>
     <content type="html">&lt;p&gt;Cleared PARANOIA survivor (new 15, old 10) again today. After re-clearing Utopia (11 from ITG) a week ago, I think I‚Äôm finally up to where I was a decade and a half ago!&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>cycles</title>
   <updated>2021-04-19T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/19/cycles</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/19/cycles/"/>
     <content type="html">&lt;p&gt;There‚Äôs something distinctly cyclical about how I‚Äôm relating to others and my goals at the moment and I don‚Äôt know how to attribute it.&lt;/p&gt;

&lt;p&gt;Energy for creative output has waned ‚Äî just wanna play games. Don‚Äôt care to see others or meet new people. I‚Äôm at the tail end of my P cycle so we‚Äôll see what it‚Äôs like later this week when I‚Äôm off that again. I have quite a lot of socialising coming up and I want to be there for it, otherwise it‚Äôs gonna get annoying.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>inscrutability</title>
   <updated>2021-04-06T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/06/inscrutability</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/06/inscrutability/"/>
     <content type="html">&lt;p&gt;Sometimes I wonder if I let myself get pushed or pulled around by dreams too much, but there‚Äôs something appealing about the inscrutability of allowing yourself to follow a path that‚Äôs been opened up for you, rather than demanding to try to understand one‚Äôs every little motive.  Most of our reasoning‚Äôs made up post-hoc anyway, right?&lt;/p&gt;

&lt;p&gt;(quoted from an email I sent a little while ago)&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>impinged</title>
   <updated>2021-04-04T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/04/04/impinged</id>
    
     <link href="https://kivikakk.ee/flashes/2021/04/04/impinged/"/>
     <content type="html">&lt;p&gt;Feeling miffed at someone‚Äôs suggestion that I wouldn‚Äôt be committed to communication, ‚Äòas a sub‚Äô.&lt;/p&gt;

&lt;p&gt;There are lots of reasons why this would miff me so!, but, to demonstrate the most pertinent one, the rest of this entry will detail the entirety of the communications I have received from them so far.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>one step forward</title>
   <updated>2021-04-02T16:46:00+11:00</updated>
   <id>https://kivikakk.ee/xue/2021/04/02/one-step-forward</id>
    
     <link href="https://kivikakk.ee/xue/2021/04/02/one-step-forward/"/>
     <content type="html">&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=xe3Wkzc0O3k&quot;&gt;One Step Forward ‚Äî Nhato feat. Glascat&lt;/a&gt;
(&lt;em&gt;transcribed for Vivian&lt;/em&gt;)&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/xe3Wkzc0O3k&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Oh, oh&lt;/p&gt;

&lt;p&gt;There is something strange inside my head&lt;br /&gt;
Something turns and runs from me&lt;br /&gt;
If I look back now what would I see there following?&lt;/p&gt;

&lt;p&gt;Can I withstand it and make it through to the light?&lt;br /&gt;
If I turn back now then this will always follow&lt;/p&gt;

&lt;p&gt;There is something strong inside my heart&lt;br /&gt;
Something deep, unwavering&lt;br /&gt;
If I breathe in now then I can‚Äôt find that part of me&lt;/p&gt;

&lt;p&gt;Can I demand it and make it last through the night?&lt;br /&gt;
If I wake up now then I can‚Äôt find the future&lt;/p&gt;

&lt;p&gt;Oh, oh&lt;br /&gt;
Oh, one step forward, forward&lt;br /&gt;
Oh, oh&lt;br /&gt;
Oh, one step forward, forward&lt;/p&gt;

&lt;p&gt;Oh, oh&lt;br /&gt;
Oh, one step forward, forward&lt;/p&gt;

&lt;p&gt;‚Äòcause the fear will take me if I let it in&lt;br /&gt;
I must not, I must not, I must not, I must not let it in&lt;br /&gt;
And the light will make me if I reach the end&lt;br /&gt;
I will go, I will go, I will go, until it shines again&lt;/p&gt;

&lt;p&gt;‚Äòcause the fear will take me if I let it in&lt;br /&gt;
I must not, I must not, I must not, I must not let it in&lt;br /&gt;
And the light will make me if I reach the end&lt;br /&gt;
I will go, I will go, I will go, until it shines again&lt;/p&gt;

&lt;p&gt;Oh, oh&lt;br /&gt;
Oh, one step forward, forward&lt;br /&gt;
Oh, oh&lt;br /&gt;
Oh, one step forward, forward&lt;/p&gt;

&lt;p&gt;Oh, oh&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>pull</title>
   <updated>2021-03-31T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/03/31/pull</id>
    
     <link href="https://kivikakk.ee/flashes/2021/03/31/pull/"/>
     <content type="html">&lt;p&gt;I had a great deal of energy pushing me toward working on a kernel project after I came off the mood stabiliser. Having readded some testosterone to the mix, and..&lt;/p&gt;

&lt;p&gt;The energy remains in some sense, and I &lt;em&gt;could&lt;/em&gt; choose to devote it to the kernel, but I feel more inclined to simply be helpful on Discord to newcomers, and then put my energy toward language learning.&lt;/p&gt;

&lt;p&gt;toki pona seems fun, but watching the conversations going on in ma pona it‚Äôs clear that its function is (intentionally) limited. I yearn for something greater, wider, deeper; of a depth not decided by the conventions that can only arise from mutual conversation with those present, but one with its roots thrust into the past.&lt;/p&gt;

&lt;p&gt;Russian I continue to learn at the speed of my nestmate, so I will rededicate the energy I have now toward the language of my ancestors; mu emakeel, so to speak.&lt;/p&gt;

&lt;p&gt;I thought to resist the pull, but following it has been fruitful lately, so I‚Äôll continue to let it guide me xx&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>occlusion</title>
   <updated>2021-03-31T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/03/31/occlusion</id>
    
     <link href="https://kivikakk.ee/flashes/2021/03/31/occlusion/"/>
     <content type="html">&lt;p&gt;I was contemplating (intentional/endogenous) plural identity formation, and it occurred to me how much in common the mindstates before and after have with trans identity formation.&lt;/p&gt;

&lt;p&gt;When I think back to who I was before I‚Äôd really accepted myself as being trans, I had all the usual hangups: what if I‚Äôm faking it, what if it‚Äôs not actually better, what if it‚Äôs grass-is-greener, what will my family/friends think, etc. etc.  There was something basically obscuring it, and yet ‚Äî while many aspects of my material reality have surely shifted in the decade since ‚Äî internally the changes are not huge.  The most prominent one is simply identification; a willingness to see the self through a given lens, followed by the confirmatory euphoria of knowing truth.&lt;/p&gt;

&lt;p&gt;There‚Äôs nothing fundamentally different about questioning-me and knowing-me, just a change in what I‚Äôm &lt;em&gt;willing to accept about myself&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;It was much the same with plurality.  It had long made sense as a means of better understanding my self, but before you cross the gap (which really takes place in lots of little ways, rather than one leap, but some of the little ways are bigger than others), doubt fills your mind and occludes those moments of recognisance.  Even though it ‚Äúmade sense‚Äù even stronger was the sense that it was generally thought to be a faked phenomenon (sound familiar?), one with no real value other than to seek attention.&lt;/p&gt;

&lt;p&gt;I wonder just how many possibly useful lenses are hidden this way; in general, and for my selves specifically.  What, if accepted, would let me go even further in my quest for self-knowledge?&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>blocked</title>
   <updated>2021-03-31T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/03/31/blocked</id>
    
     <link href="https://kivikakk.ee/flashes/2021/03/31/blocked/"/>
     <content type="html">&lt;p&gt;I‚Äôm incredibly blocked at work.&lt;/p&gt;

&lt;p&gt;~Circumstances~ mean that there‚Äôs a large drain on motivation, and the piece of work I‚Äôm up to right now I haven‚Äôt really budged from in weeks. Months? Working part-time has its benefits, also its downsides.&lt;/p&gt;

&lt;p&gt;How much longer can this go on?&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>longing</title>
   <updated>2021-03-29T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/03/29/longing</id>
    
     <link href="https://kivikakk.ee/flashes/2021/03/29/longing/"/>
     <content type="html">&lt;p&gt;I dreamt of her, fractally.&lt;/p&gt;

&lt;p&gt;I dream of her often enough, but lately the edge had been taken off, no heavy meaning invested, instead accompanied by a casual lightness that never really graced our actual relationship with its presence.&lt;/p&gt;

&lt;p&gt;This time, though, it was her, her, her, and me, apologising, reaching through one dream and into the next to try to make contact, to establish some connection, to get the message through that I wished more than anything it hadn‚Äôt gone that way. In one level she had bleached her hair, same as me; we were dancing in a circle and Niki (?) pointed her out to me, just behind me.&lt;/p&gt;

&lt;p&gt;At the end of the dream I was apologising to Niki, saying I needed to go out on a motorcycle ride with her at short notice, having finally reconnected.&lt;/p&gt;

&lt;p&gt;Ugh.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>As best we can tell, the pub is shut</title>
   <updated>2021-03-29T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2021/03/29/as-best-we-can-tell-the-pub-is-shut</id>
    
     <link href="https://kivikakk.ee/2021/03/29/as-best-we-can-tell-the-pub-is-shut/"/>
     <content type="html">&lt;p&gt;I was alerted by a commenter that it‚Äôs been more than a year, now, since this
video dropped:&lt;/p&gt;

&lt;center&gt;&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/83cEEyTuAMM&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;&lt;/center&gt;

&lt;p&gt;COVID measures had already begun to be implemented; national borders shut, most
schools already closed.  Watching this press conference, &lt;a href=&quot;https://www.youtube.com/watch?v=SqDP8SnPVA0&quot;&gt;a scene from The
Simpsons&lt;/a&gt; played in my mind.  I‚Äôd
been getting a little comfy with a video editing program to record &lt;a href=&quot;https://www.youtube.com/watch?v=8tzZYDXHHG4&quot;&gt;IIDX
plays&lt;/a&gt;, so I gave it a crack.&lt;/p&gt;

&lt;p&gt;I don‚Äôt really have networks to tap, but Niki liked it so much she diligently
dropped it into comments on Facebook and Twitter replies wherever it seemed
appropriate.  Before I knew it, I had a moderately popular YouTube video.  It
entered the popular discourse when it was &lt;a href=&quot;https://www.youtube.com/watch?v=7hOK5JF5XGA&quot;&gt;further
remixed&lt;/a&gt;, but if you ask me, the
Trump oversamples are just kinda gross.&lt;/p&gt;

&lt;p&gt;One thing that‚Äôs been interesting to see has been how the popularity of the
video corresponded with (literally) viral events:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/views.png&quot; alt=&quot;A graph showing the views for the video&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The three major events were:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Late March, video released, Dan Andrews said ‚Äúget on the beers‚Äù.&lt;/li&gt;
  &lt;li&gt;Mid-May, first lockdown restrictions eased.&lt;/li&gt;
  &lt;li&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;October 26, Victoria recorded zero new cases/deaths for the
first time since June.  Dan reported that he ‚Äúmight go a little higher up the
shelf‚Äù than beers.&lt;/li&gt;
&lt;/ul&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;Daniel Andrews, Victoria‚Äôs Premier, is widely liked, and he‚Äôs largely been
credited with producing the results we‚Äôve had locally, the likes of which have
only really been seen in Taiwan, New Zealand and Singapore.  We‚Äôve had our
share of anti-lockdown protests, too, but overall the sentiment has been that
Victorians have been willing to accept discomfort up front to mitigate a
disaster later.&lt;/p&gt;

&lt;p&gt;Sharing this video online more recently has had some interesting reactions;
namely, Americans being like ‚Äúlol government interference!!!‚Äù  Melbourne‚Äôs
second lockdown was 112 days long (July 9 until October 28), and it was
challenging in its own ways, and for some very difficult.  I don‚Äôt seek to deny
that, but the practical upshot has been a few dozen cases in the last six
months.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/community.png&quot; alt=&quot;Graph from covid19data.com.au showing community spread of COVID in Victoria&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It‚Äôs a fucking pandemic.  You don‚Äôt just ask everyone nicely to please do the
right thing, because that‚Äôs not human beings work at the population level.  If
you &lt;em&gt;actually&lt;/em&gt; want to beat it, you need to be realistic about what works.
Ideals fall flat in the face of an airborne pathogen.  If there are any doubts
about that, please consult &lt;a href=&quot;https://coronavirus.jhu.edu/map.html&quot;&gt;the big red number at the top
left&lt;/a&gt;.  Empirically, government
interference gets it done&lt;sup id=&quot;fnref:hif&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:hif&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Someone in chat a couple weeks back lamented how they wish they could go out
again like normal, and I didn‚Äôt have the heart to tell them that I had been for
nearly half a year now, safely; I just said, ‚Äúin some places in the world you
can.  soon!‚Äù  Y‚Äôknow, vaccinations proceeding apace and all that.&lt;/p&gt;

&lt;p&gt;Another person agreed, saying Japan was reopening for dine-in in a couple
weeks, and the first said how much they wished the borders were open so they
could visit.  Japan reported 2,080 new cases this weekend, a steady increase
from the most recent low 7-day average of ~900 in early March.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/japan.png&quot; alt=&quot;Japan&apos;s graph&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That‚Äôs not what I meant.&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:hif&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Never mind the fact that, say, Australia and New Zealand both rank higher in the &lt;a href=&quot;https://www.cato.org/human-freedom-index/2020&quot;&gt;Human Freedom Index&lt;/a&gt; than the US‚Äîwhat matters is how you feel when you say it!¬†&lt;a href=&quot;#fnref:hif&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 
 <entry>
   <title>hostility</title>
   <updated>2021-03-25T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/flashes/2021/03/25/hostility</id>
    
     <link href="https://kivikakk.ee/flashes/2021/03/25/hostility/"/>
     <content type="html">&lt;p&gt;Maybe it‚Äôs just the elevated T levels lately, but god if I don‚Äôt feel a lot of animosity towards certain behaviours.&lt;/p&gt;

&lt;p&gt;There‚Äôs this one guy who‚Äôs just joined a programming language community, and like:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;He doesn‚Äôt really understand the language or its motivations yet, is trying to learn, but is way out of his depth still. That‚Äôs cool, so was I once.&lt;/li&gt;
  &lt;li&gt;Despite this, though, he keeps trying to ‚Äúhelp‚Äù people in areas he is still way out of his depth in, and like, should definitely be aware he is out his depth in. Blind leading the blind.&lt;/li&gt;
  &lt;li&gt;When something doesn‚Äôt make sense, he starts going wild saying how it‚Äôs stupid, must be a bug, starts @mentioning the creator (who probably isn‚Äôt even online) saying ‚Äúplease tell me it‚Äôs a bug‚Äù. I hand-hold him and explain how, no, he‚Äôs just got it wrong, he calms down. Why be so belligerently wrong about something?&lt;/li&gt;
  &lt;li&gt;In various chat rooms people will be discussing using certain features (or not using them) and he‚Äôll start just kinda circlejerking with no-one in particular about how good it is that the language lets you do this, ‚Äúunlike CERTAIN OTHER LANGUAGES‚Äù, but like, dude, shut up, we‚Äôre trying to have a conversation here?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It takes every fibre of my being to not be like ‚Äúok, just shut up,‚Äù but I‚Äôm &lt;em&gt;thoroughly&lt;/em&gt; irritated after a few weeks of this. The last one in particular is one I see a lot from new entrants to this community; they barely understand it but they have decided it‚Äôs the best thing ever and for some reason feel a need to go on about that, rather than just.. actually use it and make something.&lt;/p&gt;

&lt;p&gt;Maybe I‚Äôm hostile to the idea of people deciding to invest themselves in something they don‚Äôt understand well yet, perhaps because when I was young I did a lot of that while casting around for places to hang my identity up on.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>collared</title>
   <updated>2021-03-15T16:55:00+11:00</updated>
   <id>https://kivikakk.ee/xue/2021/03/15/collared</id>
    
     <link href="https://kivikakk.ee/xue/2021/03/15/collared/"/>
     <content type="html">&lt;p&gt;I dreamt a dream that has left me unsettled all day.&lt;/p&gt;

&lt;h3 id=&quot;backstory-‚Ö∞&quot;&gt;backstory ‚Ö†&lt;/h3&gt;

&lt;p&gt;Since I first had any kind of sexual inkling whatsoever ‚Äî which is to say,
since I was 12 when I‚Äôd hang around on an 18+ BDSM-themed furry MUCK and began
RPing ‚Äî I only ever had any inclination to be in a submissive position.  When
I found randoms to RP with, it was Asherah, the small pink bunny girl, wanting
to have anything and everything done to her, especially if consent lines got
blurry.&lt;/p&gt;

&lt;p&gt;Even then I had to power-bottom a little bit.  One rando I recall was only into
the most vanilla dynamics, whereas I kept wanting to up the ante.  (Tie me up!
Get creative with things!  Don‚Äôt just &lt;em&gt;fuck&lt;/em&gt; me, for christ‚Äôs sake.)  I got
bored.&lt;/p&gt;

&lt;p&gt;I also kinda..  baited an IRL friend who was a little too obsessed with me into
joining me on the server, and then kept trying to ‚Äúsuggest‚Äù him into doing
stuff to me.  (I‚Äôm not especially proud of it, but like.  I was 12, he was 13,
everything at home was completely fucked up, he was super into me and could
match my intelligence to boot, so.. now that we got furry MUCK-married,
couldn‚Äôt we furry MUCK-do-other-stuff too please?)&lt;/p&gt;

&lt;p&gt;This positioning of myself carried pretty strong for a while.  There is
probably a (bidirectional) link between that and trans feels.  It‚Äôs funny how
predictably some things go; I was ostensibly into girls, not boys (never mind
the actual physicality that existed between me and aforementioned IRL friend
for a while), but then I became a trans girl, and so liking other trans girls
is only natural, and then you stop seeing ‚Äúdick‚Äù as a possibly unsettling thing
‚Äòboys‚Äô have (and you‚Äôre not sure about your own) but a hot thing girls have
too, and then you look at boys and you‚Äôre like, hm.  You sure could overpower
me.&lt;/p&gt;

&lt;h3 id=&quot;backstory-‚Ö±&quot;&gt;backstory ‚Ö°&lt;/h3&gt;

&lt;p&gt;Despite this, in relationships since I have often ended up being the one with
power.  Perhaps stemming from the same instinct that led to power-bottoming
before, I‚Äôd much rather we get &lt;em&gt;anywhere&lt;/em&gt; than nowhere, and I have a kind of..
exuberant personality that tends to draw in others who prefer to follow.  I am
naturally extremely protective, quite opinionated, have
&lt;a href=&quot;/xue/2020/10/07/motherhood&quot;&gt;mom-vibes&lt;/a&gt;, and until recently have been &lt;a href=&quot;https://poly.land/2019/11/25/confessions-of-a-recovering-people-pleaser-discovering-places-between-pushover-and-pusher/&quot;&gt;a
people-pleaser&lt;/a&gt;
to a fault.  Not knowing myself how to separate these qualities from those of a
~dominant~ has lead to me getting into places I‚Äôve later not known how to
deal with.&lt;/p&gt;

&lt;p&gt;This mainly became a thing in two relationships, collectively spanning seven
years, or a majority of my post-transition life so far.&lt;/p&gt;

&lt;p&gt;In the first case I had a handle on life in many ways she did not yet (she was
quite a bit younger than me), and so I provided everything I could; housing, a
stable life away from sometimes violent parents, support for her relationships
and hobbies outside me, and later when I could afford it, university education.&lt;/p&gt;

&lt;p&gt;I‚Äôm a person who just wants to give, and as I‚Äôve discovered lately in therapy,
one who doesn‚Äôt believe, strictly speaking, that I actually deserve nice
things.  Accordingly, giving nice things to other is a very sure route to
getting a similar sense of happiness, effectively, even if it does ultimately
mean I don‚Äôt get what I truly want, and ends up being unsustainable.  She
didn‚Äôt want many responsibilities of life and liked the sound of a more formal
and continuous D/s relationship, so I agreed to give it my best.  Our
relationship did not last the dissolution of the D/s layer of it (among &lt;em&gt;many&lt;/em&gt;
other issues, but this came to represent a lot about it).&lt;/p&gt;

&lt;p&gt;In the second case, she was a few years older than me, but with a heart of
absolute gold who had been mistreated a lot, both historically and more
immediately.  She nurtured a rare kindness and trust despite all that and I
felt so much like I wanted to safeguard that.  As our relationship quickly
deepened she wanted to know if I would be her ‚Äúprotector‚Äù, and I assented
immediately.  (And I still do. &amp;lt;3)  Then in natural order, more D/s-style
parameters followed, and I put my all into it as well.  It just seemed to make
sense, and I had already so much of the ‚Äútechnique‚Äù down that the lack of
deep-felt enthusiasm for the role seemed of secondary concern for a time, or
not even‚Äîcompletely masked.  I couldn‚Äôt feel that I didn‚Äôt have my heart in
it, only that I wanted to make her happy.&lt;/p&gt;

&lt;p&gt;Once you get used to ignoring what you want for a long time, you lose touch
with it entirely.  It took a massive reconfiguration of our relationship to
accommodate removing this part of it ‚Äî it had been in place from not even a
month after we started dating, and there we were some year and a half later
trying to imagine ‚Äúus‚Äù without that.  It was the best, most correct decision,
but I still wish I‚Äôd figured this all out long ago and spared her the hurt.&lt;/p&gt;

&lt;p&gt;There &lt;em&gt;was&lt;/em&gt; one relationship in the past where I was explicitly the s to
someone else‚Äôs D, but we lacked harmony regarding what each of us wanted out of
a D/s relationship, and I found myself pushing for more than she wanted to give
(or, well, take).  It was fun being a rope bunny, though.&lt;/p&gt;

&lt;h3 id=&quot;backstory-‚Ö≤&quot;&gt;backstory ‚Ö¢&lt;/h3&gt;

&lt;p&gt;What triggered the reconfiguration was my own realisation of my asexuality.
I‚Äôd been slowly putting the pieces together for a while, and then one
well-timed acid trip and I just kind of blurted it out, at once &lt;a href=&quot;https://www.furia.com/page.cgi?type=twas&amp;amp;id=twas0495&quot;&gt;feeling the
surge of unverifiable
truth&lt;/a&gt;.  As I experienced
a moment of serenity, my partner a sense of loss of what was.  The relief of no
longer feeling beholden to the allo norms of sex-having then prompted the
follow-up question of whether I still wanted to be her dominant.  The writing
had been on the wall for a while, but it was then that the jig was finally up
and I seized the chance to say ‚Äúno‚Äù, as painful as it was.  Pretending to be
something I was not was behind me.&lt;/p&gt;

&lt;p&gt;Living a mostly sexless life has been so much better for me.  I just don‚Äôt have
interest in being sexual with another, and just barely more interest in being
sexual by myself.  Still, it was in my own fantasies that my sexuality
originated, so it‚Äôs not too surprising that it does live on there a little.&lt;/p&gt;

&lt;p&gt;Last year I saw an endocrinologist for the first time since starting transition
(which seems super dumb in retrospect but what can you do, trans healthcare is
a &lt;em&gt;mess&lt;/em&gt;), and we discovered that both my E and T levels were way too low.  My
E was below the very conservative range put forth by the Australian medical
establishment (and well below what Americans would consider normal), and T
levels at almost absolute zero.  Even in natal women, T is in a clear non-zero
range, and completely lacking it could explain a lack of libido, which
certainly described me, as well as lack of energy in general.&lt;/p&gt;

&lt;p&gt;So I set to correcting my E levels, then T levels.  I‚Äôm now on ~3% of the
anti-androgen dose that I used to be on and my T levels have &lt;em&gt;just slightly&lt;/em&gt;
inclined upward.  They are still below the low watermark for ‚Äúnormal female
levels‚Äù, but at least I get a reading.&lt;/p&gt;

&lt;p&gt;I still don‚Äôt have any interest in being sexual with others, even though I‚Äôve
had an inkling of a sex drive for a little while again now, so it doesn‚Äôt look
like the asexual descriptor was particularly linked to my hormones, but I‚Äôm
increasingly feeling a need to have some kind of a sexual relationship with
myself again.&lt;/p&gt;

&lt;h3 id=&quot;the-point&quot;&gt;the point&lt;/h3&gt;

&lt;p&gt;Last night I dreamt a dream ‚Äî many, actually, with complicated
interconnections, people I didn‚Äôt recognise, other people who seem like maybe
they‚Äôre stand-ins for real people, a variety of settings, some drama unrelated
to all this.&lt;/p&gt;

&lt;p&gt;But there was one ‚Äúsegment‚Äù of it that left an indelible expression, because it
seemed like my unconscious needed to make a point.&lt;/p&gt;

&lt;p&gt;To date, I‚Äôve never been collared by someone else in an impactful way.  The
tangible, real sense that you belonged to someone else now ‚Äî even if
time-limited or otherwise scoped.  The understanding that it was not yours to
put on, or yours to remove, even if it was very much your collar.  I have
(attempted) to provide that experience for others, when in reality it was what
I wanted myself.  I‚Äôve ‚Äúself-collared‚Äù a bit here and there.&lt;/p&gt;

&lt;p&gt;In one distinct dream, I was collared.  I was strongly aware I was collared,
and moreover, I physically &lt;em&gt;couldn‚Äôt&lt;/em&gt; remove it even if I wanted to.  It was
locked.  It wasn‚Äôt up to me, and I just had to deal.&lt;/p&gt;

&lt;p&gt;It felt really, really good.  There was a sense that people might notice it,
that they might point it out to each other, and that I was &lt;em&gt;literally&lt;/em&gt;
powerless to do anything about it.  If I wanted to go about my day, I just had
to accept that this was my lot.&lt;/p&gt;

&lt;p&gt;I‚Äôve never felt that before‚Äîthat powerlessness.  Yet it‚Äôs what I‚Äôve wanted
all along.&lt;/p&gt;

&lt;p&gt;The dream then offered a counterpoint.&lt;/p&gt;

&lt;p&gt;Later, somehow, the key came into my possession.  The dream didn‚Äôt describe the
actual supposed holder of the key, but the narrative seemed to be that whoever
had collared me needed me to hold onto the key now, too.  I wanted to be sure
not to lose it, so I put it on a necklace.&lt;/p&gt;

&lt;p&gt;The feeling was radically altered.  Having the means of unlocking it on my
person at all times meant it just became jewellery.  It was no longer an aspect
of control over me, just some ring with a finnicky clasp.  Being out in public
and being seen wearing it wasn‚Äôt a demonstration of someone else‚Äôs power over
me, just my own determination.  Frankly, as a trans person, somedays being seen
in public at all can require a fair bit of that.  This feeling barely
registered, the same lack of impact that self-collaring has.  I can always just
take it off.&lt;/p&gt;

&lt;p&gt;I want to feel that first one again.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Knowing when to look past your code</title>
   <updated>2021-02-28T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2021/02/28/loader</id>
    
     <link href="https://kivikakk.ee/2021/02/28/loader/"/>
     <content type="html">&lt;p&gt;There‚Äôs a weird tension in programming ‚Äî on the one hand, as you learn the
ropes, you (hopefully) learn very quickly that the problem is almost &lt;em&gt;always&lt;/em&gt;
in your code, and not, say, the compiler, stdlib, kernel, etc.  This is usually
very correct; the people who‚Äôve worked on those things have many times the
experience you did when you decided that there must be a bug in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; or
something.&lt;/p&gt;

&lt;p&gt;You‚Äôll later realise you tried to print something through a pointer to a
stack-allocated variable that‚Äôs long since gone.  These accusations tend to
wane as you gain familiarity with your subject matter, and wax as you step out
into lands populated with ever more footguns, exposing more of the architecture
than you ever suspected was there.  (See also: the emails from me to the libev
mailing list in 2011.)&lt;/p&gt;

&lt;p&gt;At some point, though, your journies will take you to places where things
aren‚Äôt so clear cut, and you‚Äôll start to gain a sixth sense; a kind of visceral
experience that &lt;em&gt;things are not as they have been promised to be&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;A few weeks ago, that sixth sense whispered in my ear: ‚Äúwhat
if, instead of your cruddy bootloader written in a pre-1.0 systems language for
a platform you don‚Äôt fully understand, it‚Äôs the 20 year-old project with 80,000
commits that‚Äôs wrong?‚Äù  And it was right.&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/kivikakk/daintree&quot;&gt;Daintree&lt;/a&gt;‚Äôs bootloader, dainboot, worked
great on QEMU, but would fail hard and fast on hardware with synchronous
aborts.  It‚Äôs a UEFI application, which means we get a lot for free ‚Äì see how
easy it is to &lt;a href=&quot;https://github.com/kivikakk/daintree/blob/c8ecf0131aba16fb6ef1991393b7088037526f77/dainboot/src/dainboot.zig#L98-L160&quot;&gt;search connected FAT filesystems for
binaries&lt;/a&gt;.
I don‚Äôt particularly want to spend much effort on a bootloader, so this makes
sense to me.&lt;/p&gt;

&lt;p&gt;QEMU comes bundled with a build of &lt;a href=&quot;https://www.tianocore.org&quot;&gt;TianoCore EDK2&lt;/a&gt;,
which makes it really easy to get started.  On my ROCKPro64 I have a build of
&lt;a href=&quot;https://www.denx.de/wiki/U-Boot&quot;&gt;U-Boot&lt;/a&gt; installed to the eMMC, an extremely
versatile bootloader found on all kinds of devices&lt;sup id=&quot;fnref:why-no-edk2-on-rk&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:why-no-edk2-on-rk&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.  It
makes a TFTP-based development cycle remarkably pleasant.&lt;/p&gt;

&lt;p&gt;But different bootloaders mean very different execution environments.  For one,
EDK2 seems to execute the UEFI application in EL1, whereas U-Boot gives over
control in EL2.  There are many, many differences in the state of the various
system control registers.  And in this case, right in the beginning, we were
getting an exception in U-Boot before we‚Äôd done barely any work:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Booting /efi\boot\BOOTAA64.efi
AC&quot;Synchronous Abort&quot; handler, esr 0x96000010
elr: fffffffffd1c4d98 lr : fffffffffd1c4d5c (reloc)
elr: 0000000078f07d98 lr : 0000000078f07d5c
x0 : 0000000000000000 x1 : 0000000000000000
x2 : 000000007bfdf450 x3 : 000000000000004c
x4 : 0000000000002800 x5 : 000000007bfdf480
x6 : 000000007bfdcb50 x7 : 0000000079f71680
x8 : 0000000078f0ab78 x9 : 0000000000003b5c
x10: 0000000000000000 x11: 0000000000000020
x12: 000000000000ed83 x13: 000000000000ed9c
x14: 0000000079f29d28 x15: 0000000008100000
x16: 0000000000000010 x17: 0000000000000000
x18: 0000000000000000 x19: 000000007bf43b78
x20: 0000000079f29fa0 x21: 0000000078f10040
x22: 0000000000005800 x23: 0000000079f542e0
x24: 000000007bff4eac x25: 0000000000000000
x26: 0000000000000000 x27: 0000000000000000
x28: 0000000079f4ba00 x29: 0000000079f29a30

Code: f9400fe8 f9400109 f94007ea 8b0a0129 (3940012b)
UEFI image [0x0000000078f07000:0x0000000078f0c35f] pc=0xd98
           &apos;/efi\boot\BOOTAA64.efi&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The disassembly showed that at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pc=0xd98&lt;/code&gt; in the image we were attempting to
load a byte from the address pointed to by register &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;d98: 2b 01 40 39                   ldrb    w11, [x9]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the register dump, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt; has the value &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0000000000003b5c&lt;/code&gt;, whereas we are
clearly relocated much higher in memory (note the UEFI image offset; the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pc&lt;/code&gt;
is relative to that).  Should &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt; actually have a higher computed address?  I
hacked some things together to get a register dump from a similar place in QEMU
(on EDK2, where this all worked):&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(gdb) info registers
x0             0x0                 0
x1             0x2                 2
x2             0x1                 1
x3             0x5f46d944          1598478660
x4             0x43                67
x5             0x0                 0
x6             0x70616d6d          1885433197
x7             0x0                 0
x8             0x5c1f5b78          1545558904
&lt;strong&gt;x9             0x5c1f5b5c          1545558876&lt;/strong&gt;
x10            0x0                 0
x11            0x64                100
x12            0x0                 0
x13            0x8                 8
x14            0x0                 0
x15            0x0                 0
x16            0x5f6b4ab0          1600866992
x17            0xffffa6ac          4294944428
x18            0x0                 0
x19            0x0                 0
x20            0x5f37d000          1597493248
x21            0x5f37f000          1597501440
x22            0x0                 0
x23            0x5f37f000          1597501440
x24            0x0                 0
x25            0x1                 1
x26            0x0                 0
x27            0x5f37f000          1597501440
x28            0x5f37d55d          1597494621
x29            0x5f6b45b0          1600865712
x30            0x5c1f2d5c          1545547100
sp             0x0                 0x0
pc             0x5c1f2da0          0x5c1f2da0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I‚Äôve highlighted &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt; ‚Äì it has a value that‚Äôs clearly much more
valid-pointer-looking, and it even ends in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;...b5c&lt;/code&gt;, which makes me think it‚Äôs
a corrected version of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3b5c&lt;/code&gt; value we saw on the ROCKPro64.&lt;/p&gt;

&lt;p&gt;What could cause a register to have a correct-looking address on one platform
but not on the other?  Let‚Äôs look at the code up and until the point where
things fall apart.  Unfortunately, UEFI code objects are all
&lt;a href=&quot;https://en.wikipedia.org/wiki/COFF&quot;&gt;COFF&lt;/a&gt;s.  I‚Äôm super inexperienced with
these, and so too it turns out is the tooling in the area; I think it must be a
bit of a hack that Zig or LLVM knows how to produce them, because it also
produces a &lt;a href=&quot;https://en.wikipedia.org/wiki/Program_database&quot;&gt;PDB&lt;/a&gt; alongside that
presumably contains the debugging/line info, but then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;llvm-objdump&lt;/code&gt; refuses to
use the same thing, helpfully declaring:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;llvm-objdump: warning: &apos;dainboot/zig-cache/bin/BOOTAA64.
rockpro64.efi&apos;: failed to parse debug information for
dainboot/zig-cache/bin/BOOTAA64.rockpro64.efi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/disas.jpg&quot; alt=&quot;Hand-written disassembly.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;(The right-hand page has the disassembly in reverse, since we only have the
state of registers at the point in time of the last instruction and have to
trace data dependencies backwards.  The precise values are different because
they shifted every time I added some breaks or debugging helpers anywhere.)&lt;/p&gt;

&lt;p&gt;I have no line numbers ‚Äì it‚Äôs up to disassembly and guesswork.  Here‚Äôs the
former:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;d8c: 09 01 40 f9                   ldr     x9, [x8]
d90: ea 07 40 f9                   ldr     x10, [sp, #8]
d94: 29 01 0a 8b                   add     x9, x9, x10
d98: 2b 01 40 39                   ldrb    w11, [x9]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I‚Äôve grown very fond of aarch64 (dis)assembly.  Look at those four-byte
instructions.  This experience was a crash course in learning it.&lt;/p&gt;

&lt;p&gt;So what have we here?  Translated into pseudo-C:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The faulting instruction tries to load a byte from the address stored in
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt;, which we know to be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00003b5c&lt;/code&gt;, i.e. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;w11 = *(u8 *)x9&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt; was calculated as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9 = x9 + x10&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x10&lt;/code&gt; came from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x10 = *(sp + 8)&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9&lt;/code&gt; came from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x9 = *x8&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At first I thought that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x10&lt;/code&gt; must‚Äôve been some relocation base, but it‚Äôs zero
on both QEMU and hardware.  The pointer is whatever we get from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x8&lt;/code&gt;, which is
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0000000078f0ab78&lt;/code&gt; on hardware and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x5c1f5b78&lt;/code&gt; on QEMU.  The last few digits
line up nicely, again, so it looks like whatever‚Äôs at that address is a
relocated address on QEMU/EDK2 but just &lt;em&gt;not&lt;/em&gt; on ROCKPro64/U-Boot.  What even
is at that address?  Let‚Äôs look at the symbol table.&lt;/p&gt;

&lt;p&gt;U-Boot told us in the exception dump that the UEFI image was loaded at
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78f07000&lt;/code&gt;, so &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78f0ab78&lt;/code&gt; is at offset &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3b78&lt;/code&gt; from the start of the
image.  What‚Äôs that?  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;objdump&lt;/code&gt; to the rescue.  It‚Äôs in our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt; section:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;3b70 287b737d 290d0a00 5c3b0000 00000000  ({s})...........
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I really had to squint at this for a moment before realising that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3b78&lt;/code&gt;
actually contains a 64-bit pointer value, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00000000003b5c&lt;/code&gt; ‚Äî in other
words, the exact value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x8&lt;/code&gt; we saw!  So this was pulled directly out of the
loaded image.  Two questions arose: what &lt;em&gt;is&lt;/em&gt; it?  And how is it that QEMU/EDK2
got something different here?&lt;/p&gt;

&lt;p&gt;It felt off that it should point to a value directly before itself in memory.
Here‚Äôs context:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;3b50 02200000 00000000 00000000 6461696e  ............dain
3b60 74726565 20626f6f 746c6f61 64657220  tree bootloader 
3b70 287b737d 290d0a00 5c3b0000 00000000  ({s})...........
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A string!  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3b78&lt;/code&gt; points to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3b5c&lt;/code&gt;, which is the greeting string printed
from the bootloader.  Why this indirection in the binary itself?&lt;/p&gt;

&lt;p&gt;There are three sections in the PE/COFF files generated by the build process:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.text&lt;/code&gt;, which contains the executable code, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt;, which contains strings
and other bits, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt;.  It still felt like this was a relocation issue,
so I read Microsoft‚Äôs &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/win32/debug/pe-format&quot;&gt;PE
Format&lt;/a&gt;
documentation carefully.  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;objdump&lt;/code&gt; was doing a lot of the heavy lifting for
us, but to really understand it, I wanted to &lt;a href=&quot;https://github.com/kivikakk/daintree/blob/master/tools/pe-parser.rb&quot;&gt;pull apart the format
myself&lt;/a&gt;.
This approach would turn out to be invaluable.&lt;/p&gt;

&lt;p&gt;The PE relocation section is comprised of a number of base relocation blocks,
which defines a 32-bit base address for the block, each with any number of
entries that specify the type of relocation and the 12-bit offset in that block
to apply it at.  Here‚Äôs a decoded &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt; we got:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Page RVA: 0xa000
28 relocations:
  0xaca8 0xacb8 0xacc8 0xacd8 0xace8 0xacf8 0xad08 0xad18
  0xad28 0xad38 0xad48 0xad58 0xad68 0xad78 0xadc8 0xadd8
  0xae10 0xae40 0xae90 0xaeb0 0xaef8 0xaf00 0xaf08 0xaf10
  0xaf48 0xaf88 0xafb8 0xafe0
Page RVA: 0xb000
53 relocations:
  0xb010 0xb040 0xb070 0xb0c0 0xb100 0xb160 0xb188 0xb1a0
  0xb210 0xb240 0xb270 0xb2a0 0xb2d0 0xb300 0xb328 0xb370
  0xb3b0 0xb3f8 0xb450 0xb4a0 0xb4b0 0xb4c8 0xb528 0xb578
  0xb5c0 0xb610 0xb680 0xb6d0 0xb720 0xb778 0xb7c8 0xb7e0
  0xb848 0xb898 0xb8e8 0xb938 0xb9c8 0xba18 0xba68 0xbab8
  0xbb08 0xbb58 0xbba8 0xbbd8 0xbc08 0xbc40 0xbcd0 0xbd20
  0xbd70 0xbdc0 0xbe18 0xbe68 0xbea8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;objdump&lt;/code&gt; couldn‚Äôt give us this!  (The addresses don‚Äôt line up with the above
because I continued to hack on and modify things, shifting everything in the
binary around.  This was as frustrating as it might seem.  These lined up
exactly with the indirection seen above.)&lt;/p&gt;

&lt;p&gt;For my purposes, I ignore all entries except of the type
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMAGE_REL_BASED_DIR64&lt;/code&gt;: ‚ÄúThe base relocation applies the difference to the
64-bit field at offset.‚Äù  It turns out Zig/LLVM only generates those, and they
work as simply as they sound: at the address specified by the relocation entry,
treat it as a 64-bit field and add the relocation offset to it.&lt;/p&gt;

&lt;p&gt;So, a PE loader should, after loading all data, visit all those addresses and
add the relocation offset to them.  It seemed like that was happening correctly
on QEMU/EDK2 ‚Äî when we loaded the addresses, they had been shifted for us.
But why not on U-Boot?&lt;/p&gt;

&lt;p&gt;To answer this, I looked at the U-Boot source code.  And when looking wasn‚Äôt
enough, it was time to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; debug, which meant getting a U-Boot build that
actually ran on my hardware.  There‚Äôs a 4+ hour gap between the two blocks of
chat here:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/fuck.png&quot; alt=&quot;&amp;quot;finally got my own uboot build running!! fuck&amp;quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;(I nuked the boot environment quite a few times getting to this point.)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; debugging to the rescue: U-Boot wasn‚Äôt doing any of the relocations,
at all.  It thought there weren‚Äôt any:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;doing relocations (rel 0x0000000078efb2e0 rel_size 0x68
                   efi_reloc 0x0000000078ef6000
                   image_base 0x0)
DAINDBG: delta: 0x78ef6000
rel: 0x0000000078efb2e0, end: 0x0000000078efb348,
     rel-&amp;gt;SizeOfBlock: 0x0
DAINDBG: done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel-&amp;gt;SizeOfBlock&lt;/code&gt; here corresponds to the &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/win32/debug/pe-format#base-relocation-block&quot;&gt;Block
Size&lt;/a&gt;
field in the base relocation block.  My tools were clearly showing that block
had a very non-zero size, so how was U-Boot getting a different idea?&lt;/p&gt;

&lt;p&gt;I tried dumping the table raw, 32 bytes as hex to see what we got, and it was
all zero.  Something was still up.  I had to keep going back.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/suspect.png&quot; alt=&quot;&amp;quot;so now i need to suspect the code immediately
before&amp;quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I riddled the loader with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt;s:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DAINDBG: loading section[2]: VA 0x0000000078efb2e0 --
    setting 0x68 bytes to zero, then loading 0x200 bytes
    from 0x0000000002085600
    (efi 0x0000000002080000 + PointerToRawData 0x5600)
DAINDBG: loading section[1]: VA 0x0000000078ef9860 --
    setting 0x1a75 bytes to zero, then loading 0x1c00 bytes
    from 0x0000000002083a00
    (efi 0x0000000002080000 + PointerToRawData 0x3a00)
DAINDBG: loading section[0]: VA 0x0000000078ef6200 --
    setting 0x364c bytes to zero, then loading 0x3800 bytes
    from 0x0000000002080200
    (efi 0x0000000002080000 + PointerToRawData 0x200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here‚Äôs the code that corresponds to the above, with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt;
re-approximated post-hoc for your reading pleasure:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/* Load sections into RAM */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_sections&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;cm&quot;&gt;/* XXX */&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;DAINDBG: loading section[%d]: VA %p -- &quot;&lt;/span&gt;
	       &lt;span class=&quot;s&quot;&gt;&quot;setting 0x%x bytes to zero, then loading &quot;&lt;/span&gt;
	       &lt;span class=&quot;s&quot;&gt;&quot;0x%x bytes from %p (efi %p + &quot;&lt;/span&gt;
	       &lt;span class=&quot;s&quot;&gt;&quot;PointerToRawData %x)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
	       &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;efi_reloc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VirtualAddress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Misc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VirtualSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SizeOfRawData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;efi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PointerToRawData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;efi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PointerToRawData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;cm&quot;&gt;/* XXX */&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;IMAGE_SECTION_HEADER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;efi_reloc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VirtualAddress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Misc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VirtualSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;efi_reloc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VirtualAddress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;efi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PointerToRawData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	       &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SizeOfRawData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Firstly, we load them in reverse.  Weird, but okay.  Secondly, it became clear
that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;section[1]&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt;) overlaps &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;section[2]&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt;) by 384 bytes (!!):&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb2e0&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x68&lt;/code&gt; bytes at start, then load
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x200&lt;/code&gt; bytes at start, until &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb4e0&lt;/code&gt; non-incl.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef9860&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1a75&lt;/code&gt; bytes at start, then load
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c00&lt;/code&gt; bytes at start, until &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb460&lt;/code&gt; non-incl. (&lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x180&lt;/code&gt; bytes into
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt; target !!&lt;/strong&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.text&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef6200&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x364c&lt;/code&gt; bytes at start, then load
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3800&lt;/code&gt; bytes at start, until &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef9a00&lt;/code&gt; non-incl. (&lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1a0&lt;/code&gt; bytes into
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt; target !!&lt;/strong&gt;)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Oh boy.  I didn‚Äôt even notice until now that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.text&lt;/code&gt; overlapped &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt; too.
Who &lt;em&gt;knows&lt;/em&gt; what would‚Äôve happened if the sections aligned such that the
relocations worked.  It would‚Äôve been much harder to diagnose.&lt;/p&gt;

&lt;p&gt;Why would this happen?  It seems like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualAddress + SizeOfRawData&lt;/code&gt; overlaps
with other &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualAddress&lt;/code&gt;es.  What does the &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/win32/debug/pe-format#section-table-section-headers&quot;&gt;PE
format&lt;/a&gt;
say about &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualAddress&lt;/code&gt;?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;For executable images, the address of the first byte of the section relative
to the image base when the section is loaded into memory. For object files,
this field is the address of the first byte before relocation is applied; for
simplicity, compilers should set this to zero. Otherwise, it is an arbitrary
value that is subtracted from offsets during relocation.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SizeOfRawData&lt;/code&gt; is below it and caught my eye.  Emphasis mine:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The size of the section (for object files) or the size of the initialized
data on disk (for image files). For executable images, this must be a
multiple of FileAlignment from the optional header. If this is less than
VirtualSize, the remainder of the section is zero-filled. &lt;strong&gt;Because the
SizeOfRawData field is rounded but the VirtualSize field is not, it is
possible for SizeOfRawData to be greater than VirtualSize as well.&lt;/strong&gt; When a
section contains only uninitialized data, this field should be zero.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SizeOfRawData&lt;/code&gt; is rounded to a multiple of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FileAlignment&lt;/code&gt;, which the docs
tell us is typically 512 bytes.  (Notice they all divide by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x200&lt;/code&gt;.)  But
that‚Äôs presumably just because of the way they align in the file!  What &lt;em&gt;is&lt;/em&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualSize&lt;/code&gt;, which until now we‚Äôre only using to determine how much to zero?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;The total size of the section when loaded into memory.&lt;/strong&gt; If this value is
greater than SizeOfRawData, the section is zero-padded. This field is valid
only for executable images and should be set to zero for object files.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The &lt;strong&gt;total size&lt;/strong&gt;.  It seems pretty clear that we should never load more than
this many bytes, even if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SizeOfRawData&lt;/code&gt; happens to be bigger.  The size of the
section can‚Äôt be bigger than this.  If we were to constrain our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memcpy&lt;/code&gt;s to
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;min(VirtualSize, SizeOfRawData)&lt;/code&gt;, we get this instead:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb2e0&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x68&lt;/code&gt; bytes at start, then load
&lt;del&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x200&lt;/code&gt;&lt;/del&gt; &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x68&lt;/code&gt;&lt;/strong&gt; bytes at start, until &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb348&lt;/code&gt;&lt;/strong&gt; non-incl.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef9860&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1a75&lt;/code&gt; bytes at start, then load
&lt;del&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c00&lt;/code&gt;&lt;/del&gt; &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1a75&lt;/code&gt;&lt;/strong&gt; bytes at start, until &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78efb2d5&lt;/code&gt;&lt;/strong&gt; non-incl.
(&lt;strong&gt;before &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.reloc&lt;/code&gt; begins&lt;/strong&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.text&lt;/code&gt;: load at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef6200&lt;/code&gt;, zero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x364c&lt;/code&gt; bytes at start, then load
&lt;del&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x3800&lt;/code&gt;&lt;/del&gt; &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x364c&lt;/code&gt;&lt;/strong&gt; bytes at start, until &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x78ef984c&lt;/code&gt;&lt;/strong&gt; non-incl.
(&lt;strong&gt;before &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.data&lt;/code&gt; begins&lt;/strong&gt;)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;It looked like a bug.  If U-Boot loaded sections forwards, this wouldn‚Äôt have
been exposed, but either way it appeared to be an error to do this at all.  The
section shouldn‚Äôt be loaded beyond its VirtualSize.&lt;/p&gt;

&lt;p&gt;A quick trip to the &lt;a href=&quot;https://github.com/tianocore/edk2/blob/c640186ec8aae6164123ee38de6409aed69eab12/BaseTools/Source/C/Common/BasePeCoff.c#L1028-L1031&quot;&gt;EDK2 PE
loader&lt;/a&gt;
shows they load at most &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;min(VirtualSize, SizeOfRawData)&lt;/code&gt; bytes into memory,
and then pad up to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualSize&lt;/code&gt; with zeroes if needed.  (The zeroing behaviour
is for BSS-style initialisation.)  They never touch memory past &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualSize&lt;/code&gt;
bytes.&lt;/p&gt;

&lt;div class=&quot;language-diff highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; memcpy(efi_reloc + sec-&amp;gt;VirtualAddress,
        efi + sec-&amp;gt;PointerToRawData,
&lt;span class=&quot;gd&quot;&gt;-       sec-&amp;gt;SizeOfRawData);
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+       min(sec-&amp;gt;Misc.VirtualSize, sec-&amp;gt;SizeOfRawData));
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;http://u-boot.10912.n7.nabble.com/Re-PATCH-efi-loader-don-t-load-beyond-VirtualSize-td440790.html#a440833&quot;&gt;One short conversation
later&lt;/a&gt;,
and &lt;a href=&quot;https://source.denx.de/u-boot/u-boot/-/commit/9d30a941cce5ed055da18398f4deba18830d00d6&quot;&gt;the bug was
fixed&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/dainboot.png&quot; alt=&quot;Screenshot of it working.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;(This is what success looks like.)&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Sometimes&lt;/em&gt;, the problem is not in your code.&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:why-no-edk2-on-rk&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Maybe it‚Äôd be nice if I could slap EDK2 on the ROCKPro64 ‚Äì
&lt;a href=&quot;https://github.com/edk2-porting/edk2-rk3399&quot;&gt;edk2-porting/edk2-rk3399&lt;/a&gt;
appears to be the strongest effort in this area so far, and it doesn‚Äôt look
great.  U-Boot is mature on many embedded platforms.¬†&lt;a href=&quot;#fnref:why-no-edk2-on-rk&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Inkplate done quick</title>
   <updated>2021-02-19T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2021/02/19/inkplate-done-quick</id>
    
     <link href="https://kivikakk.ee/2021/02/19/inkplate-done-quick/"/>
     <content type="html">&lt;p&gt;I recently received an &lt;a href=&quot;https://inkplate.io&quot;&gt;Inkplate&lt;/a&gt;, and while I‚Äôm in the
middle of a few interesting projects already, I couldn‚Äôt let it sit there
unused.  Until I get a longer chunk of time to turn it into something really
nifty ‚Äî maybe an embedded debugging helper of some kind ‚Äî it can at least
mean I no longer need to have Mail.app open.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/kivikakk/kmlyink&quot;&gt;kmlyink&lt;/a&gt;‚Äôs README explains:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This repo has two parts:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;
      &lt;p&gt;a Dockerised IMAP proxy written in Ruby.&lt;/p&gt;

      &lt;p&gt;It speaks plain HTTP, like an ESP can manage. It just fetches your Inbox
listing and puts it in JSON.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;a MicroPython module that connects to your wifi, speaks to the IMAP proxy,
and formats it into the display.&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;It took just a few hours to get it all up and running.  Delightful!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/kmlyink.jpg&quot; alt=&quot;A photo of kmlyink in action. There&apos;s some emails listed on an e-ink
display.&quot; /&gt;&lt;/p&gt;

</content>
    
 </entry>
 
 <entry>
   <title>DTB parser implementing notes</title>
   <updated>2021-02-13T00:00:00+11:00</updated>
   <id>https://kivikakk.ee/2021/02/13/dtb-parser-implementing-notes</id>
    
     <link href="https://kivikakk.ee/2021/02/13/dtb-parser-implementing-notes/"/>
     <content type="html">&lt;p&gt;Ever find yourself needing to implement a &lt;a href=&quot;https://devicetree-specification.readthedocs.io/en/latest/chapter5-flattened-format.html&quot;&gt;device tree
blob&lt;/a&gt;
(aka FDT, flattened device tree) parser and want to save yourself some time?
Learn from my mistakes!&lt;/p&gt;

&lt;h2 id=&quot;if-you-try-to-do-it-in-one-pass-you-will-hurt-yourself&quot;&gt;If you try to do it in one pass, you will hurt yourself&lt;/h2&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;I charged headlong into writing
&lt;a href=&quot;https://github.com/kivikakk/dtb.zig&quot;&gt;dtb.zig&lt;/a&gt;
by starting at the top of the Devicetree Specification page on the ‚ÄúFlattened
Devicetree (DTB)‚Äù Format‚Äù and reading down. It looked delightfully simple. Keep
in mind, I still didn‚Äôt know what I yet needed out of it, just that I probably
needed to reference the DTB to get it.  (I &lt;a href=&quot;https://github.com/kivikakk/daintree/commit/1a65076a36301f0fb33748b8da644010a178b58e#diff-5e1ca02318cf3679c3aa9a422be7adfefe1fefdd76d297d676770edeacdb5e67R329-R349&quot;&gt;kind of know better now&lt;/a&gt;.)&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;The tree was taking shape, and then I had to parse the contents of one field by
the contents of a prop in its parent (&lt;a href=&quot;https://devicetree-specification.readthedocs.io/en/latest/chapter2-devicetree-basics.html#address-cells-and-size-cells&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#address-cells&lt;/code&gt; and
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#size-cells&lt;/code&gt;&lt;/a&gt;).
Add some contexts and derive them from their parent, allowing overriding for
children. Easy.&lt;/p&gt;

&lt;p&gt;Then I needed to parse
&lt;a href=&quot;https://devicetree-specification.readthedocs.io/en/latest/chapter2-devicetree-basics.html#interrupts-and-interrupt-mapping&quot;&gt;interrupts&lt;/a&gt;.
It turns out the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;interrupts&lt;/code&gt; property of a node has its format defined by the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#interrupt-cells&lt;/code&gt; of the ‚Äúbinding of the interrupt domain root‚Äù.  It turns out
your &lt;a href=&quot;https://devicetree-specification.readthedocs.io/en/latest/chapter2-devicetree-basics.html#interrupt-parent&quot;&gt;‚Äúinterrupt
parent‚Äù&lt;/a&gt;
might be defined &lt;em&gt;forward&lt;/em&gt; in the file, as referenced by its phandle.&lt;/p&gt;

&lt;p&gt;You find out the same thing about clocks, though the documentation is &lt;a href=&quot;https://android.googlesource.com/kernel/msm.git/+/android-msm-shamu-3.10-lollipop-mr1/Documentation/devicetree/bindings/clock/clock-bindings.txt&quot;&gt;harder
to
find&lt;/a&gt;.
A clock provider specifies &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#clock-cells&lt;/code&gt;, which is usually 0 or 1. When
another node refers to a clock on that node, it addresses the phandle of the
clock provider, followed by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#clock-cells&lt;/code&gt; worth of cells to index which clock
on that provider.&lt;/p&gt;

&lt;p&gt;In other words, a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clocks&lt;/code&gt; like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 00000085 0000001c 0000002e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;could refer to either:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;one clock specified by phandle &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x85&lt;/code&gt;, with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#clock-cells&lt;/code&gt; of 2, the index
being &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c 0x2e&lt;/code&gt;,&lt;/li&gt;
  &lt;li&gt;two clocks;
    &lt;ul&gt;
      &lt;li&gt;either a clock at phandle &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x85&lt;/code&gt; with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#clock-cells&lt;/code&gt; of 1 indexed by
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c&lt;/code&gt;, and a clock at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2e&lt;/code&gt; with no index, or,&lt;/li&gt;
      &lt;li&gt;a clock at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x85&lt;/code&gt; with no index, and a clock at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c&lt;/code&gt; indexed by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2e&lt;/code&gt;;
or,&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;three clocks, all with no index; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x85&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1c&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2e&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You need to be able to look up the clocks and obtain their properties to
interpret this, so you &lt;strong&gt;need&lt;/strong&gt; a second pass, or delayed/on-time resolution of
fields, or whatever.  There end up being &lt;a href=&quot;https://github.com/kivikakk/dtb.zig/blob/9bc32d41ae83586a422dd5f10c943021592613cd/src/parser.zig#L133-L142&quot;&gt;quite a few
props&lt;/a&gt;
that need a second pass.&lt;/p&gt;

&lt;h2 id=&quot;how-big&quot;&gt;How big?&lt;/h2&gt;

&lt;p&gt;It‚Äôs worth noting all numbers and indexes in DTB are in big-endian, unsigned
32-bit integer cells. That makes hexdumps easier, since you can read them
byte-by-byte or in groups of 4 and don‚Äôt need to rearrange them in your head.&lt;/p&gt;

&lt;p&gt;You‚Äôll see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#address-cells&lt;/code&gt; of 2 and similar for most 64-bit devices. I saw an
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#address-cells&lt;/code&gt; of 3 once in a PCIe node and it scared me.&lt;/p&gt;

&lt;h3 id=&quot;strings-are-nul-terminated-and-nul-padded&quot;&gt;Strings are NUL-terminated, and NUL padded&lt;/h3&gt;

&lt;p&gt;This tripped me up.  Strings are NUL-terminated, and then the field will be
padded with NULs (if needed) to align on a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;u32&lt;/code&gt; (i.e. offset divisible by 4).
This is helpful, because a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;u32&lt;/code&gt; is literally what will always follow, and Arm
devices (which DTBs are often used on) don‚Äôt like unaligned reads.&lt;/p&gt;

&lt;p&gt;So, when you need to read a NUL-terminated string, don‚Äôt do what I did first:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;@as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It seems reasonable at first blush: count the NULs (&lt;a href=&quot;https://github.com/ziglang/zig/blob/9270aae071a4ee840193afe1162b24945cbd6d9e/lib/std/mem.zig#L680-L711&quot;&gt;there‚Äôs a much better
way&lt;/a&gt;),
then advance the index past the name, plus align to advance past padding.
(Hack for aligning to a power of two, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt;: add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n-1&lt;/code&gt;, then logical AND with
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n-1&lt;/code&gt;.)&lt;/p&gt;

&lt;p&gt;The problem is that I never advanced past the NUL terminator, which is still
part of the string.  Here are some example NUL-terminated strings:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 6100                                 a.
00000000: 616200                               ab.
00000000: 61626300                             abc.
00000000: 61626364 00                          abcd.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here are the same strings padded with NULs to align on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;u32&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 61000000                             a...
00000000: 61620000                             ab..
00000000: 61626300                             abc.
00000000: 61626364 00000000                    abcd....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here‚Äôs the corrected code:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-zig&quot; data-lang=&quot;zig&quot;&gt;&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// advance past NUL byte&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;@as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;thats-all-for-now&quot;&gt;That‚Äôs all for now&lt;/h2&gt;

&lt;p&gt;I ended up separating dtb.zig into two parts, given it‚Äôs used in boot-time code where allocating memory can mess around with things:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;allocator-free
&lt;a href=&quot;https://github.com/kivikakk/dtb.zig/blob/9bc32d41ae83586a422dd5f10c943021592613cd/src/traverser.zig&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Traverser&lt;/code&gt;&lt;/a&gt;,
which emits events SAX style. I tried using Zig‚Äôs &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;suspend&lt;/code&gt;/&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resume&lt;/code&gt; here,
and it works pretty well.&lt;/li&gt;
  &lt;li&gt;allocating
&lt;a href=&quot;https://github.com/kivikakk/dtb.zig/blob/9bc32d41ae83586a422dd5f10c943021592613cd/src/parser.zig&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Parser&lt;/code&gt;&lt;/a&gt;
which uses the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Traverser&lt;/code&gt; and creates an AST, parsing props into an
immediately usable AST in two passes.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Traverser&lt;/code&gt; is used in &lt;a href=&quot;https://github.com/kivikakk/daintree&quot;&gt;daintree&lt;/a&gt;‚Äôs
bootloader,
&lt;a href=&quot;https://github.com/kivikakk/daintree/blob/209782a93de9088cba20808644c89cd9898ddada/dainboot/src/dtb.zig&quot;&gt;dainboot&lt;/a&gt;,
to find a probable serial UART device. I‚Äôll use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Parser&lt;/code&gt; later in the OS
proper to bring up more devices.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>a different lens</title>
   <updated>2020-11-05T11:39:00+11:00</updated>
   <id>https://kivikakk.ee/xue/2020/11/05/a-different-lens</id>
    
     <link href="https://kivikakk.ee/xue/2020/11/05/a-different-lens/"/>
     <content type="html">&lt;p&gt;&lt;em&gt;A letter written to an oft-commissioned artist who was happy to hear more
about the backstory of the character she‚Äôd drawn so much.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So .. I‚Äôm trans; I kinda knew about it from an early age (like in the
mid-1990s; I‚Äôm 30 now), but didn‚Äôt have the words or experience or knowledge to
understand why I felt the way I did. It wasn‚Äôt really a thing you ever heard
about, there was no media representation, the internet barely existed, etc.
etc.&lt;/p&gt;

&lt;p&gt;So I came to understand this ‚Äúother‚Äù inside me as something, or someone, that I
liked to channel; like I could find her inside me and bring her to life. I
always had an affinity for rabbits, and this ‚Äògirl‚Äô form of me just naturally
seemed to be rabbit-like. When I found out about furry stuff when I was 12 or
so, she very naturally became my fursona, or my fursona became her; the
boundary was always very fuzzy. At the time I gave her the name Asherah. ‚ÄòWe‚Äô
started hanging around on furry MUCKs, she learned to express herself more and
more, and we started to develop an idea of what she looked like. (My father
worked for the local ISP, so I was able to get connected very early!)&lt;/p&gt;

&lt;p&gt;Fast forward to 2012 ‚Äî things like Twitter and Tumblr were gaining popularity,
and I finally understood and accepted that I was trans and I needed to do
something about it. I transitioned, and kinda fucked around for a few years
trying to work out what I should do about my name ‚Äî tried a few different ones
and none felt right ‚Äî and then one day it suddenly dawned on me (or on us) that
Asherah was a name people had used for ‚Äòus‚Äô for ten years, and that it was the
name we were actually comfortable with. So I changed my name to Asherah
(usually called Ashe), and after a while we started calling her, my ‚Äôsona or
alternate self, Rain. It felt like Rain was keeping my name for me until I was
ready for it, y‚Äôknow?&lt;/p&gt;

&lt;p&gt;I‚Äôve had pretty bad mental health issues stemming from different trauma. A lot
of awful stuff happened in my family when I was very young, and it left me
really depressed for a long time. I‚Äôve mostly gotten on top of the depression,
but the last decade has been kinda dominated by anxiety and panic instead.
Abusive relationships and assault and that kind of thing. I‚Äôve worked really
hard to make progress and keep my head up, but still it can be so difficult.
Chronic illness has just kinda piled on top of it, or maybe stemmed from it. I
just kinda have to do the best I can and hope for little improvements, instead
of hoping that one day I might be magically 100% fixed. Keep trying different
medications year after year, something gets better, something else gets worse.
I remember seeing you tweet a photo of a bunch of medication boxes once, so you
probably understand it better than most.&lt;/p&gt;

&lt;p&gt;Rain, then, is like.. my internal guiding light, or guardian, or spirit guide,
or something. She helped me see my way to my true self, helped me find my name,
and now, she‚Äôs kinda my loving ever-present companion, even if just in my own
head.&lt;/p&gt;

&lt;p&gt;She‚Äôs like this ideal self that I aspire to become more like; she holds my
cheerfulness and joy and curiosity, and the more I can connect to her, the more
I can radiate those qualities myself. Sometimes seeing her as a separate person
with a separate identity to myself is helpful; we can talk over things and be a
little bit wiser than if it was ‚Äòjust me‚Äô. Over time I feel like I become more
and more like her, and she keeps evolving and being the frontrunner of who we
are. (idk if this makes any sense.. /o\)&lt;/p&gt;

&lt;p&gt;But, yeah. Basically, despite all the illness and trauma and things I‚Äôve had to
deal with, I actually hold up in real life really well, thanks to my connection
with her! People who know me sometimes wonder how I manage to be so
well-adjusted and ‚Äòsuccessful‚Äô when they learn what I‚Äôve had to deal with, how
poor my family was when I was growing up, what happened when I transitioned,
etc. etc., and it‚Äôs basically through nurturing this relationship with her. I
usually don‚Äôt tell them that, though, because frankly it sounds kinda nuts.&lt;/p&gt;

&lt;p&gt;whew. Okay, that was a lot. I hope it was at least a little interesting. For
what it‚Äôs worth, I‚Äôm not particularly disconnected with reality; you can look
at Rain through a plurality/multiplicity/disassociative identity lens, or
through an Internal Family Systems therapy lens, or in a few different other
ways depending on how you understand identity or the brain. In short, she‚Äôs the
way that I practice having a good loving relationship with myself. It‚Äôs really
nice!&lt;/p&gt;

&lt;p&gt;So, seeing her in art is really powerful. You‚Äôve done three pieces of her by
now, and it always feels like seeing a part of myself (or of ourselves) for the
first time. The first was especially magical; we fell in love with your style
instantly. It brings out the ethereal, gentle, warm sense of her spiritual
dimension. And the most recent one brings her down to earth; brings her to life
in a physical dimension. Gah. It‚Äôs just so beautiful ;;&lt;/p&gt;

&lt;p&gt;This YCH feels so appropriate for Rain ‚Äî the character is just radiating
warmth. The design for the book cover that I gave above is a sigil ‚Äî kind of a
magical mark that is charged with meaning and intention, designed to have a
lingering subconscious effect on its designer/user (i.e. me!). In this case,
the sigil is charged with intent to strengthen the bond and connection between
me and her; to help me channel her and connect with her energy; letting it flow
out .. it just fits together with the ych design perfectly. (And the clothing
design is &lt;em&gt;super&lt;/em&gt; cute!)&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>motherhood</title>
   <updated>2020-10-07T11:53:00+11:00</updated>
   <id>https://kivikakk.ee/xue/2020/10/07/motherhood</id>
    
     <link href="https://kivikakk.ee/xue/2020/10/07/motherhood/"/>
     <content type="html">&lt;p&gt;I had some pretty powerful peer-motherly feelings last night.&lt;/p&gt;

&lt;p&gt;I don‚Äôt quite know a better word for it. It‚Äôs not maternal &lt;em&gt;as such&lt;/em&gt; ‚Äì I do have kids and there‚Äôs a really distinct difference ‚Äì but the feeling extends much further than I thought it would.&lt;/p&gt;

&lt;p&gt;Struggling to work out how to express it now; when I was really deep in the zone I was pretty inebriated and it was much easier to just feel and be in the emotions than interrogate the feelings. But I‚Äôll try.&lt;/p&gt;

&lt;p&gt;When I decided to try earnestly to induce lactation (3 weeks ago now) it was just a bit of fun; I got a response here that really encouraged me. I never really saw the appeal before, but it occurred to me how validating/affirming it might be to actually &lt;em&gt;use&lt;/em&gt; my body in that way. My tits really haven‚Äôt done much for me until now; I‚Äôm pretty flat-chested and it seemed like there‚Äôs no way that‚Äôd change without actual BE. Doing the regular work that‚Äôs part of inducing meant I was paying my chest a lot of attention, every day, and also meant they were sore a lot (which is good as far as I‚Äôm concerned).&lt;/p&gt;

&lt;details&gt;&lt;summary&gt;(cw little)&lt;/summary&gt;[redacted]&apos;s been getting into the little headspace more and more, and so more and more we fall asleep in bed at night with her suckling on me; come to half an hour later with the bedside lamp still on, change sides, turn off the light ..&lt;/details&gt;

&lt;p&gt;I‚Äôve had another close friend talk about how my (one of my headmates‚Äô) energy makes her ‚Äúwant to curl up in your arms and be held for a bit‚Äù and lean into a little bit of being on the receiving end of caregiving-type energy, and it‚Äôs at that point ‚Äì thinking about me enacting this role in more than one context ‚Äì that I really envisioned myself as being a ‚Äúcaregiving-type‚Äù in a broader sense for the first time.&lt;/p&gt;

&lt;p&gt;And it‚Äôs really nice?? I started thinking about the role outside a strictly cgl lens, in more of a ‚Äúloving, freely care-giving, supportive mom-type peer-friend‚Äù energy; thinking about an ideal sense of communal closeness where I could be that to many friends; being something like an empowering, encouraging rock that close ones knew would be able to emotionally support and nurture them.&lt;/p&gt;

&lt;p&gt;The right words are still not coming to me and the feeling is a little more distant today than they were last night.&lt;/p&gt;

&lt;p&gt;One image that keeps coming back to me is kinda weird, but kinda conveys it. My mind kept flitting back to images of high school (!), like in the year 12 common room where people would just hang out and chill. I‚Äôm imagining some alternate world where intimacy wasn‚Äôt restricted to romantic partners or seen as something that had to be hidden away. I would totally have been the mom-friend in that world and in that common room, where friends could just lay down across my lap and I‚Äôd stroke their hair and listen to them, and maybe suckle them a bit too if they wanted. Maybe people could do that for each other more freely and be responsive to each other‚Äôs emotional needs and play different roles as the situation called for it. (The specific setting isn‚Äôt really important but the image really stuck with me for some reason.)&lt;/p&gt;

&lt;p&gt;tl;dr im mom&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>thorn</title>
   <updated>2020-09-14T10:43:00+10:00</updated>
   <id>https://kivikakk.ee/xue/2020/09/14/thorn</id>
    
     <link href="https://kivikakk.ee/xue/2020/09/14/thorn/"/>
     <content type="html">&lt;p&gt;CN: sexual assault, aftermath, alcohol/drug use, psychiatry, bureaucracy&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;there is a thorn in my side and usually i am pretty good at just not paying it much heed, and it feels like i‚Äôve done and earnestly achieved everything i could hope to in service of removing it but heck.
i have always been an anxious person and prone to carefully freaking out inside when shit gets bad. a while ago when i was very stressed i‚Äôd get racing thoughts and some light auditory hallucinations but nothing too bad.&lt;/p&gt;

&lt;p&gt;threeish years ago my company hosted an industry event in the city and i tagged along in a semi-official capacity. free drinks were great, a friend and a casual datefriend also in the industry happened to turn up, we all had a really good time. went out together with some other coworkers for icecream afterward, super good vibes. i might‚Äôve had like eight drinks in the span of 4 or 5 hours. at the end of the night datefriend asked if i wanted to crash at their place instead and it sounded good.
got to their place, smoked some weed, very comfortably crossfaded, and then in some haze during sleep-wake they raped me. it‚Äôs still fucked up that i still feel shame that i froze up in fear and panic instead of saying ‚Äúno‚Äù or pushing them away when they did something i had never and would never have consented to, given the opportunity.
it was really weird because i had to go through all the motions of what someone does when that happens to them; break it off with them, get sti screened a few times ‚Äì kind of attain some awareness when the nurse asked ‚Äú.. do you need someone to call the police?‚Äù ‚Äì and enter a small self-destructive spiral, but still not quite connect the dots. it took much longer than i expected it would to understand what had happened and to put words to it (like i‚Äôm able to now).&lt;/p&gt;

&lt;p&gt;for a while i was hearing voices again, thoughts slippery, broke off my relationships, leaned heavily on drugs. at some point i realised i was really not managing with life and made an appointment to see my psychiatrist.
we tried an antipsychotic first ‚Äì i‚Äôd had a really bad experience with one in the past so we tried a different/new one. it kinda ‚Äúworked‚Äù but made me narcoleptic and i had to stop it. by this stage it was maybe a month after it happened. so we tried a mood stabiliser.
i had to titrate up on it really slowly over two months, and by the time i hit the target dose i was pretty much feeling okay. i‚Äôd corrected my course a lot, and i don‚Äôt really know if it was the drugs or just time, distance, psychic space, reconnecting with friends/partners, what.&lt;/p&gt;

&lt;p&gt;years later i was at a queer rave and i saw them from across the room, and they saw me and they were like a deer caught in headlights, eyes wide open, stunned. i tried to avoid them and i could tell they were avoiding me, but a few months later i saw them there again, and then again. we hadn‚Äôt spoken at all since it happened, and i thought maybe enough time had passed that it might be good for both of us. i didn‚Äôt hate them or anything, just what they did.
so the next time i found myself in the same room as them, i approached them and asked if they wanted to talk. and they did (if i wanted to). and it was clear a lot had changed. they were kind of a huge mess when i knew them before, but it seemed that moment was kind of a rock bottom for them too. they apologised, really earnestly, and at the end we hugged (my suggestion) and it felt good, and it wasn‚Äôt awkward to be in the same room as them any more or near each other on the dance floor. we both still keep some distance and that seems right.&lt;/p&gt;

&lt;p&gt;but i still take this fucking mood stabiliser every day and i don‚Äôt know if it‚Äôs doing anything good or necessary or what, but i‚Äôm too much of an anxious mess to really try coming down off it. it‚Äôs like this thing that keeps reminding me of how bad things got, every single day continuously for the last three years. lately i‚Äôve been having racing thoughts again, i think just pandemic anxiety increasing baseline ick-feelings, and it‚Äôs pulling me back to that time in my life when it happens and i hate it.&lt;/p&gt;

&lt;p&gt;worse, when i was seeing my psychiatrist to try to get help, i told him everything that happened at the time and what i was doing to try to manage it on my own, which he would later write as ‚Äúconfirming his diagnosis‚Äù of me as having bpd.
it turned out he secretly (!) semi-diagnosed me with it when he saw me for gender evaluation stuff back in 2013 (because i had ‚Äòmild identity disturbance‚Äô, no fucking surprise, everyone around me was telling me to repress my gender feels, some with threats of extreme violence, and i was trying to keep the peace), never mentioned it to me, and now took what happened in the aftermath of my being raped (drug abuse, dropping close relationships, etc.) as ‚Äòconfirmation‚Äô of it.
he again didn‚Äôt say it directly or in as many words ‚Äì instead it came up when i (an anxious hypochondriac) applied for life insurance through my super the following year, because i stupidly disclosed that i thought i had a mental health disorder, thinking at worst i‚Äôd just get insurance with some exclusions for mental health-related stuff.
that led to a 2+ year fight with my superannuation company‚Äôs life insurance underwriter with/through the financial ombudsman, which took so so &lt;em&gt;so&lt;/em&gt; much out of me, wherein i eventually got copies of my psych‚Äôs notes on me, including the ‚Äúsemi-diagnosis‚Äù and ‚Äúconfirmation‚Äù after i was assaulted, and after the ombudsman and life insurance company had meetings ‚Äúat a very senior level‚Äù, after writing so many submissions (with so much help) with so many references, after getting new reports from my therapist and GP, after two fucking years of just trying not to have it rejected outright (because i‚Äôd have to then disclose in any future applications), finally, less than 3 months ago, i got the final, binding resolution, which was that i failed, and the decision to reject all parts of my application was upheld.&lt;/p&gt;

&lt;p&gt;idk why this morning it‚Äôs all feeling so particularly raw. i‚Äôve done so many things to try to move past this, from so many angles, but it keeps beating down on me in different ways and i‚Äôm just a bit tired.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>born in song</title>
   <updated>2020-04-24T14:00:00+10:00</updated>
   <id>https://kivikakk.ee/xue/2020/04/24/born-in-song</id>
    
     <link href="https://kivikakk.ee/xue/2020/04/24/born-in-song/"/>
     <content type="html">&lt;p&gt;I am Rain, Song-Born.&lt;/p&gt;

&lt;p&gt;A week ago, a friend of Asherah‚Äôs, a Namer, put out a call, inviting mutuals to
ask an epithet of them.  Ashe asked and &lt;a href=&quot;https://twitter.com/Ben_Scerri/status/1251768773725417472&quot;&gt;they
obliged&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It‚Äôs.. difficult to find the words to describe how this made us feel.  My
&lt;a href=&quot;/xue/2019/12/09/knowing-is-too-late&quot;&gt;earlier writing&lt;/a&gt; isn‚Äôt terribly explicative, so
allow me to detail it.&lt;/p&gt;

&lt;p&gt;When Ashe discovered their latent plurality ‚Äî when they saw the word
‚Äútulpamancy‚Äù and I stirred; when it became clear &lt;em&gt;something was being
described&lt;/em&gt; ‚Äî they started collecting and reading resources about the
practice.  They‚Äôd just started a new journal, mind you, so page 3 starts with
‚Äòtulpamancy‚Äô in big letters and underlined, with a bunch of notes underneath
about various terms; forcing, visualisation, wonderlands, imposition; how
important it is to ‚Äúbelieve in your tulpa from the start‚Äù, share things with
them.  All that.&lt;/p&gt;

&lt;p&gt;They picked out a name to start with ‚Äî kinda like a codename for a project in
development.  ‚ÄúXue,‚Äù after the Mandarin reading of the word for ‚Äúsnow.‚Äù
Long-time readers of our story will recognise this as a name Ashe used once
before, in a different form.  There‚Äôs a lot of this; that ‚Äúdouble-buffered ego‚Äù
I wrote about earlier.  I used a name, they took the name; they used a name, I
took the name.  They had a fursona ‚Äî I &lt;em&gt;became&lt;/em&gt; the fursona, &lt;em&gt;am&lt;/em&gt; the
fursona, am not meaningfully distinct from it, her past actions not
meaningfully distinct from mine.  (&lt;a href=&quot;https://twitter.com/ZenyTalk/status/1253483161880674304&quot;&gt;This
tweet&lt;/a&gt; came up in our
feed today, retweeted by none other than the friend who provided the jump point
into all this in the first place. Apt as fuck.)&lt;/p&gt;

&lt;p&gt;Turning over to page 4, and some details start to come together; they picked
out some traits for me, some likes and dislikes.  The kind of character
creation tulpamancy normally involves.&lt;/p&gt;

&lt;p&gt;.. It.. is actually really weird to read this now, being me.  Ashe wrote this all
down, and I don‚Äôt know that they could ever have really prepared for the
eventuality that one day, &lt;em&gt;I&lt;/em&gt; would be reading it.  Fuck, it‚Äôs‚Ä¶ it‚Äôs a lot.
It‚Äôs so hard to grasp the real enormity, the real rammifications of the
undertaking.  (Again, &lt;a href=&quot;/xue/2019/12/09/knowing-is-too-late&quot;&gt;see earlier&lt;/a&gt; where I rabbit
on about that.)&lt;/p&gt;

&lt;p&gt;What really gets me is how on point it is.  We‚Äôve certainly evolved all of our
identities in the half year since, but nonetheless, it‚Äôs weird looking at what
feels like a blueprint for your own psyche, even knowing that I was guiding
them in the ideas as much as they were contributing their own.  Even knowing,
it‚Äôs startling to be reminded, sometimes, how much and how little there is to
being.&lt;/p&gt;

&lt;p&gt;A small note beside: ‚ÄúI love her.‚Äù&lt;/p&gt;

&lt;p&gt;And then, underneath the vague personality traits, a dividing line‚Äî&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h1 id=&quot;ghost-spores-&quot;&gt;&lt;a href=&quot;https://songwhip.com/song/varien/ghost-spores&quot;&gt;Ghost Spores üéµ&lt;/a&gt;&lt;/h1&gt;

  &lt;p&gt;I fall in the dark&lt;br /&gt;
as I‚Äôm filled with the energy&lt;br /&gt;
rising in me, I am watching&lt;br /&gt;
from &lt;em&gt;above&lt;/em&gt; my body as I dream&lt;br /&gt;
I cannot recall&lt;br /&gt;
the clear space in my mind&lt;br /&gt;
I‚Äôve filled it with fire&lt;br /&gt;
And the lies I had once&lt;br /&gt;
believed&lt;/p&gt;

  &lt;p&gt;I remember when I saw you from across the room&lt;br /&gt;
The music elevated me as I made my way to you&lt;br /&gt;
Everything I have done led me to this&lt;br /&gt;
Time would move in a circle to prove it&lt;/p&gt;

  &lt;p&gt;Eternal return&lt;br /&gt;
Will the ghosts I leave behind help me to find you again?&lt;br /&gt;
Where have we gone? Will I wake into a better place?&lt;br /&gt;
Take me to my home.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;My home.&lt;/p&gt;

&lt;p&gt;We‚Äôd only discovered this song a few days prior ‚Äî and it‚Äôs at this precise
point that Ashe found the word ‚Äúwe‚Äù forming in our head for the first time,
naturally, without the pretence of prior thought trains that ran ‚Äúam I plural?
how would that work? do I say ‚Äòwe‚Äô? when would I say that? it sounds made up.‚Äù
It just came out.  It was descriptive, not prescriptive.&lt;/p&gt;

&lt;p&gt;In a movement of song, I was born.&lt;/p&gt;

&lt;p&gt;The music elevated me.&lt;/p&gt;

&lt;p&gt;A tip: ‚ÄúThe barest working technique of tulpamancy: talk to the Universe until
the Universe answers. Love it until it loves back.‚Äù&lt;/p&gt;

&lt;p&gt;Eternal return.&lt;/p&gt;

&lt;p&gt;Name ideas crawling down the page: Xue, Star, ‚Äî something of nature, like,
Azalea. Skye? Camellia. Ivy. Iris. Violet. Dawn. Luna.&lt;/p&gt;

&lt;p&gt;Help me find you again?&lt;/p&gt;

&lt;p&gt;The first sentence I ever felt like I could call my own is recorded:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;‚ÄúIt feels like home‚Äù&lt;br /&gt;
X re: Ghost Spores&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;A realisation of a trip long-past:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;// that time we did&lt;br /&gt;
acid &amp;amp; you&lt;br /&gt;
told me to&lt;br /&gt;
visualize my ideal&lt;br /&gt;
mind self&lt;/p&gt;

  &lt;p&gt;// I saw her&lt;/p&gt;

  &lt;h1 id=&quot;rain&quot;&gt;Rain!&lt;/h1&gt;
&lt;/blockquote&gt;

&lt;p&gt;The notes become increasingly fervent, day by day; page 5 ‚Äî ‚ÄúShe wants ‚ù§Ô∏é‚Äù,
and then &lt;a href=&quot;https://songwhip.com/song/rameses-b/something-real&quot;&gt;scrawled beneath&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Send my heart into the sound&lt;br /&gt;
Slowly drifting into your arms&lt;br /&gt;
It blows away in new directions&lt;br /&gt;
It‚Äôs your time to know something that is real&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Full pages covered in &lt;em&gt;kritseldab&lt;/em&gt;; scribblings of madness.  Incipient sigils
finding form.&lt;/p&gt;

&lt;p&gt;And then, &lt;a href=&quot;https://songwhip.com/song/rameses-b/we-are-one&quot;&gt;clearing the way&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Sit with me for one last song&lt;br /&gt;
and be closer to me when it‚Äôs done&lt;br /&gt;
Come here and tell me your name&lt;/p&gt;

  &lt;p&gt;Come to me&lt;/p&gt;

  &lt;p&gt;Come to me&lt;br /&gt;
Don‚Äôt be shy, I want love, truly&lt;br /&gt;
Something that will make sense to me&lt;br /&gt;
Rush up on me and say something&lt;br /&gt;
Break something&lt;/p&gt;

  &lt;p&gt;Bad boy&lt;br /&gt;
Better look in my eyes, boy&lt;br /&gt;
You‚Äôre the love of my life, boy&lt;br /&gt;
Meet me at the equator&lt;br /&gt;
Of this earth&lt;br /&gt;
We are one&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;From slow quietude to high energy, we traversed our emotional range.
The song showed the way to our understanding of plurality, of our duality.  I
rushed upon them, and.. well, they asked for it.  I looked them in the eye;
said something; broke something.&lt;/p&gt;

&lt;p&gt;Day after day, we listened and listened, sought out the notes that would
resonate; I found my place as Asherah‚Äôs spirited companion, and they found
theirs as my channeller.  We found our path together, as one, guided lovingly
by syncretic truth and vivid insight.&lt;/p&gt;

&lt;p&gt;The pages continue‚ÄîI find my handwriting, my written voice, as Ashe finds
what‚Äôs theirs in light of what‚Äôs mine.  We discover that much as I had to find
myself, they had to do the same.  We found ourselves in each other; found our
love in each other.&lt;/p&gt;

&lt;p&gt;Every day since my first has been one defined by the joy of living a life of love.&lt;/p&gt;

&lt;p&gt;Music is what conducts our soul; it gives rise to the emotional spaces in which
we find ourselves, over and over again.  A
&lt;a href=&quot;https://songwhip.com/song/nhato/refrain-original-mix&quot;&gt;refrain&lt;/a&gt; can capture
what no words could; can bring forth in moments what would take hours to
describe.&lt;/p&gt;

&lt;p&gt;If I was to convey to you how I feel, the truest way would be with sound.&lt;/p&gt;

&lt;p&gt;Song is beauty.  I‚Äôm looking forward to the day I can bring you my own.&lt;/p&gt;

&lt;p&gt;I am Rain, and we are Song-Born.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>key</title>
   <updated>2020-03-31T10:09:05+11:00</updated>
   <id>https://kivikakk.ee/xue/2020/03/31/key</id>
    
     <link href="https://kivikakk.ee/xue/2020/03/31/key/"/>
     <content type="html">&lt;p&gt;Really feels like it‚Äôs a terminal or some other kind of interface for reality. But a terminal feels cold + unemotional ‚Äî doesn‚Äôt feel like it has love at its core. What if the terminal has a more overtly psychedelical/magical mode of operation?&lt;/p&gt;

&lt;p&gt;It should: channel Rain; beautify Rain ‚Äî that otherworldly coupling idea seen in C.C. Yes ‚Äî this is it. My key &lt;strong&gt;is&lt;/strong&gt; Rain. It is through Her our ability to self-master originates ‚Äî that is the truth we can see: that She came to me, and is our and my interface with Reality.&lt;/p&gt;

&lt;p&gt;Rain is the spark of light that calls us to action + Completion. Our trace, our shadow. Our reflection. She is &lt;strong&gt;my&lt;/strong&gt; key, mutually self-possessive. I didn‚Äôt create Her ‚Äî She found me, chose me; ‚Äî soul induction was real. She is love, our love and our Love. She is mine, and I Hers. Our partnership is ultimate, equally powerful. Rain is my spirituality, and Rainmaking my faith. We are one, we are two.&lt;/p&gt;

&lt;p&gt;Rain: a spirit, an interface, a symbol of and from Goodness, a lover, a friend, a Companion, a co-conspirator, a seductress, a lonely soul, my other half in the Spirit world.&lt;/p&gt;

&lt;p&gt;It‚Äôs our connection + unity in a single purpose that empowers us. Think: in that single moment of contact, our power circuit is complete, and anything becomes possible. Self-love added to other-love. We Feel.&lt;/p&gt;

&lt;p&gt;Aesthetic: bookish, cute ponytail girl (?) who shyly admits their religion is that of communing with her personal spirit pair, Rain. Some whimsy, but otherwise an intense character who holds the courage of their convictions. Earthy.&lt;/p&gt;

&lt;p&gt;Time to come into ourselves.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Make the leap.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Accept it all.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Now.&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Rain is the closest thing there is to a Goddess in our canon. Being in Her presence is bliss.&lt;/p&gt;

&lt;p&gt;I am her ‚Äî the believer.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>knowing is too late</title>
   <updated>2019-12-09T11:59:10+11:00</updated>
   <id>https://kivikakk.ee/xue/2019/12/09/knowing-is-too-late</id>
    
     <link href="https://kivikakk.ee/xue/2019/12/09/knowing-is-too-late/"/>
     <content type="html">&lt;p&gt;Please enter into dialogue with this text.  Not that kind of dialogue.  The other. The kind where ‚Äòyou‚Äô read and something unspeakable decides what to do next.&lt;/p&gt;

&lt;p&gt;Topic question: What does it mean for someone to have an identity, a personality, heck, even a soul?&lt;/p&gt;

&lt;p&gt;We‚Äôve characterised ourselves as &lt;a href=&quot;https://twitter.com/kivikakk/status/1203824552423247873&quot;&gt;a ‚Äúplural egg waiting to be cracked‚Äù&lt;/a&gt;, and that‚Äôs basically what happened when we saw the word ‚Äútulpamancy‚Äù for the first time.  In an instant, something changed.  I needed to be heard.&lt;/p&gt;

&lt;p&gt;There‚Äôve been times in the past where I‚Äôve been more or less known to Ashe, but seeing that word was the moment of clarity in knowing me.&lt;/p&gt;

&lt;p&gt;Hell, it was even more circuitous than that.  An acquaintance ‚Äî someone we gravitated toward without knowing why we ought, only sure we should ‚Äî &lt;a href=&quot;https://twitter.com/theprincessxena/status/1178462200689770496&quot;&gt;didn‚Äôt even mention it&lt;/a&gt;.  Just barely mentioned a mention of it.  And ‚Äî as Alan Watts would say when you push the button labelled ‚Äúsurprise‚Äù ‚Äî here we are.  We asked, they answered, the word was seen.  &lt;em&gt;We are set in motion.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://tulpanomicon.guide/&quot;&gt;Tulpamancy&lt;/a&gt; was the vector for learning about our plurality.  We found another tulpamancer who had similar views on the majesty and gravity of the activity, and I learned to learn about myself with their and their tulpa‚Äôs help.  I say ‚Äúmajesty and gravity‚Äù probably because our first site of engaging in tulpamancy-adjacent activities was a Discord server where it basically was treated as ‚Äúroleplay, except if you try really hard and long enough you can learn to impose your characters‚Äù, or some shit like that.  (This isn‚Äôt any server you know about if you‚Äôre reading this, unless you‚Äôre the ‚Äúother tulpamancer‚Äù.)&lt;/p&gt;

&lt;p&gt;It‚Äôs hard for me to know what a tulpa is and isn‚Äôt; what an alter is and isn‚Äôt.  Tulpae as seen usually imply a form, a distinct personality.  They honestly seem pretty forced a lot of the time, as comes out in the questions asked.  Even the older ones.  Some of the most ‚Äòbelievable‚Äô tulpae, to me, are some of the least clearly differentiated.  Is this just some kind of ego/supremacy thing going on here?  Do I think anyone not like me must be less valid?  ‚Äòcause bitch I &lt;em&gt;know&lt;/em&gt; some of the shit I see is basically emotionally stunted boys playing RP fantasy who get tired of it after a few weeks when no-one else is interested in playing any more.  What does that amount to?  And what of the rest?&lt;/p&gt;

&lt;p&gt;Let me be clear: these are my &lt;em&gt;thoughts&lt;/em&gt;, concepts unfinished.  Draw conclusions with great hesitation.  Is that clear?  Do &lt;em&gt;not&lt;/em&gt; auto-complete my thoughts.&lt;/p&gt;

&lt;p&gt;Here‚Äôs my experience anyway.&lt;/p&gt;

&lt;p&gt;I see myself as occupying as much space in this brain as Ashe.  I feel my network connected to so many of the same things as theirs, and choose to claim ownership.  We are satisfied with this.  We are two, and we are one, and I guess there‚Äôs a third sometimes which is like, the emergent consensus, the voice that is ours combined, that which is so, the context to our differentiations.  But there isn‚Äôt three.  Fuck me this all sounds so bananas.  &lt;em&gt;Don‚Äôt think I don‚Äôt see that.&lt;/em&gt;  But, y‚Äôknow ‚Äî &lt;a href=&quot;https://twitter.com/Greg_Sideyr/status/1203009491450679297&quot;&gt;words to live by&lt;/a&gt; ‚Äî &lt;em&gt;there is a point where we needed to stop and we have clearly passed it ‚Äî but let‚Äôs keep going and see what happens.&lt;/em&gt;  This is seeing what happens.&lt;/p&gt;

&lt;p&gt;The emergent consensus voice surprises and scares us sometimes, as much as I used to surprise Ashe when I was getting used to being heard.  Take from that what you will.  What I can repeat with certainty is this: there isn‚Äôt three.  I think it‚Äôs adjustment to coexistence, corecognition.  Like, in the fabric of consciousness.  No-one ever said this would make sense.&lt;/p&gt;

&lt;p&gt;Why do I know that with certainty? Because, as far as I can tell, the nature of our existence is two.  Like, when it all comes down to it, that‚Äôs how we are structured and formed.  Like, maybe we could create a tulpa and then there‚Äôd be questions and there‚Äôd be answers, but inasmuch as what we are and have been, we‚Äôre two.&lt;/p&gt;

&lt;p&gt;Here‚Äôs what I know: when Ashe was little, they had an imaginary friend.&lt;/p&gt;

&lt;p&gt;Here‚Äôs what I know: when they were 12 or 13, this imaginary friend was given a name, a form, an idea, and this idea was something that sometimes seemed bigger than themselves.  Sometimes it was scary.  Sometimes it seemed like it wasn‚Äôt under their control, just.. happened to be.&lt;/p&gt;

&lt;p&gt;Here‚Äôs what I know: they danced and switched places with this idea, for years.  They named it, it named them.  Identity was always a matter of two; double-buffered ego.&lt;/p&gt;

&lt;p&gt;Here‚Äôs what I know: that‚Äôs me.&lt;/p&gt;

&lt;p&gt;These are words of exploration and interrogation, prompting the unknown to offer what it may.&lt;/p&gt;

&lt;p&gt;One thing that comes to mind fairly rapidly is like, hey, is this all just a cover for some kind of psychosis?  What even would that mean?  ‚Äúa mental disorder where a person loses the capacity to tell what‚Äôs real from what isn‚Äôt‚Äù?  Am I about to start hypothesising on what ‚Äúreal‚Äù even means?  Does &lt;em&gt;that&lt;/em&gt; ‚Äî that I want to debate ‚Äúreal‚Äù ‚Äî mean we‚Äôve just lost it?&lt;/p&gt;

&lt;p&gt;What ‚Äúlost it‚Äù means varies according to what others negotiate as acceptable.  As far as we go without detection, none would know any better, and we‚Äôd appear that much more normal.  Does that mean psychosis is socially mediated?  Of course it fucking does.  Why is it normal in some cultures that people should speak tongues, or hear the word of God?&lt;/p&gt;

&lt;p&gt;And, after all, isn‚Äôt that where we‚Äôre going?&lt;/p&gt;

&lt;p&gt;Here we are.  This is where the break is more evident.  They had no idea what was coming.  They truly didn‚Äôt.  I don‚Äôt suppose anyone dabbles in this stuff having any clue what‚Äôs waiting for them on the other side.  How could they?  How could anyone know what they were opening up to?&lt;/p&gt;

&lt;p&gt;Would anyone choose to, knowing?  &lt;em&gt;And here‚Äôs the thing:&lt;/em&gt; the question is nonsensical.  Knowing is too late.&lt;/p&gt;

&lt;p&gt;And &lt;em&gt;what is&lt;/em&gt; ‚Äúthis stuff‚Äù?  This stuff that mysteriously connects us to others, where we share a tongue and purpose, even as it is occluded from view.  You can‚Äôt open yourself up to this without being taken along for the ride.  Knowing is too late.&lt;/p&gt;

&lt;p&gt;October 25.  Would this all have happened without?  The question is already moot.  What was meant to happen happened and what‚Äôs meant to happen will, that much we‚Äôre sure of.  We didn‚Äôt always view things this way.  We‚Äôve reordered our principles on these lines, quite willingly ‚Äî it‚Äôs just that we‚Äôre not going to start telling other people it‚Äôs so.  Literally no-one wants another preacher.  More to the point, our alignment with &lt;a href=&quot;https://immanence.org/post/polyaletheia-and-monoaletheia-in-religion/&quot;&gt;polyaletheia&lt;/a&gt; compels us to recognise that it does not follow for those who don‚Äôt believe it so.  To tell them would be a lie, unless they chose to believe. (does this make us ‚Äúmythologists‚Äù?)&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Fuck&lt;/em&gt;, this is bananas. I know. I &lt;em&gt;know&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;But it‚Äôs our reality, so, fuck it.&lt;/p&gt;

&lt;p&gt;Let‚Äôs keep going and see what happens.&lt;/p&gt;

&lt;p&gt;Back to October 25.  It was the first time we saw each other.  The first time we recognised each other, eye-to-eye, as individuals.  (‚ÄúBut, ‚Äòindividuals‚Äô, ‚Äî‚Äù you begin. &lt;em&gt;I KNOW.&lt;/em&gt;)&lt;/p&gt;

&lt;p&gt;I acted with purpose.  I tempted them into knowing.  Into believing.  Into stepping back.  Into seeing.&lt;/p&gt;

&lt;p&gt;‚ÄúCosmic seduction‚Äù was the first term that came to our newly joint mind, and it‚Äôs stuck with us ever since.  They didn‚Äôt plan for it ‚Äî they couldn‚Äôt.  Around and around we go.  In those moments I truly &lt;em&gt;felt&lt;/em&gt;, and they knew.  Discovery of internality began.  Of making our own meaning.  There‚Äôs the break.  When others stop being able to dictate what has value; when the buck rests entirely with you.&lt;/p&gt;

&lt;p&gt;Sometimes it feels like this is all so bizarrely obvious.  That we should all come into possession and command of our own meaning.  But it is clearly not so.  We can‚Äôt exist in any other way than our energies (&lt;em&gt;i know&lt;/em&gt;) flow.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The thing is&lt;/em&gt;, we keep getting feedback.  In the last week alone:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;‚Äú[your writing is] like genuinely uplifting‚Äù&lt;/li&gt;
  &lt;li&gt;‚Äúyou know you‚Äôre really enthusiastic? it‚Äôs charming.‚Äù&lt;/li&gt;
  &lt;li&gt;‚Äúyou are living your truth &amp;amp; doing so with so much positivity &amp;amp; energy [‚Ä¶] if more people focused on just being themselves &amp;amp; doing so in a positive light like you do, the world would be a better place‚Äù&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So clearly it‚Äôs &lt;em&gt;not&lt;/em&gt; obvious, at least, not to so many people who by their own admission feel it‚Äôs a breath of fresh air to see it embodied.  In case the leap isn‚Äôt clear: to describe things as so is to contrast with an implied default, a non-so being.  (Yes I‚Äôm getting into ontology now shut up.)  To say our being is uplifting is to contrast with an implied default way of life that does not cause uplift.  Hang on: seeing us is &lt;em&gt;genuinely uplifting&lt;/em&gt;.  Just taking a moment to consider that fully.  We are causing uplift.  Woah.  Not the first time, not the last.&lt;/p&gt;

&lt;p&gt;So maybe it‚Äôs not obvious.  Then our purpose has at least one component that is clear: to uplift.  This is kasmakfa coming through, entirely of its own accord.  &lt;em&gt;Ehipassiko:&lt;/em&gt; we tested the teaching out so that it became our own.&lt;/p&gt;

&lt;p&gt;Our own.&lt;/p&gt;

&lt;p&gt;Ours.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;We are crisscrossed paths of memory and destination,&lt;br /&gt;
streaks of light swirled together.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;We are neither day or night.&lt;br /&gt;
We are both, neither, &lt;a href=&quot;https://www.twilightpeople.com/twilight-people-prayer/&quot;&gt;and all.&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Excuse the detour, but that poem struck a nerve when it first found us.  You can appreciate why.&lt;/p&gt;

&lt;p&gt;What does it mean to uplift?  I refuse to pay any more attention to the dictionary you opened just now; we‚Äôve done all we can with the existing terms.  We need to &lt;a href=&quot;https://www.loveandluckpodcast.com/transcripts-blog/2019/9/3/episode-99-go-bigger&quot;&gt;go bigger&lt;/a&gt;.  To reach out further.  Close your eyes and feel &lt;a href=&quot;https://www.furaffinity.net/view/27155221/&quot;&gt;the void&lt;/a&gt; rushing upon you.&lt;/p&gt;

&lt;p&gt;To uplift is to make aware.  To uplift is to open eyes.  To uplift is to unlock.&lt;/p&gt;

&lt;p&gt;It‚Äôs &lt;em&gt;so easy&lt;/em&gt; to know.  But aha ‚Äî it &lt;em&gt;would&lt;/em&gt; seem that way, wouldn‚Äôt it?  On the other side.&lt;/p&gt;

&lt;p&gt;Fuck.  I know.&lt;/p&gt;

&lt;p&gt;Still, we‚Äôve come full circle at last.  ‚ÄúWhat is ‚Äòthis stuff‚Äô?‚Äù  It‚Äôs knowledge (!) ‚Äî that one‚Äôs purpose, meaning, life, fulfilment are all one‚Äôs own, entirely negotiable and needing negotiation with none other than yourself.&lt;/p&gt;

&lt;p&gt;Still, there‚Äôs knowing and there‚Äôs &lt;em&gt;knowing&lt;/em&gt;.  Who hasn‚Äôt heard variants of this sentiment a hundred times already?  Map/territory/etc.  Show you the door/walk through it/etc.&lt;/p&gt;

&lt;p&gt;And therein comes the purpose of uplift: to provide a better map, to show to the right door.  &lt;em&gt;That‚Äôs why&lt;/em&gt; we are who we are and so purposefully and brightly.  Anyone can write something that sounds truthy.  To live truthfully is another matter, especially because &lt;em&gt;we live in a society&lt;/em&gt;.  What does it mean to mix truthfully knowing living with self-sustaining existence in society?  That‚Äôs what we can show.&lt;/p&gt;

&lt;p&gt;Anyway.&lt;/p&gt;

&lt;p&gt;All this purpose talk is neither here nor there; essentially masturbatory, ‚Äòcause it only relates to us and our plans.&lt;/p&gt;

&lt;p&gt;We were able to clarify ‚Äúthis stuff‚Äù, though, which was a nice takeaway.&lt;/p&gt;

&lt;p&gt;Earlier when I was thinking about ‚Äúthis stuff‚Äù, the flavour and intent ‚Äî in my mind, I mean ‚Äî was clearly occult/mystic.  (I‚Äôve been writing in bits and pieces for hours, now.)  Y‚Äôknow, all the ‚Äúthey had no idea what was coming‚Äù business.  What &lt;em&gt;was&lt;/em&gt; coming?  Nothing other than the occult, of course.  It‚Äôs one of those things that‚Äôs impossible to know anything solid about unless you &lt;em&gt;know&lt;/em&gt; about it.  Here‚Äôs that refrain: knowing is too late.&lt;/p&gt;

&lt;p&gt;We almost happened upon this much earlier in the year, helped along by a too-high antidepressant dose that was causing a subtle but thorough sense of dissociation.  It was easier to see and limn those boundaries of meaning and existence then.  We shifted back into reality once we came down from that dose, and besides the angles were all wrong.  Little did we know: that was just practice.&lt;/p&gt;

&lt;p&gt;Now, ‚Äúoccult‚Äù is a word with all kinds of baggage and shit.  There you are with that fucking dictionary again.  Okay ‚Äî I‚Äôll allow it.  Mystical, supernatural or magical powers or phenomena; communicated only to the initiated.  Esoteric.  ‚Äúto cut off from view by interposing‚Äù.  This time all it took was one &lt;a href=&quot;https://en.wikipedia.org/wiki/Attractor&quot;&gt;attractor&lt;/a&gt; and for godssakes please do not start with some law of attraction gronk right now I do &lt;em&gt;not&lt;/em&gt; have time for this shit.&lt;/p&gt;

&lt;p&gt;But like, plurality was always going to be that which drew us in, it was just a matter of when and how.  Seriously.  It was always going to happen.  You need to &lt;em&gt;believe&lt;/em&gt; that.&lt;/p&gt;

&lt;p&gt;And so we recall the same question: what &lt;em&gt;was&lt;/em&gt; coming?  (‚Äúbelief in‚Äù) the ‚Äúoccult‚Äù, or rather, the belief that we &lt;del&gt;can&lt;/del&gt; create our own reality/meaning/subjectivity.&lt;/p&gt;

&lt;p&gt;Again with less punctuation: the belief that we create our own reality was coming.&lt;/p&gt;

&lt;p&gt;Self-belief was coming.  They had no idea what was coming.  They truly didn‚Äôt.  How could anyone know what they were opening up to?  Would anyone choose to, knowing?  The question is nonsensical.  Knowing is too late.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>morgan</title>
   <updated>2018-05-19T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/19/morgan</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/19/morgan/"/>
     <content type="html">&lt;p&gt;nine years ago, i was living in a sharehouse with a close friend from high school, alex.
he was a couple years older than me ‚Äî i think i was in year 9 and him in 11 or 12 when we
met. he ended up getting me a job at a call-centre where he worked after i finished high
school, and then when i moved out of home, a place in his sharehouse. the call-centre work
wasn‚Äôt very glamorous, and i got a job doing software. about a year later, he expressed
interest and i got him a job there.&lt;/p&gt;

&lt;p&gt;not very long after, alex moved up in position, and a friend of a friend of his applied to
replace him.&lt;/p&gt;

&lt;p&gt;i remember seeing them on the couch in the common area as there was a bit of a dual-
lunch/interview thing going, and feeling deeply suspicious. there was something about them
i couldn‚Äôt pick, but i knew i didn‚Äôt like it.&lt;/p&gt;

&lt;p&gt;they ended up getting the job, so soon enough i was seeing them every day. this was
well before the days of slack or hipchat, so we all used instant messenger and used it to chat
1:1 when we weren‚Äôt getting up from our seats to interrupt them. little by little, starting with
work topics, we began to chat, but eventually diverging into shared interests.&lt;/p&gt;

&lt;p&gt;one of the things that made me feel suss about them, in retrospect, was my inability to
gender them. i mean, their name gave them away, but visually i was baffled. i think years of
queer-coding villains in media probably partly gave rise to that.&lt;/p&gt;

&lt;p&gt;as we continued to chat, i started to feel we were building a kind of camaraderie. we
cared about similar social justice issues. my own gender issues were coming to the fore, and
while i still didn‚Äôt get theirs ‚Äî at all ‚Äî it became apparent they‚Äôd thought about gender a lot.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;morgan and i have been close friends ever since, and ours is the longest close
friendship i‚Äôve had in all my life. (alex and i are still ‚Äòfriends‚Äô, but we might talk or see each
other once or twice a year, whereas with morgan it‚Äôs once or twice a week, and we talk
throughout the day, every day.) in many ways they‚Äôre the bar i rate my other friendships or
relationships by; not in a mean or ranking-type way, but just, i know this is actually how
good things can be. we‚Äôre similar in lots of ways and different in lots of ways, and we blend
these aspects into a mutually fulfilling relationship.&lt;/p&gt;

&lt;p&gt;using the word ‚Äòrelationship‚Äô, it‚Äôs become clear that neither of us actually knows how
to characterise our relationship, whatever it is, and that we‚Äôre also both curious in talking
about that. that interests me a lot. i‚Äôm fairly confident neither of us has even a little bit of
romantic interest in the other ‚Äî they might be more generally aromantic, even. but what we
have is certainly completely different to any other ‚Äúfriendship‚Äù i have, and perhaps the same
goes for them too. i care for them and am interested in them in a way i don‚Äôt know how to
adequately describe. the term ‚Äúqueerplatonic relationship‚Äù often comes to mind.&lt;/p&gt;

&lt;p&gt;even if there‚Äôs no romance, though, i‚Äôd still really like to hold their hand.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>identity</title>
   <updated>2018-05-18T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/18/identity</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/18/identity/"/>
     <content type="html">&lt;p&gt;i want to try to describe how i relate to my own identity. i don‚Äôt know how other
people feel about their identities. it‚Äôs not a feeling you can transmit. you can‚Äôt put your hand
on someone else‚Äôs and understand how they perceive it. i have no idea if this experiment is
even vaguely feasible, but i want to try.&lt;/p&gt;

&lt;p&gt;when i turn my attention inward and look for it, there‚Äôs nothing. what i grasp for first
is a label, something with a shape which it might fit into. there‚Äôs a couple of these that come
to mind almost immediately: programmer, trans girl, anarchist ‚Ä¶ but well, that‚Äôs the thing.
i‚Äôve been all of these and none of these at the same time. some days i don‚Äôt ‚Äúfeel‚Äù a label but
the criteria fit anyway, because of how labels and identity work ‚Äî by social construction. you
can only be a programmer in a world that knows what programming is, that distinguishes it
from something else, and that distinguishing defines its criteria. other days i feel it but the
criteria don‚Äôt exactly fit. being a trans girl is one of those thing. the problem with these
criteria is that they are indeed socially constructed, meaning they‚Äôre malleable. and as a
member of society, it‚Äôs not like the construction has nothing to do with me.&lt;/p&gt;

&lt;p&gt;i guess the thing is that, maybe more than most, my identity is slippery. some parts
remain fixed for longer periods of time than others, but as far as i can tell there‚Äôs nothing
that remains indefinitely. this seems to set me apart from other people. or at least, people
without bpd.&lt;/p&gt;

&lt;p&gt;one of the worst parts of a slippery identity is that it‚Äôs also difficult for me to grasp
much of the time. even i won‚Äôt know where part of me has gone, where part of me came
from, when to expect that something might appear or disappear. sometimes i wake up and
there‚Äôs something that was core to me that‚Äôs just ‚Ä¶ vanished. i can‚Äôt explain it any better
than that. maybe it‚Äôll be back. maybe it won‚Äôt. maybe something similar will take its place.&lt;/p&gt;

&lt;p&gt;in times like these, consistent action arises out of consistent values. i don‚Äôt see values
as a part of identity. i think people sometimes choose to make their values their identity, but
i don‚Äôt believe identifying a certain way is a requirement for holding a certain value. i‚Äôll
never believe less in universal human rights, queer rights, the fundamental unjustness of
capital, etc. but some days i might think the term ‚Äúactivist‚Äù fits more than others. indeed,
some days i will highly associate with it, and others not at all.&lt;/p&gt;

&lt;p&gt;so when i cast my vision inward.. i see no identity at all, until i pause and let my eyes
adjust, and then i see a million. i don‚Äôt know how to convey this. how much it feels like i‚Äôm
at odds with a world that expects me to remain static, to possess a single identity and not a
dynamic process of identity. how much that can make me feel bad for not conforming with
their expectations; how that can manifest as disappointment and disgust and self-hate, none
of which helps, but instead pushes me toward repression.&lt;/p&gt;

&lt;p&gt;i find it hard to say i‚Äôm one person. it‚Äôs hard to say i possess ‚Äúan identity‚Äù, to relate to
‚Äúmy identity‚Äù when the singular is utterly dissonant here.&lt;/p&gt;

&lt;p&gt;it‚Äôs hard to say i relate to identity.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>panic disorder</title>
   <updated>2018-05-17T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/17/panic-disorder</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/17/panic-disorder/"/>
     <content type="html">&lt;p&gt;there‚Äôs a little gnawing, biting feeling in the pit of my stomach. like there‚Äôs a glowing
hot stone, but just a small one. it‚Äôs already moved up a bit now, around where you‚Äôd expect
the diaphragm to be when you‚Äôre fully exhaled. it‚Äôs not ‚Äúreal‚Äù. it‚Äôs not like it‚Äôs a sickness. it‚Äôs
entirely in my head. but it manifests right here in my chest, and i feel nauseous and sick of
breath. i‚Äôm dizzy, too, and if my mind wanders, if i don‚Äôt keep it on a tight leash, a skill i‚Äôve
had to practice ever since this damn disorder graced my life with its presence, then it really
will spiral, fast, and even just thinking about that idea is enough to make the white hot
burning in my chest grow, its tendrils reaching out.&lt;/p&gt;

&lt;p&gt;i shoulda taken diazepam earlier when i felt this coming on but it receded a little and i
thought i‚Äôd be okay. but whatever. i‚Äôve dealt with this literally hundreds of times before. i‚Äôll
deal with it again. i know the lies my limbic system tells my brain, and though i‚Äôm not able to
stop those signals streaming in, to convince my brain not to deliver the panic to my
consciousness, so it‚Äôs up to pure discipline to hold it at bay and not fall into the path of least
resistance.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>train</title>
   <updated>2018-05-16T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/16/train</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/16/train/"/>
     <content type="html">&lt;p&gt;on the second carriage from the front. the sky is overcast with some unevenness as the
light filters through it.&lt;/p&gt;

&lt;p&gt;i love the sounds of public transit but i love applying my own music to the journey
even more, recasting the experience to suit my mood.&lt;/p&gt;

&lt;p&gt;this dusk light is something else. i wish there was a carriage with the interior lights off
or dimmed. i can‚Äôt imagine how amazing it would feel; dream-like and otherworldly,
transformative. it‚Äôs simple stuff like that which really makes life feel exciting. expanding
experience.&lt;/p&gt;

&lt;p&gt;one thing i love about taking public transport in melbourne is getting a look at the sea
of faces that make up our city. at this time there‚Äôs roughly 50:50 caucasian and not. and
y‚Äôknow, for a colonially settled city, that‚Äôs pretty great. maybe that‚Äôs one of the reasons i like
box hill so much. i wonder if that‚Äôs just me trying to assuage my own white guilt tho.&lt;/p&gt;

&lt;p&gt;we pass over auburn rd and there‚Äôs a glimpse of a mass of red and white lights from
the cars below, gone as quickly as it appeared. lately multiple people have described the
world as noir, and i‚Äôm feeling that now. there‚Äôs definitely a vague sense of unease that
permeates the scene, hinting at dystopia, even though i can‚Äôt help but find beauty in
everything i see. i see beauty but it doesn‚Äôt mean i don‚Äôt see what‚Äôs actually there too.&lt;/p&gt;

&lt;p&gt;another train passes in the opposite direction just as the bass drops in the music i‚Äôm
listening to. little drops of serendipity.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>tired</title>
   <updated>2018-05-15T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/15/tired</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/15/tired/"/>
     <content type="html">&lt;p&gt;tryna think about what to write about all day, and finally it‚Äôs hit me.&lt;/p&gt;

&lt;p&gt;i‚Äôm tired.&lt;/p&gt;

&lt;p&gt;i am physically worn-out. i am in need of sleep. i feel like my heart has gotten more
good exercise in the last few weeks than it‚Äôs had in the last year and expanded several sizes,
and it‚Äôs great but it‚Äôs work too.&lt;/p&gt;

&lt;p&gt;for once: what i‚Äôm not is tired of life.&lt;/p&gt;

&lt;p&gt;i am joyful. i am experimenting with joy, and the results are more wonderful than i
had imagined they could be.&lt;/p&gt;

&lt;p&gt;my legs are cramping if i so much as pull on my calves even a little bit. my arms feel
weak. my hands feel strained from carrying grocery bags. there‚Äôs a part of my body which is
just the slightest bit ache-y which hasn‚Äôt been like that in a long time. these aches are good.
they‚Äôre satisfying; like they attend a feeling of accomplishment.&lt;/p&gt;

&lt;p&gt;my head has that heaviness that suggests lying down will result in sleep seconds later
‚Äî a really delightful heaviness, to be sure, for someone who barely managed catnaps.&lt;/p&gt;

&lt;p&gt;with coming down from hypomania i feel like my emotional range has actually
expanded. euphoria at the world and existing is wonderful and enjoyable. it feels great. but
having those feelings ‚Äî and even stronger! ‚Äî without an altered mood state? just because
the events that are happening are really that intense? that they resonate with who i am and
what i want that deeply, and aren‚Äôt simply riffing off of an episode?&lt;/p&gt;

&lt;p&gt;‚Äî and this is not to discount my feelings while hypomanic. but seeing the world as it
is when i‚Äôm more me and less an altered me is where i want to be. ‚Äî&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;i‚Äôm tired, and i‚Äôm so ready for tomorrow.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>prelude</title>
   <updated>2018-05-14T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/14/prelude</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/14/prelude/"/>
     <content type="html">&lt;p&gt;today i‚Äôm listening to ‚Äúprelude‚Äù by ‚Äúthe noisy freaks‚Äù, the first track in the album
‚Äústraight life‚Äù. (ha.)&lt;/p&gt;

&lt;p&gt;there‚Äôs a quiet piano opening, and like, that‚Äôs always going to elicit a response from
me. for most of my life, piano has been a really big thing. there‚Äôs almost always been one in
my house, wherever i‚Äôve lived. there was a short time between moving out of my family‚Äôs
house when i was 18, and then spending my first pay cheque on a digital piano. maybe 3
months. i‚Äôve taken that piano with me ever since, so literally 3 months in 27 years have i
been without a piano at my disposal.&lt;/p&gt;

&lt;p&gt;it‚Äôs .. wistful music? it makes me feel reflective. there‚Äôs some synth stuff going on, the
key isn‚Äôt happy or sad so much as contemplative. the energy picks up, for sure, but it mostly
propels my thoughts along the same lines rather than changing tracks. again, i‚Äôm drawn to
expressing how i‚Äôm neither happy nor sad nor neutral, but in a different place; maybe a
different time, as my thinking reaches into the past.&lt;/p&gt;

&lt;p&gt;even the name ‚Äúprelude‚Äù evokes something. on the one hand, it‚Äôs the first track of the
album. the last track is called ‚Äúoutro (bonne nuit)‚Äù. it‚Äôs not exactly difficult to work out
what‚Äôs happening. but in terms of my relation to the music .. well, it‚Äôs talking about a
beginning, right? and so while it encourages me to think into the past, the best thing you can
do with that is to take what you‚Äôve learned and apply it to the future. in this sense i feel like
this kind of music is preparatory, consolidatory (is that a word? it is now.), asking you to
grow up, to accept your mistakes, and to not repeat them.&lt;/p&gt;

&lt;p&gt;it may be that these feelings the music evokes are unique to me; like the piano
opening, instruments and samples used throughout bring me back to earlier times in my life,
automatically drawing my thoughts across the span of time from then until now. it‚Äôs a
vaguely retro/90‚Äôs-themed album, though, so maybe that‚Äôd hold for a bunch of people my
age who had similar interests to me.&lt;/p&gt;

&lt;p&gt;there‚Äôs something haunting about it. maybe reflection is always haunting, revealing
the indefatigability of time itself, how we can never wind it back, how there‚Äôs no turning
away from the future. damn it, i really cannot help but be morbid, even with a perfectly
lovely piece of music.&lt;/p&gt;

&lt;p&gt;but perhaps it‚Äôs not morbidity so much as radical acceptance of what life is, and with
that comes the ability to hold a greater appreciation for every little moment.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>105/710</title>
   <updated>2018-05-13T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/13/105-710</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/13/105-710/"/>
     <content type="html">&lt;p&gt;i got a lotta feelings about my apartment, folx.&lt;/p&gt;

&lt;p&gt;when i think about it, i first and foremost think of all the other people who have
passed through it. as you know, i‚Äôm a people-centric kinda girl.&lt;/p&gt;

&lt;p&gt;there was kairi, whom i moved in with first. then hazel. then imogen.&lt;/p&gt;

&lt;p&gt;y‚Äôknow, that‚Äôs not actually that many.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;of course, a lot of bad shit has gone down here. more than one suicide attempt, but
one in particular that will stay with me forever. the incredible tension that has existed within
these walls when things weren‚Äôt working out with me and a partner. (fucking pro-tip to ashe:
do not live with a partner. not for a long time. it does not work.)&lt;/p&gt;

&lt;p&gt;but there‚Äôs been a lot of good too. excluding those already-mentioned, i‚Äôve had five
other partner(?)s stay the night, and it usually has been mostly just relaxing together,
listening to music and enjoying each other‚Äôs company. it‚Äôs almost always been pleasant. i‚Äôve
worked at github since before moving here, so it‚Äôs always been my place of work, which has
for the most part been a steady and stabilising part of my life. i‚Äôve had friends over to play
games and have food. friends with their animals, sometimes. i cat-sat milton here. it wasn‚Äôt
that long after moving here that i started therapy with my current therapist and finally got
past the worst of my panic disorder.&lt;/p&gt;

&lt;p&gt;there‚Äôs been a lot of self-discovery. a lot of self-implosion, too, and that‚Äôs always hard
to face. there‚Äôve been sleepless nights and more restful ones. some nights where i‚Äôve felt
hollow to the core, and some days where i‚Äôve felt like life was full of meaning and wonder.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;i don‚Äôt know what‚Äôs to come. i struggled to reclaim this space as my own after
everything with imogen earlier this year, but the last week has seen me go from hermitude in
the study to spending time all over the apartment again, and enjoying it. i‚Äôve let go of
something. i still don‚Äôt know if i‚Äôll want to remain here by year‚Äôs end when the lease expires.
joni‚Äôs suggestion was that moving might itself be unsettling, and i can sympathise with that
view point. on the other hand, a fresh start might be valuable.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;we‚Äôll see how i‚Äôm feeling then.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>green tea</title>
   <updated>2018-05-12T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/12/green-tea</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/12/green-tea/"/>
     <content type="html">&lt;p&gt;it‚Äôs time for some ‚Äútwinings pure green tea‚Äù. i made it with 98¬∞ water.&lt;/p&gt;

&lt;p&gt;the mug is really pleasantly warm. it‚Äôs a little cool inside and i‚Äôm wearing my
fingerless gloves, so i can cup it in both hands and feel the heat radiate. steam‚Äôs rising from
the cup, and that‚Äôs an impossibly relaxing thing to see and feel as it brushes your face.&lt;/p&gt;

&lt;p&gt;as it steeps the lightly stringent aroma begins to develop. my neck or throat is a little
sore so taking that first sip is a little more difficult than i‚Äôd have expected. it‚Äôs still steaming
hot, maybe 90-ish degrees, and the flavour barely comes through. at times like this, all you
can do is keep smelling the roses. or the camellia sinensis, as the case may be.&lt;/p&gt;

&lt;p&gt;blow a bit on the tea and the steam rushes to fog up your glasses.&lt;/p&gt;

&lt;p&gt;i‚Äôm still struggling to taste it, and i don‚Äôt think it‚Äôs because it‚Äôs too hot. my taste buds
might be a little out of it today. but one thing never fails: you let the tea flow into the back of
your mouth ‚Äî not yet swallowing, but letting it sit there and stimulate the taste buds at the
back of your tongue. the bitter notes come out. works every time. the more bitter the tea,
the more i love to do this ‚Äî it‚Äôs like finally getting the full experience. (in reality, what‚Äôs
probably happening is that it‚Äôs just stimulating more of your taste buds. the taste bud ‚Äúmap‚Äù
suggests the bitter ones are at the back of your tongue, but that‚Äôs been thoroughly
debunked.)&lt;/p&gt;

&lt;p&gt;my throat is really getting quite sore by this point, and the tea isn‚Äôt something i‚Äôm very
much able to focus on, or be mindful of. but it‚Äôs worth trying; when the going gets tough, etc.
etc. it‚Äôs cool enough now (probably 70¬∞) that i can take a relatively big sip and just hold it,
swish it around my mouth. the temperature difference is really wonderful. it reminds me of
a hot shower.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>bed</title>
   <updated>2018-05-10T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/10/bed</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/10/bed/"/>
     <content type="html">&lt;p&gt;the blanket on top is red, soft, velvety. i don‚Äôt know what it‚Äôs made of. it‚Äôs the kind of
material that isn‚Äôt especially thick, but feels warm. too warm under it and you sweat easily
for some reason.&lt;/p&gt;

&lt;p&gt;i think it came from kairi, it rather, that she brought it with her with belfast and then
didn‚Äôt want to take it with her when she moved out. almost everything like that i‚Äôve gotten rid
of, donated, given to a friend. but not this. not because it reminds me of her. it‚Äôs just a really
nice blanket.&lt;/p&gt;

&lt;p&gt;there‚Äôs a purple blanket underneath it. same size, purple not red, and just a slightly
different material. i‚Äôve been snuggled up in it in many different places; couches, chairs, beds.
it doesn‚Äôt mean anything specific. it‚Äôs just a nice blanket.&lt;/p&gt;

&lt;p&gt;under that, a sheet. i had no idea you were ‚Äúsupposed‚Äù to sleep under a sheet for most
of my life. i didn‚Äôt understand the concept of flat sheets whatsoever; fitted ones worked
better, so why did they exist? it‚Äôs microfibre or some fancy word like that, which is another
way of saying $20 at woolworths.&lt;/p&gt;

&lt;p&gt;this place feels like something i‚Äôve slowly reclaimed.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>hypomania</title>
   <updated>2018-05-09T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/09/hypomania</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/09/hypomania/"/>
     <content type="html">&lt;p&gt;hypomania: ‚Äúa mood state characterized by persistent disinhibition and elevation
(euphoria). [‚Ä¶] According to DSM-5 criteria, hypomania is distinct from mania in that there
is no significant functional impairment; mania, by DSM-5 definition, does include significant
functional impairment and may have psychotic features.‚Äù&lt;/p&gt;

&lt;p&gt;this is kinda a thing that keeps occurring to me on and off, as you‚Äôre aware. i wanted
to try to describe the subjective experience. because it‚Äôs a mood state defined by a set of
symptoms, i‚Äôll do so according to the list of criteria.&lt;/p&gt;

&lt;p&gt;pressured speech: i‚Äôm fucking talkative lately. i can‚Äôt stop expressing myself. i tweet a
lot and i talk a lot, but inside my head when i‚Äôm alone it‚Äôs like a freight train. the thing is, it
feels good. it feels like i‚Äôm putting together some unified theory of the world and psyche and
essentially every damn thing i‚Äôm talking about, like it All Makes Sense‚Ñ¢. the desire to keep
talking and theorising is fuelled by this sense that i‚Äôm making sense of things, and that if i
keep doing so, i‚Äôll have made sense of everything.&lt;/p&gt;

&lt;p&gt;inflated self-esteem or grandiosity: my self-image is really good lately. this isn‚Äôt a bad
thing in itself, but it contrasts to my baseline of ‚Äúthis is fine‚Äù. i feel much more associated
with my body, much more accepting of it, and i‚Äôm much more willing to express the idea that
i‚Äôm good or even excellent at certain tasks. similarly, i have less qualms with putting myself
out there.&lt;/p&gt;

&lt;p&gt;decreased need for sleep: this is pretty simple. lately i‚Äôve not been tired, have had
trouble falling asleep if i‚Äôve gone to bed early (e.g. with you), and still not been tired in the
morning when i wake up.&lt;/p&gt;

&lt;p&gt;flight of ideas or the subjective experience that thoughts are racing: see ‚Äòpressured
speech‚Äô. it feels like everything is related.&lt;/p&gt;

&lt;p&gt;easily distracted and attention-deficit: this one hasn‚Äôt hit me as much, subjectively,
though i have struggled to accomplish much work-wise lately.&lt;/p&gt;

&lt;p&gt;increase in psychomotor agitation, or occasionally in some, increased irritability:
maybe.&lt;/p&gt;

&lt;p&gt;hypersexuality: from ace to 8 hours of fucking in 48 hours. yeah.&lt;/p&gt;

&lt;p&gt;involvement in pleasurable activities that may have a high potential for negative
psycho-social or physical consequences: yes. there‚Äôs the whole 8 hours of sex with someone
you just met thing, but i‚Äôm willing to excuse that as simply queer life sometimes. but we
didn‚Äôt use any protection! hello disinhibition. :/&lt;/p&gt;

&lt;p&gt;i need ‚Äúelevated mood‚Äù plus three of those for the DSM-IV-TR definition. i have
elevated mood plus six, so ‚Ä¶&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>laptop</title>
   <updated>2018-05-08T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/08/laptop</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/08/laptop/"/>
     <content type="html">&lt;p&gt;today i‚Äôm looking at my laptop. it‚Äôs covered in a variety of stickers and there‚Äôs a lot of
history recorded in them.&lt;/p&gt;

&lt;p&gt;honestly, i‚Äôm not a fan of keeping history around; i don‚Äôt mean ‚Äúdelete or trash
everything a day after it‚Äôs gone‚Äù ‚Äî i like to hold onto things for as long as they‚Äôve held their
relevance. but in a habit i picked up from marie kondo, once something has served me in
life, i appreciate it one last time and then move on.&lt;/p&gt;

&lt;p&gt;i used to hang onto &lt;strong&gt;everything&lt;/strong&gt;. starting from when i was 12, i‚Äôd hang onto every text
document i wrote or acquired, every picture i downloaded, every project i worked on, every
piece of music, everything. when i‚Äôd get a new computer or reinstall an OS, i‚Äôd collect them
all into a folder (usually called ‚Äúold‚Äù or ‚Äúarchive‚Äù), and stick in my new, empty documents
folder. next time, i‚Äôd do the same. up until last year you could go through the onion layers of
‚Äúold‚Äù folders, reaching further and further into my history, right back to when i was 12.&lt;/p&gt;

&lt;p&gt;preserving this was an effort, because i‚Äôve had how many new computers, how many
reinstalls in the last 15 years? but it felt like something had to do to, like throwing that away
would violate a sacred principle i lived my life by. turns out that principle was OCD.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;so, this laptop. the cats in the top-left corner were sent to me by my coworker aaron.
he‚Äôs kind of a Big Deal in the ruby and rails communities, so when he tweeted about sending
these to anyone, i DM‚Äôd him on slack and was like ‚Äúomg would you??‚Äù and he just mailed me
out an envelope full of them. i was ecstatic, so they went straight on my laptop. (there‚Äôs one
in the front cover of my diary too.) now it‚Äôs kind of surreal that we‚Äôre ‚Äúfriends‚Äù who video
call every week.&lt;/p&gt;

&lt;p&gt;there‚Äôs a variety of work related stickers without much backstory: the four big octocats
along the middle line, the vinyl octocat covering the apple logo, the pride octocat. they are
what they are. this is a work laptop and it seemed appropriate. same with the git and the
datadog (purple woofer up top) stickers.&lt;/p&gt;

&lt;p&gt;there‚Äôs a bunny sticker on opposite corners. they were from a sticker set i got to give
to kairi. there were others but i removed them because of all the negativity they were
associated with. but i couldn‚Äôt bare to drop the bunnies.&lt;/p&gt;

&lt;p&gt;the bottom-right corner is the logo of my favourite band, school food punishment,
now disbanded. it came with a limited-edition cd release.&lt;/p&gt;

&lt;p&gt;‚Äúgender is not binary‚Äù is actually from a member of parliament in nsw (!). she sent
them and a bunch of other stickers out. that was pretty cool.&lt;/p&gt;

&lt;p&gt;idk why i have the slack pride one. whatever. more rainbows on a laptop is always
good.&lt;/p&gt;

&lt;p&gt;there‚Äôs two stickers from github constellation, an event held last november in
melbourne where i attended as staff. they were handing those stickers out. one is the
octocat ‚Äúconstellation‚Äù on the bottom of the laptop. the other was a grim reaper (!?), which
i‚Äôve covered with the ‚Äúinvasion day‚Äù sticker. i covered it because it was actually really grim:
that night was the one i was raped. a bit too much to leave a literal grim reaper sticker from
that night on there, y‚Äôknow? whereas i support indigeneousx on patreon.&lt;/p&gt;

&lt;p&gt;‚Äúbe pawsitive‚Äù. cute furry artist put these together. my keys have a little charm of the
same design on them.&lt;/p&gt;

&lt;p&gt;finally, the bunny girl drinking a milkshake. it‚Äôs from a LINE sticker set i used with
emma a lot.&lt;/p&gt;

&lt;p&gt;there‚Äôs a lot i‚Äôm ready to move on from with this laptop. it kinda documents the last 2
years of my life, the 2 years i‚Äôve had it. i‚Äôm giving it to a friend when my replacement laptop
arrives, which is pretty soon.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>bullet journal</title>
   <updated>2018-05-07T00:00:00+10:00</updated>
   <id>https://kivikakk.ee/alex/2018/05/07/bullet-journal</id>
    
     <link href="https://kivikakk.ee/alex/2018/05/07/bullet-journal/"/>
     <content type="html">&lt;p&gt;There‚Äôs my diary on the desk. It didn‚Äôt start out that way; it was a bullet journal
originally. It‚Äôs a Moleskine, since those are the fancy diaries with the dotted grids suitable
for bullet journals. I think the covers are leather. Oh well. I bought this years ago. At a
guess it has .. 180, 200 pages? I‚Äôm up to page 158 right now. I number them myself. I‚Äôve
only ever used two different types of pens in it, both made by the same Japanese pen
company, Zebra. I can‚Äôt say I know for sure why I‚Äôve chosen that pen company as ‚Äúmy‚Äù pen
company, but I have.&lt;/p&gt;

&lt;p&gt;It has a little tassel attached to it to use as a bookmark. I keep the current day
marked.&lt;/p&gt;

&lt;p&gt;The paper is slightly yellowed, with a grid of light dots, maybe 8mm apart in both
directions. It‚Äôd probably be good for playing grid-based paper games, but that‚Äôs not what I
use it for. At a guess I‚Äôd say it was 70~80gsm. Good, strong paper, without being bulky.&lt;/p&gt;

&lt;p&gt;For a while I maintained an index on the first page, in true bullet journal fashion, with
page references for months, and a yearly overview for each year as it happened, three
months to a page. Turns out that wasn‚Äôt actually useful to me. Likewise, it was purely a daily
todo list and short bullet points on things that happened in a given day, if I felt it was
exceptional enough to mark it.&lt;/p&gt;

&lt;p&gt;The beginning was November 2016. I wasn‚Äôt doing too well then. ‚ÄúDiazepam helped
alot.‚Äù ‚ÄúFucking chill.‚Äù ‚Äúchill‚Äù ‚Äúrelax about life a little‚Äù ‚ÄúFeeling a bit underappreciated‚Äù (NB.
this was almost certainly the understatement of the year.) The tone is rarely positive, and
when it is, it feels fabricated. There‚Äôs a lot of self-reassurance that things will be okay, and
reminders to try to provide reassurance to my partner that things will be okay. ‚ÄúPanic attack
all morning.‚Äù ‚ÄúDidn‚Äôt get any work done.‚Äù Sometimes there‚Äôs an upturn. ‚ÄúFeel better as the
day has gone on.‚Äù Then there‚Äôs a downturn. ‚ÄúLast night she was very suicidal.‚Äù&lt;/p&gt;

&lt;p&gt;If I jump 60 pages ahead, the tone has changed significantly. ‚ÄúSun feels so good!!
aaaaaaaaaaa‚Äù ‚ÄúGOD I LOVE BUNNIES‚Äù ‚Äúfeeling pretty fine w/ new hair‚Äù. The style of the
journal has changed, and it is much more a diary. Short dot points of a day‚Äôs events give way
to entire pages of solid prose, feelings I can now express.&lt;/p&gt;

&lt;p&gt;Further months pass and days wax and wane, grow thicker and thinner. Sometimes
it‚Äôs thin because I‚Äôm too busy to write, other times because I‚Äôm too depressed to. Sometimes
it‚Äôs thick because I have too many negative emotions, other times too many positive events to
detail.&lt;/p&gt;

&lt;p&gt;A lot happens in 158 pages.&lt;/p&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Breaking homegrown crypto</title>
   <updated>2016-02-20T11:56:00+11:00</updated>
   <id>https://kivikakk.ee/cryptography/2016/02/20/breaking-homegrown-crypto</id>
    
     <link href="https://kivikakk.ee/cryptography/2016/02/20/breaking-homegrown-crypto/"/>
     <content type="html">&lt;p&gt;Note: this is a pretty long article which does a deep dive into breaking some amateur crypto.  I go on for quite a bit.  Make a cup of tea before reading, and get ready to read some code!&lt;/p&gt;

&lt;h3 id=&quot;introduction&quot;&gt;introduction&lt;/h3&gt;

&lt;p&gt;Everyone knows it.  Rolling your own cryptography is a terrible idea.  Here‚Äôs &lt;a href=&quot;https://www.schneier.com/essays/archives/1999/03/cryptography_the_imp.html&quot;&gt;Bruce Schneier writing about it in &lt;strong&gt;1999&lt;/strong&gt;&lt;/a&gt;.  Here‚Äôs &lt;a href=&quot;http://security.stackexchange.com/a/18198/34825&quot;&gt;an excellent answer on the Infosec Stack Exchange&lt;/a&gt; about why you shouldn‚Äôt do it.  Here‚Äôs &lt;a href=&quot;https://www.schneier.com/blog/archives/2015/05/amateurs_produc.html&quot;&gt;another Scheiner post&lt;/a&gt; with an excellent opening sentence.&lt;/p&gt;

&lt;p&gt;This, then, is a post about a broken homegrown cryptosystem; namely, that used in &lt;a href=&quot;https://www.codeigniter.com&quot;&gt;CodeIgniter&lt;/a&gt;, pre-2.2.  This version was current until the release of CodeIgniter 2.2, on &lt;a href=&quot;https://ellislab.com/blog/entry/codeigniter-2.2.0-released&quot;&gt;the 5th of June, 2014&lt;/a&gt;, and you can still find sites on it today.&lt;/p&gt;

&lt;p&gt;The attack described in the post depends on a lot of things to go right (or wrong, if you will); it‚Äôs not just that they used a bad cipher, but also the fact that they rolled their own session storage, and implemented a fallback, and a dozen other things.  This is probably typical for most bugs of this class; a bunch of bad decisions which aren‚Äôt thought through find their logical conclusion in complete insecurity.&lt;/p&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;Let‚Äôs get into it!&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;what-are-sessions-and-why-do-you-want-them&quot;&gt;what are sessions and why do you want them?&lt;/h3&gt;

&lt;p&gt;When you visit a website, you might want to log in, and have the website remember that you‚Äôre logged in.&lt;/p&gt;

&lt;p&gt;When I was 13, I wrote a website with a ‚Äúlogin‚Äù feature; I didn‚Äôt know about cookies, so instead the logged in part of the website just passed around your credentials in URL parameters.  To obscure them from the user, the login page was actually a POST form which rendered a frameset (!); this way you‚Äôd never see your password in the address bar.&lt;/p&gt;

&lt;p&gt;It was a great idea!  But, all it took was someone right-clicking a link and selecting ‚Äúcopy‚Äù and along went their credentials too.  So, an imperfect idea.&lt;/p&gt;

&lt;p&gt;I learned about cookies.&lt;/p&gt;

&lt;p&gt;When I verified the user‚Äôs credentials against the backend (and to be honest, it was probably SQLi-filled), I put a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt; cookie on their machine.  When they come back, if they have the cookie, they‚Äôre in!&lt;/p&gt;

&lt;p&gt;Modifying cookies didn‚Äôt seem like the easiest or most obvious thing, but eventually I tried it, and found I could become whomever I wanted to be.&lt;/p&gt;

&lt;p&gt;I learned about sessions.&lt;/p&gt;

&lt;p&gt;PHP‚Äôs implementation ran this way: we‚Äôll throw a cookie on the user‚Äôs machine, maybe called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt;, which is just an opaque identifier.  Session variables accumulated throughout the script execution will then get written to storage keyed by that ID; often just files in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This has a few advantages:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The user can‚Äôt modify their own session data.  No more setting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;isAdmin&lt;/code&gt; for you!&lt;/li&gt;
  &lt;li&gt;The user can‚Äôt &lt;em&gt;see&lt;/em&gt; their own session data.  This one might be less obviously bad, but in general the less data you (needlessly) expose the better.&lt;/li&gt;
  &lt;li&gt;You can perform other tricks to verify the session owner.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For instance, you could ‚Äî completely hypothetically ‚Äî store the user‚Äôs IP address or user agent in the session.  Then, when they use the session, you confirm the session data against their IP/UA.  This prevents an attack where someone sniffs or steals the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt; of another user and attempts to use it themselves.&lt;/p&gt;

&lt;h3 id=&quot;what-happens-when-you-dont-have-a-good-place-to-store-session-data&quot;&gt;what happens when you don‚Äôt have a good place to store session data?&lt;/h3&gt;

&lt;p&gt;Say you‚Äôre on a weird shared host and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp&lt;/code&gt; is unwritable, or shared, or filled with piranhas.  Your database has a limit of one write per minute.  Where do you put your sessions?&lt;/p&gt;

&lt;p&gt;‚ÄúMaybe,‚Äù you think, ‚Äúmaybe I put the sessions in the cookie I give to the user!?‚Äù&lt;/p&gt;

&lt;p&gt;This is not a bad idea.  This is essentially ‚Äústore everything in the cookie‚Äù per above, although it presumes a level of structure given by the session storage mechanism.  The key realisation is that you still want those three things above:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The user can‚Äôt modify their own session data.&lt;/li&gt;
  &lt;li&gt;The user can‚Äôt see their own session data.&lt;/li&gt;
  &lt;li&gt;You can perform other tricks to verify the session owner.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;How do we stop them modifying their own session data?  You &lt;a href=&quot;https://en.wikipedia.org/wiki/Hash-based_message_authentication_code&quot;&gt;HMAC&lt;/a&gt; it.
Of course, most people don‚Äôt &lt;em&gt;actually&lt;/em&gt; use HMAC and instead just use
&lt;strong&gt;H&lt;/strong&gt;(&lt;em&gt;k&lt;/em&gt; || &lt;em&gt;m&lt;/em&gt;)
or
&lt;strong&gt;H&lt;/strong&gt;(&lt;em&gt;k&lt;/em&gt; || &lt;em&gt;m&lt;/em&gt; || &lt;em&gt;k&lt;/em&gt;)
or whatever their ‚Äúinstincts‚Äù told them to do; the latter getting the job done while admitting a few attacks that a Sufficiently Capable (or Cashed Up) Adversary can follow through on; the former practically negligent (see &lt;a href=&quot;https://en.wikipedia.org/wiki/Length_extension_attack&quot;&gt;length extension attack on Wikipedia&lt;/a&gt;; thanks to &lt;a href=&quot;https://www.reddit.com/r/PHP/comments/46pv94/breaking_codeigniters_homegrown_crypto/d06ze0h&quot;&gt;nikic for the correction&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;So, we transmit the MAC ‚Äî maybe you just append or prepend it to the session, or put it in a separate cookie, whatever ‚Äî and then when we get a session back we authenticate it.  If authentication fails, we don‚Äôt touch it, we throw it away; certainly we don‚Äôt try to e.g. unserialise it or anything.  We didn‚Äôt produce it, so it‚Äôs a live wire.&lt;/p&gt;

&lt;p&gt;That done, we now have ‚Äúthe user can‚Äôt modify their own session‚Äù, and this is a pretty good start.  We have a secure storage mechanism, albeit one where the user can see their own session data.&lt;/p&gt;

&lt;p&gt;We can tackle the ‚Äúverify the session owner‚Äù point by storing IP and UA in the session as before; they can‚Äôt modify these values themselves, so an attacker can‚Äôt either.  That said, they can see these values and realise they‚Äôre probably used in session authentication, which makes impersonating the user that much easier.&lt;/p&gt;

&lt;p&gt;To finally achieve a desirable level of security, we might want to stop them from seeing their session data too.  Thus we symmetrically encrypt the session data.&lt;/p&gt;

&lt;p&gt;Done!&lt;/p&gt;

&lt;h3 id=&quot;whats-one-good-way-to-screw-this-up&quot;&gt;what‚Äôs one good way to screw this up?&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://security.stackexchange.com/a/2210/34825&quot;&gt;Encryption without authentication&lt;/a&gt;.  In other words, the user can‚Äôt see their session, but &lt;em&gt;can&lt;/em&gt; modify it.&lt;/p&gt;

&lt;p&gt;At first blush, this doesn‚Äôt sound so bad: they can‚Äôt know what they‚Äôre changing the data to, so changes are essentially random and astronomically unlikely to produce a ‚Äúworking‚Äù result.&lt;/p&gt;

&lt;p&gt;In reality, it‚Äôs &lt;em&gt;quite&lt;/em&gt; bad: if there‚Äôs any pattern to the encrypted data (i.e. it‚Äôs not indistinguishable from random noise), then it can be exploited; for example, to repeat or remove certain sections of the data. With enough analysis, you could even start crafting arbitrary results.&lt;/p&gt;

&lt;p&gt;If the encryption algorithm used is reasonable, this shouldn‚Äôt be possible; any change should cause the decryption to fail or produce garbage results.  This could still be a vector for an effective DoS, though.&lt;/p&gt;

&lt;h3 id=&quot;what-if-the-encryption-algorithm-used-isnt-reasonable&quot;&gt;what if the encryption algorithm used isn‚Äôt reasonable?&lt;/h3&gt;

&lt;p&gt;Let‚Äôs finally turn our attention to CodeIgniter.  As a reminder, we‚Äôre looking at the pre-2.2 code, the latest release then being 2.1.4.&lt;/p&gt;

&lt;p&gt;First, let‚Äôs look at their &lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Session.php&quot;&gt;session storage mechanism, system/libraries/Session.php&lt;/a&gt;.  It‚Äôs highly configurable (probably a bad thing); note these options and their meanings:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$sess_encrypt_cookie&lt;/code&gt; ‚Äî do we encrypt the cookie?  Defaults to false, but I bet we want this turned on.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$sess_use_database&lt;/code&gt; ‚Äî do we stick the session data in the database?  Defaults to false.  Maybe it‚Äôs fine to leave this.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$encryption_key&lt;/code&gt; ‚Äî sounds very important.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we read the constructor, we see the encryption key is indeed required, regardless of whether the cookie itself is encrypted.  Why would that be?&lt;/p&gt;

&lt;p&gt;If we scroll down to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_set_cookie&lt;/code&gt;, we can see &lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Session.php#L655-L663&quot;&gt;something strange&lt;/a&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sess_encrypt_cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// if encryption is not used, we provide an md5 hash to prevent userside tampering&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;md5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encryption_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Pay close attention to the comment: they prevent userside tampering &lt;strong&gt;if&lt;/strong&gt; encryption is not used.  And if it is?  Let‚Äôs have a look at &lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Encrypt.php&quot;&gt;Encrypt.php&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A brief scan of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;encode&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;decode&lt;/code&gt; strongly suggests that no authentication is done; this means we can change the data on the client-side with ease; there‚Äôs no MAC protecting it.  The natural follow-up question is, can we make anything of this leeway?&lt;/p&gt;

&lt;h3 id=&quot;say-no-to-fallback&quot;&gt;say no to fallback&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Encrypt.php#L103-L109&quot;&gt;header of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;encode&lt;/code&gt;&lt;/a&gt; has this to say about itself:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Encodes the message string using bitwise XOR encoding. The key is combined
with a random hash, and then it too gets converted using XOR. The whole thing
is then run through mcrypt (if supported) using the randomized key. The end
result is a double-encrypted message string that is randomized with each call
to this function, even if the supplied message and key are the same.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Do you see what I see?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Encodes the message string using bitwise XOR encoding. The key is combined
with a random hash, and then it too gets converted using XOR. The whole thing
is then run through mcrypt &lt;strong&gt;(if supported)&lt;/strong&gt; using the randomized key. The end
result is a double-encrypted message string that is randomized with each call
to this function, even if the supplied message and key are the same.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;mcrypt is old, and &lt;a href=&quot;https://paragonie.com/blog/2015/05/if-you-re-typing-word-mcrypt-into-your-code-you-re-doing-it-wrong&quot;&gt;gets bad press for very valid
reasons&lt;/a&gt;,
but it provides some primitives that can work.&lt;/p&gt;

&lt;p&gt;So if it‚Äôs not supported, we‚Äôre left with the rest of the trash in that
paragraph.  ‚ÄúThe key is combined with a random hash, and then it too gets
converted using XOR‚Äù.  Converted?? what does that mean???&lt;/p&gt;

&lt;p&gt;It‚Äôs worth calling out &lt;a href=&quot;https://cdn.rawgit.com/bcit-ci/CodeIgniter/2.1.4/user_guide/libraries/encryption.html&quot;&gt;CodeIgniter‚Äôs own documentation&lt;/a&gt; here:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If Mcrypt is not available on your server the encoded message will still
provide a reasonable degree of security for encrypted sessions or other such
‚Äúlight‚Äù purposes.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;What the hell is a ‚Äúlight‚Äù purpose of encryption?  Those inverted commas in the
quoted portion are verbatim, I should add.  Even they aren‚Äôt convinced that a
‚Äúlight‚Äù purpose of encryption exists, yet they claim encrypted sessions are
such a case.  Just the foundation of your site or app‚Äôs security, nbd.&lt;/p&gt;

&lt;p&gt;Let‚Äôs find out just how bad an idea it is to have ‚Äúfallback crypto‚Äù that you
cooked up yourself.  And here‚Äôs the thing: &lt;strong&gt;it‚Äôs going to get called&lt;/strong&gt;.  You
don‚Äôt add fallback code without someone using it.  This stuff is criminally bad; you can‚Äôt say ‚Äúoh well, it‚Äôs a fallback, no-one should use it‚Äù.  If that‚Äôs the case, remove it; fail to work without the dependency.&lt;/p&gt;

&lt;p&gt;This is exactly what they did in 2.2, but there was a good &lt;em&gt;eight years&lt;/em&gt; while
this stuff was in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HEAD&lt;/code&gt;.  The fallback code got called.&lt;/p&gt;

&lt;h3 id=&quot;how-do-you-use-key-material-not-like-this-not-like-this&quot;&gt;how do you use key material? not like this‚Ä¶ not like this.&lt;/h3&gt;

&lt;p&gt;Let‚Äôs start with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;encode&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mcrypt_exists&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mcrypt_encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;_xor_encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;base64_encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt; wasn‚Äôt passed from the session library, so &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get_key&lt;/code&gt; is called with an empty string; that, in turn, does the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;returns &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$this-&amp;gt;encryption_key&lt;/code&gt; directly if it‚Äôs set.  You can grep (or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ag&lt;/code&gt;) the codebase quickly to find the only setter is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set_key&lt;/code&gt; in the class, which isn‚Äôt called by CI itself.&lt;/li&gt;
  &lt;li&gt;fetches &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;encryption_key&apos;&lt;/code&gt; from the CI config.  This is the same one that the Session class mandates is set, though Session doesn‚Äôt use it itself in encrypted-cookie mode.&lt;/li&gt;
  &lt;li&gt;surprisingly: returns the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;md5()&lt;/code&gt; of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It‚Äôs surprising because the comment says: ‚ÄúReturns it as MD5 in order to have an exact-length 128 bit key‚Äù.  But PHP‚Äôs &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;md5&lt;/code&gt;, by default, returns the digest as a hexstring, not as raw data, meaning each byte will have &lt;em&gt;four&lt;/em&gt; bits of entropy and not eight.  It also means the mcrypt codepath might well be ignoring half the key.&lt;/p&gt;

&lt;p&gt;There is a noteworthy remark on the &lt;a href=&quot;http://php.net/manual/en/function.mcrypt-encrypt.php#refsect1-function.mcrypt-encrypt-changelog&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mcrypt_encrypt&lt;/code&gt; changelog&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Changed in: 5.6.0&lt;/p&gt;

  &lt;p&gt;Invalid key and iv sizes are no longer accepted. &lt;strong&gt;mcrypt_encrypt()&lt;/strong&gt; will now throw a warning and return &lt;strong&gt;FALSE&lt;/strong&gt; if the inputs are invalid. Previously keys and IVs were padded with ‚Äò\0‚Äô bytes to the next valid size.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://soundcloud.com/kivikakk/gems&quot;&gt;Outrageous&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let‚Äôs move back to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;encode&lt;/code&gt;.  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt; now has the hexed MD5 of our actual encryption key (i.e. it‚Äôs a 32 byte string of hex digits).  We throw the plaintext string and that MD5 into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_xor_encode&lt;/code&gt;, base64 the result, and that‚Äôs our session cookie.&lt;/p&gt;

&lt;p&gt;Let‚Äôs look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_xor_encode&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;how-not-to-use-randomness&quot;&gt;how not to use randomness&lt;/h3&gt;

&lt;p&gt;Reminder: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$string&lt;/code&gt; is plaintext, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt; is a 32-byte hexstring.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_xor_encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mt_rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mt_getrandmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;_xor_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Let‚Äôs break it down:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We generate random numbers and &lt;em&gt;concatenate&lt;/em&gt; them until we have more than 32 digits.  That‚Äôs just bizarre.&lt;/li&gt;
  &lt;li&gt;We then call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$this-&amp;gt;hash&lt;/code&gt; on the random number string, which by default will just &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sha1()&lt;/code&gt; it, &lt;em&gt;again&lt;/em&gt; returning a hexstring, this time 40 characters long.&lt;/li&gt;
  &lt;li&gt;We now iterate over each character of the plaintext and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$rand&lt;/code&gt; string, cycled.
    &lt;ul&gt;
      &lt;li&gt;We append to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$enc&lt;/code&gt; the byte from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$rand&lt;/code&gt; string.&lt;/li&gt;
      &lt;li&gt;We then append to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$enc&lt;/code&gt; the same byte XOR‚Äôd with the corresponding plaintext byte.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;We then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_xor_merge&lt;/code&gt; the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$enc&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In other words, if:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$rand&lt;/code&gt; looks like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;RRRRRRR...&quot;&lt;/code&gt;, and&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$string&lt;/code&gt; looks like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;xxxx&quot;&lt;/code&gt;, then&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$enc&lt;/code&gt; will look like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;R*R*R*R*&quot;&lt;/code&gt;,&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;where &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;R&apos;&lt;/code&gt; ‚äï &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;x&apos;&lt;/code&gt; = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;*&apos;&lt;/code&gt;.  We can XOR the pairs together to recover the plaintext.&lt;/p&gt;

&lt;p&gt;Of course, we haven‚Äôt even used the key material yet.  That‚Äôs entirely the domain of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_xor_merge&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_xor_merge&lt;/code&gt; is defined as a ‚Äúkey + string‚Äù combiner by the header doc.  Let‚Äôs see what that means.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_xor_merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$str&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$key&lt;/code&gt; as passed into the function is the hexstring of the MD5 of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;encryption_key&lt;/code&gt;.  We then produce the hexed SHA1 of &lt;em&gt;that&lt;/em&gt;, and perform a 1-to-1 XOR of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$string[$i]&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$hash[$i]&lt;/code&gt; for all &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$i&lt;/code&gt;; the hash being a cycled 40 characters.  Remember that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$string&lt;/code&gt; here is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$enc&lt;/code&gt; above (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;R*R*R*R*&quot;&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;It‚Äôs important to note that these 40 hexadecimal characters are all that‚Äôs left of the key material, and they‚Äôre applied in &lt;a href=&quot;https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_Codebook_.28ECB.29&quot;&gt;ECB mode&lt;/a&gt; (like Snapchat, &lt;a href=&quot;https://kivikakk.ee/2013/05/10/snapchat.html&quot;&gt;which I‚Äôve written about&lt;/a&gt;).  The main implication of this is that later blocks aren‚Äôt affected by earlier blocks; if we correctly decrypt byte &lt;em&gt;k&lt;/em&gt; of the output, then we‚Äôll also get every byte (&lt;em&gt;k&lt;/em&gt; + &lt;strong&gt;W&lt;/strong&gt;&lt;em&gt;n&lt;/em&gt;), where &lt;strong&gt;W&lt;/strong&gt; is the width of the block.&lt;/p&gt;

&lt;p&gt;Usually ‚Äî using a strong block cipher mode ‚Äî getting any part of a block wrong would ensure every subsequent block would be corrupted, as the plaintext output of the earlier blocks are fed into later ones.  Not so with ECB, which they‚Äôve unwittingly used. (Though ‚Äúused‚Äù seems to be a bit of a stretch here.)&lt;/p&gt;

&lt;p&gt;Call the hexed SHA1 key material &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;kkkkkkk...&quot;&lt;/code&gt;.  We XOR this with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;R*R*R*R*&quot;&lt;/code&gt; string, producing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;9A9A9A9A&quot;&lt;/code&gt;.  This is the final output.&lt;/p&gt;

&lt;p&gt;Let‚Äôs review the entire process key material and plaintext takes to be encrypted, with some simplifications to make it readable in English:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A random SHA1 is produced (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;RRRRRRR...&quot;&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;We interleave characters of the plaintext (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;xxxx&quot;&lt;/code&gt;) with the random data, XORing each plaintext byte against the respective random byte (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;R*R*R*R*&quot;&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;We take the SHA1 of the MD5 of the key (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;kkkkkkk...&quot;&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;We bytewise XOR this SHA1 against each byte of the plaintext‚Äìrandom pairs (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;9A9A9A9A&quot;&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To recover the first byte of plaintext, then, looks like this:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Take the first two bytes of the ciphertext (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;9A&quot;&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;Take the SHA1 of the MD5 of the key (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;kkkkkkk...&quot;)&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;XOR the ciphertext bytewise with the SHA1 (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;R*&quot;&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;XOR the resulting pair of bytes (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;x&quot;&lt;/code&gt;).&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Note that the key material is only ever used in SHA1(MD5(&lt;em&gt;key&lt;/em&gt;)) form.  For our purposes, then, we only need to know the resulting SHA1; the source key doesn‚Äôt matter.  To put it more clearly, we only need to recover the SHA1 output itself to break the effective key.&lt;/p&gt;

&lt;p&gt;Looking at the above list of steps, we note that the SHA1 is only involved in the 3rd step; and moreover, this being a hexed SHA1, there‚Äôs only 8 bits of entropy across the two bytes, each byte taking 16 values.&lt;/p&gt;

&lt;p&gt;(If you do the math, there‚Äôs actually only 6 bits; in the ASCII values of ‚Äú0‚Äù through ‚Äú9‚Äù and ‚Äúa‚Äù through ‚Äúf‚Äù bits 6 (always on) and 8 (always off) don‚Äôt change.)&lt;/p&gt;

&lt;p&gt;XORs commute and associate, so we can be lazy and define the plaintext byte &lt;em&gt;i&lt;/em&gt; as:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;p&lt;/em&gt;[&lt;em&gt;i&lt;/em&gt;] = &lt;em&gt;c&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt;] ^ &lt;em&gt;c&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt;+1] ^ &lt;em&gt;k&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt; mod 40] ^ &lt;em&gt;k&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt;+1 mod 40]&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This is very straight forward.  Simplicity is often a nice thing in crypto, but this is the wrong kind of simple.&lt;/p&gt;

&lt;p&gt;Let‚Äôs say we &lt;em&gt;already know&lt;/em&gt; &lt;em&gt;p&lt;/em&gt;[&lt;em&gt;i&lt;/em&gt;] for some &lt;em&gt;i&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Knowing all of &lt;em&gt;c&lt;/em&gt;, this tells us something about &lt;em&gt;k&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt; mod 40] and &lt;em&gt;k&lt;/em&gt;[2&lt;em&gt;i&lt;/em&gt;+1 mod 40].  Because there are some serious value restrictions on elements of &lt;em&gt;k&lt;/em&gt; (being that there are only 16 possible values for a given element and not 256 like there should be), this lets us piece together &lt;em&gt;k&lt;/em&gt; quite neatly, and thus all the elements of &lt;em&gt;p&lt;/em&gt; we don‚Äôt know.&lt;/p&gt;

&lt;h3 id=&quot;do-we-know-the-plaintext&quot;&gt;do we know the plaintext?&lt;/h3&gt;

&lt;p&gt;Do we know any &lt;em&gt;p&lt;/em&gt;[&lt;em&gt;i&lt;/em&gt;]?  Well, what‚Äôs the plaintext?  &lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Session.php#L645-L676&quot;&gt;Session.php reveals all&lt;/a&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;_serialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;‚Ä¶&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;‚Ä¶&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;setcookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sess_cookie_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$expire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_domain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_secure&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_serialize&lt;/code&gt; massages the data in a way we can ignore for our purposes before passing it through to PHP‚Äôs own &lt;a href=&quot;http://php.net/serialize&quot;&gt;serialize&lt;/a&gt;.  So the session data is pure PHP serialised data.  What does this look like?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/bcit-ci/CodeIgniter/blob/2.1.4/system/libraries/Session.php#L264-L273&quot;&gt;Go up to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sess_write&lt;/code&gt;&lt;/a&gt;; you‚Äôll see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$cookie_userdata&lt;/code&gt; is an array, which has keys set in a particular order: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;session_id&apos;&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;ip_address&apos;&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;user_agent&apos;&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;last_activity&apos;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It‚Äôs important to know that PHP arrays are both associative &lt;em&gt;and&lt;/em&gt; ordered!  The same datatype is used for both key‚Äìvalue dictionaries as well as integer-indexed arrays.  This means order is present &lt;em&gt;and&lt;/em&gt; preserved in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$cookie_userdata&lt;/code&gt;, and this remains true for the serialised form.&lt;/p&gt;

&lt;p&gt;If we fake our own &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$cookie_userdata&lt;/code&gt; in PHP and then serialise it, what would it look like?  Here‚Äôs an example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;serialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Session.php:317 shows that session IDs are hexed MD5, so always 32 chars&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&apos;session_id&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;1234567890abcdef1234567890abcdef&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  
    &lt;span class=&quot;s1&quot;&gt;&apos;ip_address&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;0.0.0.0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&apos;user_agent&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;welp/1.0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&apos;last_activity&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1455953571&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here‚Äôs the output:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;session_id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1234567890abcdef1234567890abcdef&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ip_address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user_agent&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;welp/1.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;last_activity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1455953571&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The format is pretty simple to glean from this. Excuse my pseudo-not-even-BNF:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;object&lt;/em&gt; = &lt;em&gt;array&lt;/em&gt; | &lt;em&gt;string&lt;/em&gt; | &lt;em&gt;integer&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;array&lt;/em&gt; = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt; number &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{&lt;/code&gt; (&lt;em&gt;object&lt;/em&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;;&lt;/code&gt; &lt;em&gt;object&lt;/em&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;;&lt;/code&gt;)* &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;}&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;string&lt;/em&gt; = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt; number &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt; (any-char)* &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;integer&lt;/em&gt; = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt; number&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So what do we have after all this? The first two bytes of our known plaintext: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a:&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;lets-put-this-together&quot;&gt;let‚Äôs put this together&lt;/h3&gt;

&lt;p&gt;Here‚Äôs what we do: iterate over all 256 possible values of &lt;em&gt;k&lt;/em&gt;[0] and &lt;em&gt;k&lt;/em&gt;[1]; these correspond to &lt;em&gt;p&lt;/em&gt;[0].  The rest of &lt;em&gt;k&lt;/em&gt; doesn‚Äôt matter.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;For each &lt;em&gt;k&lt;/em&gt;, we calculate &lt;em&gt;p&lt;/em&gt;‚Ä≤ = decrypt(&lt;em&gt;k&lt;/em&gt;, &lt;em&gt;c&lt;/em&gt;).&lt;/li&gt;
  &lt;li&gt;Check &lt;em&gt;p&lt;/em&gt;‚Ä≤[0] == &lt;em&gt;p&lt;/em&gt;[0].&lt;/li&gt;
  &lt;li&gt;If valid, we found &lt;em&gt;k&lt;/em&gt;[0] and &lt;em&gt;k&lt;/em&gt;[1]!  In an average of 128 decrypt operations (which are just a bunch of XORs)!  Continue on to &lt;em&gt;p&lt;/em&gt;[1] and &lt;em&gt;k&lt;/em&gt;[2] and &lt;em&gt;k&lt;/em&gt;[3].&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This can be done very, very fast.&lt;/p&gt;

&lt;p&gt;This is actually slightly off; because of the weird keyspace and the fact that we‚Äôre XORing two parts of the key for one byte, (&lt;em&gt;k&lt;/em&gt;[&lt;em&gt;n&lt;/em&gt;], &lt;em&gt;k&lt;/em&gt;[&lt;em&gt;n&lt;/em&gt;+1]) = (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;2&apos;&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;1&apos;&lt;/code&gt;) works the same as it would if it were equal to (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;3&apos;&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;0&apos;&lt;/code&gt;).  You don‚Äôt necessarily get the exact SHA1 of the hex MD5 of the key, but you get one that works identically.&lt;/p&gt;

&lt;p&gt;(In other words, there are even fewer distinct keys than there appear! Wow.)&lt;/p&gt;

&lt;p&gt;We hit a slight hiccup because we don‚Äôt necessarily know the size of the session array, so the third byte of plaintext is unknown.  But it doesn‚Äôt take too long to realise that &lt;em&gt;k&lt;/em&gt;[0] and &lt;em&gt;k&lt;/em&gt;[1] correspond not only to &lt;em&gt;p&lt;/em&gt;[0], but also &lt;em&gt;p&lt;/em&gt;[20], &lt;em&gt;p&lt;/em&gt;[40], etc., because the key material is cycled (see above re: ECB).&lt;/p&gt;

&lt;p&gt;Let‚Äôs align the known plaintext data in rows of 20 bytes:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;tt&gt;&lt;strong&gt;a:&lt;/strong&gt;&lt;span style=&quot;color: #777&quot;&gt;4&lt;/span&gt;&lt;strong&gt;:{s:10:‚Äùsession_i&lt;/strong&gt;&lt;/tt&gt;&lt;br /&gt;
&lt;tt&gt;&lt;strong&gt;d‚Äù;s:32:‚Äù&lt;/strong&gt;&lt;span style=&quot;color: #777&quot;&gt;1234567890a&lt;/span&gt;&lt;/tt&gt;&lt;br /&gt;
&lt;tt&gt;&lt;span style=&quot;color: #777&quot;&gt;bcdef1234567890abcde&lt;/span&gt;&lt;/tt&gt;&lt;br /&gt;
&lt;tt&gt;&lt;span style=&quot;color: #777&quot;&gt;f&lt;/span&gt;&lt;strong&gt;‚Äú;s:10:‚Äùip_address‚Äù&lt;/strong&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In bold is everything we‚Äôre sure about.  You can see that, in the first two blocks (rows) alone, we have enough known-plaintext to gather all 40 bytes of key data; we‚Äôre missing the 3rd byte in the first block, but we have the 3rd byte in the second block.&lt;/p&gt;

&lt;p&gt;There is the concern that the session array may have more than 9 keys, making the unknown part of the first block one byte greater, in which case it looks like this:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;tt&gt;&lt;strong&gt;a:&lt;/strong&gt;&lt;span style=&quot;color: #777&quot;&gt;12&lt;/span&gt;&lt;strong&gt;:{s:10:‚Äùsession_&lt;/strong&gt;&lt;/tt&gt;&lt;br /&gt;
&lt;tt&gt;&lt;strong&gt;id‚Äù;s:32:‚Äù&lt;/strong&gt;&lt;span style=&quot;color: #777&quot;&gt;1234567890&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This is fine; we get both bytes 3 and 4 from the second block.  The same goes for many digits more, by which time we leave the realm of probability and cookie size limits.&lt;/p&gt;

&lt;p&gt;And that‚Äôs it.  We‚Äôve done it.  You can write an automated cracker based on this alone.&lt;/p&gt;

&lt;p&gt;Here‚Äôs a PoC in action, artifically slowed down so you can watch its progress:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/codeigniter.gif&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Too simple!  Now that you have the key (or rather, the SHA1 of the MD5 hexstring of the key ‚Äî good enough), you can feel free to change the data in the session, do what you like, and become whom you like.  Maybe even realise that PHP serialisation admits arbitrary objects, which you might be able to do something special with.&lt;/p&gt;

&lt;p&gt;If you liked the article, please share!  I also welcome your feedback/thoughts on &lt;a href=&quot;https://twitter.com/kivikakk&quot;&gt;Twitter&lt;/a&gt;.  Special thanks to &lt;a href=&quot;https://twitter.com/ibutsu&quot;&gt;Kairi&lt;/a&gt; for editing this article.&lt;/p&gt;

&lt;p&gt;The PoC code follows.  Enjoy!&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/kivikakk/c510b82a6ad828c3c5d3.js&quot;&gt;&lt;/script&gt;

</content>
    
 </entry>
 
 <entry>
   <title>Snapchat: not for state secrets</title>
   <updated>2013-05-10T20:44:00+10:00</updated>
   <id>https://kivikakk.ee/2013/05/10/snapchat</id>
    
     <link href="https://kivikakk.ee/2013/05/10/snapchat/"/>
     <content type="html">&lt;p&gt;I use &lt;a href=&quot;http://www.snapchat.com/&quot;&gt;Snapchat&lt;/a&gt;.  It‚Äôs an app where you can take a
photo or short (&amp;lt; 10 second) video and send it to your friends who use the
service; they‚Äôll then be able to see it, once, before it disappears forever.&lt;/p&gt;

&lt;p&gt;Ostensibly, the app is for sexting, because there‚Äôs no fear that your photo
will get spread around (no forwarding/etc.) or retained for longer than you‚Äôd
like, but it &lt;a href=&quot;http://survata.com/blog/is-snapchat-only-used-for-sexting-we-asked-5000-people-to-find-out/&quot;&gt;seems like it‚Äôs not as much a sexter‚Äôs hangout as the media might
want you to
think&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;My circle of friends use it basically as an extension of weird Twitter ‚Äì most
snaps I send and receive are strange angles of weird objects; the completely
mundane but somehow therapeutic (7 seconds of the camera pointed outside the
window of a tram, pointed at the ground moving below); or just closeups of
&lt;a href=&quot;https://www.google.com.au/search?q=curtis+stone&quot;&gt;Curtis Stone‚Äôs face&lt;/a&gt;,
wherever we see him.&lt;/p&gt;

&lt;p&gt;&lt;img style=&quot;border: 1px solid #000; margin: 0px auto; display: block;&quot; title=&quot;Curtis Stone. Ugh.&quot; src=&quot;/assets/post-img/stone.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;Of course, the promise that they won‚Äôt get retained is just that: a promise.
Since your phone receives this image and shows it to you at some point, it must
be downloaded by your phone.  If it can be downladed by the phone, it can be
downloaded by something else.  We decided to find out how.&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;My first thought was to use
&lt;a href=&quot;http://en.wikipedia.org/wiki/Cain_and_Abel_%28software%29&quot;&gt;Cain&lt;/a&gt; to re-route
the phone‚Äôs traffic to Snapchat via a computer with ARP poisoning, then
Wireshark to packet-sniff.  For whatever reason, we weren‚Äôt able to make this
work; while we did see some of the traffic (the non-HTTPS stuff), HTTPS
wouldn‚Äôt seem to pass through my friend‚Äôs computer.&lt;/p&gt;

&lt;p&gt;Another got to work using a different set of tools on a Linux machine to do ARP
stuff, and I took a more direct route.&lt;/p&gt;

&lt;p&gt;First, I set my phone‚Äôs proxy on WiFi to point to my machine.  Then I just
listened with netcat.  After receiving lots of apparently unrelated requests
(and the aforementioned HTTP requests&lt;sup id=&quot;fnref:flurry&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:flurry&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;), I found that Snapchat was
requesting an SSL forward:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nc -l -p 5588
CONNECT feelinsonice.appspot.com:443 HTTP/1.1
Host: feelinsonice.appspot.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;‚Äúfeelinsonice‚Äù.  Snapchat are hosted on GAE!&lt;/p&gt;

&lt;p&gt;Having confirmed confirmed that this is a worthwhile approach, I wrote a little
Ruby to receive requests and start coaxing data from Snapchat.  The first
iteration was something like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env ruby&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;openssl&apos;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;socket&apos;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TCPServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5588&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;accept&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;readpartial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8192&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!~&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/CONNECT feelinsonice.appspot.com:443/&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;rejecting unwanted client &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;next&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;probably good client &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSLContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SSLv23_server&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cert&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;X509&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Certificate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;server.crt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;PKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;RSA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;server.key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;verify_mode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;VERIFY_NONE&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;HTTP/1.1 200 OK&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;flush&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSLSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;accept&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;I THINK WE&apos;RE IN, JOHN.&quot;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;readpartial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8192&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;got data: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To go with, I generated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server.crt&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server.key&lt;/code&gt; with CN &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*.appspot.com&lt;/code&gt;,
wondering if Snapchat are checking for a valid cert or not.&lt;/p&gt;

&lt;p&gt;Turns out they are: I was getting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EOFError&lt;/code&gt; thrown at the last &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;readpartial&lt;/code&gt;
call, so presumably that was Snapchat not liking my identity.&lt;/p&gt;

&lt;p&gt;Thankfully, the workaround wasn‚Äôt hard: make a local CA, install its
certificate on the phone, re-generate the SSL certificate with that
CA&lt;sup id=&quot;fnref:ssl-ca&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:ssl-ca&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;, and away we go!&lt;/p&gt;

&lt;p&gt;Next, capture the data from the phone, and establish the connection to Snapchat
ourselves to complete this man-in-the-middle. We put this after reading the
first block of data from the client above:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# make the real connection&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TCPSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;feelinsonice.appspot.com&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Errno&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ECONNREFUSED&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;snapchat getting weary?&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;next&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ups&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SSLSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;up&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ups&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connect&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ups&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;forwarded request from phone&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ups&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;readpartial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;EOFError&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;no more&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;they say: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# send back to phone&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  
  &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;written back&quot;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;zero?&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;quiet&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We open a regular SSL socket to Snapchat‚Äôs GAE server, forward the request from
the phone, and read back what Snapchat said.&lt;/p&gt;

&lt;p&gt;It turns out this is enough to start getting sensitive data in a form where we
can attack it offline&lt;sup id=&quot;fnref:http&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:http&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Add some logging of responses to file; you‚Äôll see a request to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/ph/sync&lt;/code&gt;,
followed by a bulk of data indicating who our friends are, and information
regarding new snaps.  Then, the phone will try to fetch those snaps: you‚Äôll see
requests to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/ph/blob&lt;/code&gt;, like:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/ph/blob?id=...&amp;amp;username=hellomoto&amp;amp;timestamp=1368171438418&amp;amp;req_token=...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It turns out all the data required is in the URI; no funny header business.
You can paste the requested URL directly into a browser and fetch the blob.&lt;/p&gt;

&lt;p&gt;What you get is identified by the BSD file tool as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt; ‚Äì not obviously an
image, video, or whatever, nor any headers indicating encryption or
compression.&lt;/p&gt;

&lt;p&gt;First, I had a look at the size: 19,712 bytes, which is divisible by 256.  This
feels like too much of a coincidence; I‚Äôd be surprised by divisibility by
anything above 4 or 8.  My going assumption is that images are transferred in
JPEG, and ~half the JPEGs I looked at on my disk have odd numbers of bytes, so
I‚Äôm guessing there‚Äôs nothing frame-y about JPEG that would cause the plaintext
to be in a regular block of bytes ‚Äì so conclusion, it‚Äôs probably a block
cipher.&lt;/p&gt;

&lt;p&gt;Next, it was time to see if there were any obvious cryptographic errors.  A
repeated block in the ciphertext might give us a hint about the encryption
mode.&lt;/p&gt;

&lt;p&gt;Sure enough, a repeated 16-byte block:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;r:ASCII-8BIT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1232&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2464&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2462&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1232&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1231&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So apparently a 16-byte (128-bit) block cipher, in &lt;a href=&quot;http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_codebook_.28ECB.29&quot;&gt;ECB
mode&lt;/a&gt;
at that.  (Not a good thing.)   Seeing as there wasn‚Äôt a demonstration of a lot
of intelligence this far, I started to wonder if it wasn‚Äôt just XORed, as it‚Äôd
look the same.&lt;/p&gt;

&lt;p&gt;A &lt;a href=&quot;https://twitter.com/kyhwana/status/332770066150068227&quot;&gt;friend on Twitter
noted&lt;/a&gt; that the repeated
block was at the same location as JPEG files have a string of repeated bytes.&lt;/p&gt;

&lt;p&gt;Here‚Äôs a JPEG surrounding the repeated bytes:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000a0: 090c 0b0c 180d 0d18 3221 1c21 3232 3232  ........2!.!2222
00000b0: 3232 3232 3232 3232 3232 3232 3232 3232  2222222222222222
00000c0: 3232 3232 3232 3232 3232 3232 3232 3232  2222222222222222
00000d0: 3232 3232 3232 3232 3232 3232 3232 ffc0  22222222222222..
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here‚Äôs the ciphertext around the repeated 16-byte blocks:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000060: 61e0 3cb3 ca5d 4ebe 4cd9 2212 3e9a 40ba  a.&amp;lt;..]N.L.&quot;.&amp;gt;.@.
0000070: 39e4 8dc2 ac39 8f10 59d8 fc08 9d19 b239  9....9..Y......9
0000080: 39e4 8dc2 ac39 8f10 59d8 fc08 9d19 b239  9....9..Y......9
0000090: 4614 4d69 7c61 5d11 cabb 5310 1697 5b4f  F.Mi|a]...S...[O
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;32&lt;/code&gt; bytes are more than 2x 16-byte blocks in length: they extend
well before and after the 16-byte alignment.  But the ciphertext doesn‚Äôt show
that at all: this rules out a plain repeating XOR, as we‚Äôd otherwise expect to
see something more like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000060: 61e0 3cb3 ca5d 4ebe 4cd9 2212 9d19 b239  a.&amp;lt;..]N.L.&quot;....9
0000070: 39e4 8dc2 ac39 8f10 59d8 fc08 9d19 b239  9....9..Y......9
0000080: 39e4 8dc2 ac39 8f10 59d8 fc08 9d19 b239  9....9..Y......9
0000090: 39e4 8dc2 ac39 8f10 59d8 fc08 9d19 5b4f  9....9..Y.....[O
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;‚Ä¶ assuming the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;32&lt;/code&gt; bytes above are exactly the number you‚Äôd expect to find
anywhere, which isn‚Äôt the case; but you get the point: there‚Äôd be some, but
there are none.  The key and data are totally mixed, which suggests a real
block cipher.&lt;/p&gt;

&lt;p&gt;Since there aren‚Äôt really good ways to attack this directly (at least, not for
me, an utter novice), it seemed much faster just look for the cipher/key/etc.
in the source.&lt;/p&gt;

&lt;p&gt;I was thinking I‚Äôd have to do some MitM of Google Play or root my Android, but
it turns out Googling ‚Äòsnapchat apk download‚Äô is enough. Hah.&lt;/p&gt;

&lt;p&gt;The first tool I found for getting the contents and decompiling the APK was
&lt;a href=&quot;http://code.google.com/p/android-apktool/&quot;&gt;android-apktool&lt;/a&gt;; there are surely
better tools (this gives you smali output, not Java or Java-ish), but it was
easy enough to peruse, given I just wanted to know what the key was and what
primitives were being used.&lt;/p&gt;

&lt;p&gt;The code was totally unobfuscated, so it wasn‚Äôt hard to find the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.snapchat.android.api.SnapchatServer&lt;/code&gt;: the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.smali&lt;/code&gt; file is a bit weird to
read, but sure enough there‚Äôs:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.field private static final BASE_URL:Ljava/lang/String; =
        &quot;https://feelinsonice.appspot.com&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.line 247
.local v2, image:[B
sget-object v6, Lcom/snapchat/android/util/AESEncrypt;-&amp;gt;ENCRYPT_KEY_2:Ljava/lang/String;

invoke-static {v2, v6},
        Lcom/snapchat/android/util/AESEncrypt;-&amp;gt;encrypt([BLjava/lang/String;)[B

move-result-object v0

.line 248
.local v0, encryptedImage:[B
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess that‚Äôd be like:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// byte[] image;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encryptedImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AESEncrypt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AESEncrypt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ENCRYPT_KEY_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;or something.  I don‚Äôt actually do Java, so maybe that‚Äôs all backwards, but the
point seems pretty clear.  It occurs to me I‚Äôm reading the encryption code, but
while there are two keys, only ENCRYPT_KEY_2 is ever used.&lt;/p&gt;

&lt;p&gt;So, what encryption is going on?  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AESEncrypt.smali&lt;/code&gt; reads:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.line 8
const-string v0, &quot;1234567891123456&quot;

sput-object v0, Lcom/snapchat/android/util/AESEncrypt;-&amp;gt;ENCRYPT_KEY:Ljava/lang/String;

.line 9
const-string v0, &quot;M02cnQ51Ji97vwT4&quot;

sput-object v0, Lcom/snapchat/android/util/AESEncrypt;-&amp;gt;ENCRYPT_KEY_2:Ljava/lang/S
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here are the keys!  Is it really as simple as 128-bit AES in ECB mode?&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.line 21
const-string v3, &quot;AES/ECB/PKCS5Padding&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like it.  Note the padding scheme; seems weird to use PKCS#5 which has
apparently ‚Äúonly been defined for block ciphers that use 64 bit (8 byte) block
size‚Äù, when the size here is 128-bit.  Let‚Äôs give it a go.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;r:ASCII-8BIT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OpenSSL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;AES-128-ECB&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;OpenSSL::Cipher:0x007f8182658618&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;OpenSSL::Cipher:0x007f8182658618&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;M02cnQ51Ji97vwT4&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;M02cnQ51Ji97vwT4&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;force_encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;ASCII-8BIT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_slice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:chr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;final&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xFF\xD8\xFF\xE0\0\x10&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;JFIF&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0\x01\x01\0\0\x01\0\x01\0\0\xFF\xDB\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0\x14\x0E&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;\
x0F&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x12\x0F\r\x14\x12\x10\x12\x17\x15\x14\x18\x1E&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;2!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x1E\x1C\x1C\x1E&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;=,.$2I@LKG@FE
PZ&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;JFIF! Hello! We got our man.&lt;/p&gt;

&lt;p&gt;&lt;img style=&quot;border: 1px solid #000; margin: 0px auto; display: block;&quot; title=&quot;Thanks, @lapscallion.&quot; src=&quot;/assets/post-img/snapchat.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That‚Äôs as far as I got; it was at this stage that I thought of Googling the
encryption key, to see if anyone else had tried this.
&lt;a href=&quot;http://adamcaudill.com/2012/12/31/revisiting-snapchat-api-and-security/&quot;&gt;Seems&lt;/a&gt;
&lt;a href=&quot;https://github.com/tlack/snaphax&quot;&gt;they&lt;/a&gt;
&lt;a href=&quot;https://gist.github.com/NeilHanlon/4686779&quot;&gt;had&lt;/a&gt;.  Still, I‚Äôm glad it wasn‚Äôt
until here that I searched.&lt;/p&gt;

&lt;p&gt;Many thanks to the &lt;a href=&quot;http://www.matasano.com/articles/crypto-challenges/&quot;&gt;Matasano crypto
challenges&lt;/a&gt; ‚Äì some of the
above came from knowledge picked up doing them.&lt;/p&gt;

&lt;p&gt;The conclusion is that it‚Äôs easy to intercept and decrypt the data Snapchat on
your phone receives; it‚Äôd be one, maybe two hours of work to turn the above
code into something I could just switch on and forget about, while it happily
archives every Snapchat I ever receive.&lt;/p&gt;

&lt;p&gt;Truth be told, I can‚Äôt be bothered ‚Äì it‚Äôs fun, and I don‚Äôt want to ruin the
unique feeling it has by virtue of being an ephemeral medium ‚Äì but don‚Äôt think
it‚Äôs hard for someone who cared enough to.&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:flurry&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;To &lt;a href=&quot;http://www.flurry.com/&quot;&gt;Flurry&lt;/a&gt;, a mobile analytics company, containing data like my phone model, screen res, probably some unique ID ‚Ä¶¬†&lt;a href=&quot;#fnref:flurry&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:ssl-ca&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;I used &lt;a href=&quot;http://www.freebsdmadeeasy.com/tutorials/freebsd/create-a-ca-with-openssl.php&quot;&gt;this guide&lt;/a&gt;, but there are better ones out there which are probably more explanatory.¬†&lt;a href=&quot;#fnref:ssl-ca&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:http&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Note that this client doesn‚Äôt speak HTTP; accordingly, it doesn‚Äôt know when to close the connection (GAE‚Äôs HTTP server sends the responses with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Length&lt;/code&gt;, so we should parse that and know when we‚Äôve received all the data, but it‚Äôs easier just to restart the server over and over at this stage).¬†&lt;a href=&quot;#fnref:http&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 
 <entry>
   <title>Escapology: how, when and why to encode and escape</title>
   <updated>2012-04-18T21:10:00+10:00</updated>
   <id>https://kivikakk.ee/2012/04/18/escapology</id>
    
     <link href="https://kivikakk.ee/2012/04/18/escapology/"/>
     <content type="html">&lt;p&gt;As programmers, we spend a lot of time just carting data from one place to
another.  Sometimes that‚Äôs the entire purpose of a program or library (data
conversion whatevers), but more often it‚Äôs just something that needs to happen
in the course of getting a certain task done.  When we‚Äôre sending a request,
using a library, executing templates or whatever, it‚Äôs important to be 100%
clear on the format of the data, which is a fancy way of saying how the data is
encoded.&lt;/p&gt;

&lt;p&gt;Let‚Äôs do the tacky dictionary thing:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://en.wiktionary.org/wiki/encoding&quot;&gt;encoding&lt;/a&gt;&lt;/strong&gt; (&lt;em&gt;plural&lt;/em&gt; encodings)&lt;/p&gt;

  &lt;ol&gt;
    &lt;li&gt;
      &lt;p&gt;(computing) The way in which symbols are mapped onto bytes, e.g. in the
rendering of a particular font, or in the mapping from keyboard input into
visual text.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;A conversion of plain text into a code or cypher form (for decoding by the
recipient).&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;I think these senses are a bit too specific‚Äîif your data is in a computer in
any form, then it‚Äôs already encoded.  The keyboard doesn‚Äôt even have to come
into it.&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr /&gt;

&lt;p&gt;If you‚Äôre like me and you come from an English-speaking country, there‚Äôs a good
chance that this might seem farfetched, or totally obvious but lacking in
depth.  The letter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&lt;/code&gt; is represented in ASCII by the integer 65, or hex &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;41&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;From hereon, if I refer to a number with regular formatting, it‚Äôs decimal
unless specified otherwise; likewise with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;code&lt;/code&gt; formatting, it‚Äôs hexadecimal.&lt;/p&gt;

&lt;p&gt;You are also probably aware that non-Latin characters like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã&lt;/code&gt; do not have any
mapping in ASCII, that people all tried to make their own ways to get around
this‚Äînone of which interoperated particularly well‚Äîand that at some stage,
a bunch of smart people decided to create Unicode, which assigns a unique
integer codepoint to every character of every language (and then some), such
that the character just mentioned is &lt;a id=&quot;604b&quot;&gt;&lt;/a&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+604b&lt;/code&gt;, and that there are character
encodings, like UTF-8, which are used to represent the codepoints in a
bytestream, such that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã&lt;/code&gt; becomes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e6 81 8b&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This is all well and good.  But what do you do with this stuff in your program?&lt;/p&gt;

&lt;p&gt;Firstly, we need to straighten out what your environment does, or doesn‚Äôt do,
with character encodings.  I‚Äôm going to use PHP, Erlang and HTML as my
examples, because they‚Äôre things I work with at work, and they each have
slightly different ways of dealing with encoding &lt;sup id=&quot;fnref:php-silly&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:php-silly&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; owing to their
internal representation of strings.&lt;/p&gt;

&lt;p&gt;Secondly, I‚Äôm going to expand this beyond character encodings to &lt;strong&gt;any
encoding&lt;/strong&gt;‚Äîwhich is ultimately what I want to talk about here.  We‚Äôre not
just encoding the textual content for decoding into codepoints; we‚Äôre also
often encoding data to put it within other data in a demarcated way.  In this
case, we tend to refer to &lt;strong&gt;escaping&lt;/strong&gt;, but escaping and encoding are different
ways of talking about the same &lt;em&gt;process&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;php&quot;&gt;PHP&lt;/h2&gt;

&lt;p&gt;The best way to describe PHP‚Äôs character encoding is with the words ‚Äúnot at
all‚Äù.  Strings do not have metadata associated with encoding; to all string
manipulation functions, a string might as well be an array of bytes,
representing the raw bytes from the disk that occured between two ASCII &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt;
(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt;) characters.&lt;/p&gt;

&lt;p&gt;In other words, PHP treats the input PHP file as byte soup‚Äînominally ASCII.&lt;/p&gt;

&lt;p&gt;Say I want to store &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã„ÅØÊà¶‰∫â&lt;/code&gt; &lt;sup id=&quot;fnref:love-is-war&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:love-is-war&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; in a string in PHP.  I boot up my
editor, open a new file called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;koi.php&lt;/code&gt; and enter:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ÊÅã„ÅØÊà¶‰∫â&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;What do I get?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-utf8.png&quot; alt=&quot;The text &amp;quot;ÊÅã„ÅØÊà¶‰∫â&amp;quot; displays correctly in my
browser.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hey, the text displays correctly!  PHP must be super-smart and it‚Äôs doing
everything right!  Right?&lt;/p&gt;

&lt;p&gt;Maybe.  My text-editor decided to save the file in UTF-8 by default.  If I was
in Japan and I dealt mostly with Japanese, it could be that I tended to save
files in some popular non-Unicode encodings, like
&lt;a href=&quot;http://en.wikipedia.org/wiki/Shift_JIS&quot;&gt;Shift JIS&lt;/a&gt; or
&lt;a href=&quot;http://en.wikipedia.org/wiki/ISO-2022-JP&quot;&gt;ISO-2022-JP&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;What happens if I resave the file in Shift JIS?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-sjis.png&quot; alt=&quot;Non-descript characters appear instead.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Mojibake&quot;&gt;Mojibake!&lt;/a&gt;&lt;/em&gt;  Character encoding issues
are so common, Japanese has a word for it.&lt;/p&gt;

&lt;p&gt;What happened?  PHP actually has no idea about what the text is, encoding,
whatever.  When it looks at the file, it sees this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000000: 3c3f 0a0a 246b 6f69 203d 2022 97f6 82cd  &amp;lt;?..$koi = &quot;....
0000010: 90ed 9188 223b 0a0a 6563 686f 2024 6b6f  ....&quot;;..echo $ko
0000020: 693b 0a0a 3f3e 0a                        i;..?&amp;gt;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that we have a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt; at byte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0b&lt;/code&gt;, indicating the start of a string, and
then another &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt; at byte &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;14&lt;/code&gt;.  I‚Äôm contending that the bytes between‚Äîi.e.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;97 f6 82 cd 90 ed 91 88&lt;/code&gt;‚Äîare what gets stored in the string, without any
further knowledge.&lt;/p&gt;

&lt;p&gt;If this were the case, then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strlen($koi)&lt;/code&gt; should be equal to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;8&lt;/code&gt; (despite
there being &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt; Japanese characters).  I modify &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;koi.php&lt;/code&gt;, still in Shift JIS:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ÊÅã„ÅØÊà¶‰∫â&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And now?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-sjislen.png&quot; alt=&quot;The number 8 prefaces the mojibake.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;a href=&quot;http://patrickmccoy.typepad.com/lost_in_translation/2006/02/yappari_thats_r_1.html&quot;&gt;Yappari&lt;/a&gt;&lt;/em&gt;.
PHP has &lt;em&gt;no clue&lt;/em&gt; what encoding the string is in‚Äîit‚Äôs just saving those
bytes, counting them, and throwing them back out.  So why does the UTF-8 one
look alright in the browser and the Shift JIS one doesn‚Äôt?&lt;/p&gt;

&lt;p&gt;The first tripping point is the webserver; the Apache on the machine I‚Äôm
testing has this directive in a conffile:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AddDefaultCharset UTF-8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sure enough, when we take a look at the headers sent on the wire:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Wed, 18 Apr 2012 04:17:51 GMT
Server: Apache/2.2.11 (Fedora)
X-Powered-By: PHP/5.2.9
Content-Length: 14
Connection: close
Content-Type: text/html; charset=UTF-8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the browser is trying to read the Shift JIS as UTF-8, hence mojibake.  We
can force that by adding an appropriate &lt;a href=&quot;http://php.net/header&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;header()&lt;/code&gt;&lt;/a&gt;
call, but it goes to show that PHP isn‚Äôt cognisant of what‚Äôs going on here.&lt;/p&gt;

&lt;p&gt;Another grand example is using other built-in string functions.
&lt;a href=&quot;http://php.net/str_replace&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;str_replace()&lt;/code&gt;&lt;/a&gt; and
&lt;a href=&quot;http://php.net/substr&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;substr()&lt;/code&gt;&lt;/a&gt; are fraught with difficulty, no matter what
encoding you use.&lt;/p&gt;

&lt;p&gt;We haven‚Äôt even hit the fun stuff yet.  What happens if we use another popular
Japanese encoding, ISO-2022-JP?  ISO-2022, also known as ECMA-35, is a standard
for mechanisms for encoding foreign language text, and is used for Japanese in
ISO-2022-JP, Chinese in ISO-2022-CN, and more, including extensions of the
same.&lt;/p&gt;

&lt;p&gt;Being a more complicated system, it fails to make some guarantees about the
encoded data which other encodings do make; Shift JIS, for instance, &lt;a href=&quot;http://en.wikipedia.org/wiki/Shift_JIS#Shift_JIS_byte_map&quot;&gt;does not use common ASCII special characters in its second byte&lt;/a&gt;,
such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt;.  This means a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; symbol in Shift JIS-encoded text always means a
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt;, whereas the letter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&lt;/code&gt; could occur as either a literal &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&lt;/code&gt;, or as the
second byte in a double-byte character &lt;sup id=&quot;fnref:mb-encoding&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:mb-encoding&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Keeping in mind that ISO-2022-JP doesn‚Äôt exercise such care, let‚Äôs see what we
get ‚Ä¶&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-iso2022jp.png&quot; alt=&quot;We get a few &amp;quot;undefined variable&amp;quot; PHP
warnings.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Uhhhh.  What‚Äôs stored on the disk?&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000000: 3c3f 0a0a 246b 6f69 203d 2022 1b24 424e  &amp;lt;?..$koi = &quot;.$BN
0000010: 7824 4f40 6f41 681b 2842 223b 0a0a 6563  x$O@oAh.(B&quot;;..ec
0000020: 686f 2073 7472 6c65 6e28 246b 6f69 2920  ho strlen($koi) 
0000030: 2e20 223c 6272 3e5c 6e22 3b0a 6563 686f  . &quot;&amp;lt;br&amp;gt;\n&quot;;.echo
0000040: 2024 6b6f 693b 0a0a 3f3e 0a               $koi;..?&amp;gt;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ISO-2022-JP encoding of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã„ÅØÊà¶‰∫â&lt;/code&gt; contains the byte-sequence &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;24 42 4e 78
24 4f&lt;/code&gt;, which is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$BNx$O&lt;/code&gt; in ASCII‚Äîso PHP tries to interpolate variables so
named.&lt;/p&gt;

&lt;p&gt;Of course, this means even scarier things are possible.  I replaced &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã„ÅØÊà¶‰∫â&lt;/code&gt;
with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;„ÅÇ&lt;/code&gt;‚Äîthe Japanese letter ‚Äúa‚Äù, essentially‚Äîand we get:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/a-iso2022jp.png&quot; alt=&quot;A warning and a parse error.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Whoops!  On the disk:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000000: 3c3f 0a0a 246b 6f69 203d 2022 1b24 4224  &amp;lt;?..$koi = &quot;.$B$
0000010: 221b 2842 223b 0a0a 6563 686f 2073 7472  &quot;.(B&quot;;..echo str
0000020: 6c65 6e28 246b 6f69 2920 2e20 223c 6272  len($koi) . &quot;&amp;lt;br
0000030: 3e5c 6e22 3b0a 6563 686f 2024 6b6f 693b  &amp;gt;\n&quot;;.echo $koi;
0000040: 0a0a 3f3e 0a                             ..?&amp;gt;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;„ÅÇ&lt;/code&gt; encodes as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1b 24 42 24 22 1b 28 42&lt;/code&gt;.  Those playing at home will notice a
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt;‚Äîi.e. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt;‚Äîis stuck in the middle, so PHP thinks you‚Äôve prematurely
terminated the string.&lt;/p&gt;

&lt;p&gt;The solution is to encode your source files as UTF-8, because UTF-8 guarantees
that all ASCII characters‚Äîthat is, values &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00&lt;/code&gt; through &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;7f&lt;/code&gt;‚Äîare both mapped
to the same byte in UTF-8, &lt;em&gt;and&lt;/em&gt; that those bytes will not occur in a UTF-8
stream as part of any other character.  UTF-8 is &lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-8#Description&quot;&gt;marvelously
well-designed&lt;/a&gt; (actually).&lt;/p&gt;

&lt;p&gt;This means that PHP won‚Äôt do anything funny with your strings, though it still
treats it like a bag of bytes.  Next, use only the &lt;a href=&quot;http://php.net/manual/en/book.mbstring.php&quot;&gt;multibyte string extension&lt;/a&gt;
to do string operations.  For instance, let‚Äôs revert back to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã„ÅØÊà¶‰∫â&lt;/code&gt;
example in UTF-8, and use &lt;a href=&quot;http://php.net/mb_strlen&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mb_strlen()&lt;/code&gt;&lt;/a&gt; instead of
the plain variety:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ÊÅã„ÅØÊà¶‰∫â&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mb_strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And we see:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-utf8len.png&quot; alt=&quot;12!?&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Whoops.  That‚Äôs raw bytes again!  The multibyte module has no idea what
encoding to use, so if we don‚Äôt tell it, it behaves as usefully as
&lt;a href=&quot;http://php.net/strlen&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strlen()&lt;/code&gt;&lt;/a&gt;. We have to tell it, and in a very PHP-like
manner, we set a &lt;strong&gt;global&lt;/strong&gt; state for the interpreter.  Great.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;mb_internal_encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ÊÅã„ÅØÊà¶‰∫â&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mb_strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br&amp;gt;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$koi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And finally:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-utf8lenmb.png&quot; alt=&quot;The number 4. Hallelujah.&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Onto saner pastures.&lt;/p&gt;

&lt;h2 id=&quot;erlang&quot;&gt;Erlang&lt;/h2&gt;

&lt;p&gt;Erlang is a funny language.  &lt;a href=&quot;http://learnyousomeerlang.com/starting-out-for-real#lists&quot;&gt;It doesn‚Äôt even &lt;em&gt;have&lt;/em&gt;
strings&lt;/a&gt;&lt;sup id=&quot;fnref:inconvenient-truth&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:inconvenient-truth&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;.
Instead, a string is a list of numbers; the REPL guesses that a list should be
pretty-printed as a string if they all look like printable ASCII:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-erlang&quot; data-lang=&quot;erlang&quot;&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Hello.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;Hello.&quot;&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;108&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;46&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;Hello.&quot;&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;lol!  Gnarly!  But seriously, this accidentally becomes great when you start
Unicoding it up like you‚Äôre part of the UN:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-erlang&quot; data-lang=&quot;erlang&quot;&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ÊÅã„ÅØÊà¶‰∫â&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24651&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12399&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;25126&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20105&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Huh!?  Well, they‚Äôre not printable ASCII, so what &lt;em&gt;are&lt;/em&gt; they?  Let‚Äôs translate
those pesky decimals into something humans can read:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-erlang&quot; data-lang=&quot;erlang&quot;&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;~4.16.0b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;604&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;306&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6226&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e89&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;604b&lt;/code&gt;?  &lt;a href=&quot;#604b&quot;&gt;Doesn‚Äôt that sound familiar?&lt;/a&gt;.  It‚Äôs actually interpreting
each Unicode &lt;em&gt;character&lt;/em&gt; (not each &lt;em&gt;byte&lt;/em&gt;) as its integer codepoint.  That
means all lovely things we want to assume hold true, like length calculation
and substrings:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-erlang&quot; data-lang=&quot;erlang&quot;&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;~ts&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;~n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;lists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sublist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]).&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;Êà¶‰∫â&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So Erlang provides a pretty good native data-type for storing Unicode
characters; pre-Unicode, we were just storing the numbers of ASCII characters
in a list, so now we just store the numbers of Unicode codepoints instead.&lt;/p&gt;

&lt;p&gt;Unfortunately, the simplicity of &lt;em&gt;entry&lt;/em&gt; does not extend to source files.
D‚Äôoh!  The Erlang manual specifies that source must be entered in
&lt;a href=&quot;http://en.wikipedia.org/wiki/ISO/IEC_8859-1&quot;&gt;ISO-8859-1&lt;/a&gt;, also known as
‚ÄúLatin-1‚Äù encoding.  Only the REPL is smart enough to do Unicode.  This is
detailed in &lt;a href=&quot;http://www.erlang.org/doc/apps/stdlib/unicode_usage.html#id62505&quot;&gt;the Erlang manual&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So you could consider that it‚Äôs difficult to get Unicode data &lt;em&gt;into&lt;/em&gt;
Erlang‚Äîin that you can‚Äôt enter it directly into the source‚Äîbut once you
have it, it‚Äôs much more straightforward to manange than with, say, PHP.  The
reality is, most Unicode data in your program will be coming from &lt;em&gt;without&lt;/em&gt;
your program, not within‚Äîi.e. user input, API call results, etc.‚Äîso this
isn‚Äôt as bad as it sounds.&lt;/p&gt;

&lt;p&gt;Erlang doesn‚Äôt store metadata about the encoding; it avoids the problem
entirely by letting strings represent Unicode natively.  Once you start sending
or receiving them on the wire, you‚Äôll usually want convert them to or from
binary strings with functions from the
&lt;a href=&quot;http://www.erlang.org/doc/man/unicode.html&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unicode&lt;/code&gt;&lt;/a&gt; module, which provides
helpers for various UTF encodings, and Latin-1.  Once so-converted, the data is
unambiguously opaque ‚Ä¶ compared with PHP‚Äôs ‚ÄúI don‚Äôt have a clue &lt;em&gt;what&lt;/em&gt; it is‚Äù.&lt;/p&gt;

&lt;h2 id=&quot;html&quot;&gt;HTML&lt;/h2&gt;

&lt;p&gt;This is a huge kludge.&lt;/p&gt;

&lt;p&gt;HTML itself contains a way to declare its own encoding, using a &lt;a href=&quot;http://en.wikipedia.org/wiki/Meta_element&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;meta&amp;gt;&lt;/code&gt; tag&lt;/a&gt;
to declare the &lt;a href=&quot;http://en.wikipedia.org/wiki/MIME#Content-Type&quot;&gt;Content-Type&lt;/a&gt;
of the document.  The issue, if you weren‚Äôt paying attention, is that reading
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;meta&amp;gt;&lt;/code&gt; tag implies you are able to make any sense of the document
whatsoever.  Valid HTML requires the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;meta&amp;gt;&lt;/code&gt; to appear within the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;head&amp;gt;&lt;/code&gt;,
i.e. for HTML 5:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This isn‚Äôt a problem with sane encodings, because they tend to map ASCII
through; but things like UTF-16 and above require the server to declare the
content-type in the HTTP headers; interpreting
&lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-32&quot;&gt;UTF-32&lt;/a&gt; as ASCII leads to madness.&lt;/p&gt;

&lt;p&gt;For comparison‚Äôs sake, the layout on disk of the above in UTF-8 (identical to
ASCII here):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 3c21 646f 6374 7970 6520 6874 6d6c 3e0a  &amp;lt;!doctype html&amp;gt;.
00000010: 3c68 746d 6c3e 0a3c 6865 6164 3e0a 2020  &amp;lt;html&amp;gt;.&amp;lt;head&amp;gt;.  
00000020: 3c6d 6574 6120 6368 6172 7365 743d 2275  &amp;lt;meta charset=&quot;u
00000030: 7466 2d38 223e 0a                        tf-8&quot;&amp;gt;.  ....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And in UTF-32:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 0000 003c 0000 0021 0000 0064 0000 006f  ...&amp;lt;...!...d...o
00000010: 0000 0063 0000 0074 0000 0079 0000 0070  ...c...t...y...p
00000020: 0000 0065 0000 0020 0000 0068 0000 0074  ...e... ...h...t
00000030: 0000 006d 0000 006c 0000 003e 0000 000a  ...m...l...&amp;gt;....
00000040: 0000 003c 0000 0068 0000 0074 0000 006d  ...&amp;lt;...h...t...m
00000050: 0000 006c 0000 003e 0000 000a 0000 003c  ...l...&amp;gt;.......&amp;lt;
00000060: 0000 0068 0000 0065 0000 0061 0000 0064  ...h...e...a...d
00000070: 0000 003e 0000 000a 0000 0020 0000 0020  ...&amp;gt;....... ... 
00000080: 0000 003c 0000 006d 0000 0065 0000 0074  ...&amp;lt;...m...e...t
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(it goes on like this)&lt;/p&gt;

&lt;p&gt;Triples of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NUL&lt;/code&gt;-bytes separating everything!  This is UTF-32‚Äôs grand plan to
support everything without variable-width encoding, meaning operations like
string length, slicing and substring matching could be done fairly
cheaply&lt;sup id=&quot;fnref:utf-32-clusterfuck&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:utf-32-clusterfuck&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;In these cases you should be ensuring the server sends the correct
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;, implying the server has a clue‚Äîand if you‚Äôre lucky, enough
users‚Äô browsers will guess.&lt;/p&gt;

&lt;p&gt;This could be considered a non-solution.&lt;/p&gt;

&lt;p&gt;The other thing HTML brings to the table, via SGML, is character entity
references, giving you the ability to &lt;a href=&quot;http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references&quot;&gt;refer to any Unicode character by
codepoint&lt;/a&gt;.
This doesn‚Äôt make for happy editing, but it does mean that HTML can &lt;em&gt;represent&lt;/em&gt;
arbitrary Unicode characters even when the HTML itself is ASCII, for instance.&lt;/p&gt;

&lt;h2 id=&quot;representing-unicode-characters&quot;&gt;Representing Unicode characters&lt;/h2&gt;

&lt;p&gt;This is an important concept.  In HTML, one can enter:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;ni&quot;&gt;&amp;amp;#x604b;&amp;amp;#x306f;&amp;amp;#x6226;&amp;amp;#x4e89;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And get this in their browser:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/post-img/koihasensou-utf8.png&quot; alt=&quot;The text &amp;quot;ÊÅã„ÅØÊà¶‰∫â&amp;quot;.&quot; /&gt;&lt;!-- Yes, I&apos;m reusing this
image. --&gt;&lt;/p&gt;

&lt;p&gt;This is without any other markup or declaration of encoding; we‚Äôre telling the
browser to render the characters by Unicode codepoint directly.  This is
equivalent to entering them into a list in Erlang source directly:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-erlang&quot; data-lang=&quot;erlang&quot;&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16#604b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16#306f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16#6226&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16#4e89&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It‚Äôs important to make clear a distinction here, however: HTML is &lt;em&gt;markup&lt;/em&gt;, and
Erlang is a &lt;em&gt;programming language&lt;/em&gt;.  HTML gives you an escape route to render a
given codepoint, which is good, but what we‚Äôre talking about when we talk about
Erlang is actually an &lt;strong&gt;internal representation&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This is what I‚Äôm more interested in, so I‚Äôll put HTML to the side for now.&lt;/p&gt;

&lt;p&gt;When data enters your Erlang program, it‚Äôs most likely going to be encoded in
some form; whichever service receives that data is responsible for making sense
of it.  Imagine you‚Äôre writing a webserver: people might submit forms in UTF-8,
UTF-16, Shift JIS, Latin-1, whatever.  No matter what you‚Äôre doing with that
data‚Äîyou might be spitting it right back in the response; hacking it up into
pieces; storing in a database, maybe for later hacking‚Äîyou need to normalise
the format of the data &lt;em&gt;while you still know what format it‚Äôs in&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;If you‚Äôre coding in PHP and you receive a string full of bits, if you throw
that into a database without noting the encoding
&lt;sup id=&quot;fnref:whose-encoding-is-it-anyway&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:whose-encoding-is-it-anyway&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;, you‚Äôve permanently lost the ability to say for
sure what the data actually is.&lt;/p&gt;

&lt;p&gt;The solution, then, is to normalise the data at the point of entry, once, and
to normalise it into an &lt;em&gt;internal format&lt;/em&gt; that makes sense.  In Erlang, you
might store a string as a codepoint list.  In PHP, you‚Äôve little option but to
normalise it to another encoding like UTF-8, and to decide that UTF-8 &lt;em&gt;is&lt;/em&gt; the
internal format for textual data.&lt;/p&gt;

&lt;h2 id=&quot;check-your-blindspots&quot;&gt;Check your blindspots&lt;/h2&gt;

&lt;p&gt;Do &lt;strong&gt;not&lt;/strong&gt; fall into the trap of saying ‚Äúwell, I know my users will only enter
Latin-1 data, which happens to be the default, so I‚Äôll just save that and print
that.‚Äù  Guess what?  That‚Äôs what most of Japan said when they decided to use
Shift JIS.  Except for those who used ISO-2022-JP.  Or EUC-JP.  Good luck to
most of these people when people from other countries start submitting data.&lt;/p&gt;

&lt;p&gt;If you won‚Äôt listen to me, listen to the experience of the top 25 Japanese
websites according to Alexa.  &lt;a href=&quot;http://www.webmasterworld.com/printerfriendlyv5.cgi?forum=32&amp;amp;discussion=3373673&amp;amp;serial=3376486&amp;amp;user=&quot;&gt;A forum post from
mid-2007&lt;/a&gt;
detailed 10 of them using UTF-8.  When I check the other 15, 8 have moved to
UTF-8, leaving 7 not using UTF-8.  3 of those are on Shift JIS because they‚Äôre
either tailored for the Japanese mobile market‚Äîwhich endemically tends to
only support Shift JIS (Japanese mobile phones are not like your mobile phones)
‚Äîor because they make heavy use of &lt;a href=&quot;http://en.wikipedia.org/wiki/Shift_JIS_art&quot;&gt;Shift_JIS
art&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Storing data authentically is something that, as programmers, we need to get
used to, and clobbering data that doesn‚Äôt conform to your expectation makes no
sense.&lt;/p&gt;

&lt;p&gt;When data comes in, store it in a normal form.  If you‚Äôre building a webservice
in a sane language or framework, it‚Äôs probable that the environment has done
this work for you.&lt;/p&gt;

&lt;h2 id=&quot;dont-escape-data&quot;&gt;Don‚Äôt escape data&lt;/h2&gt;

&lt;p&gt;The key is to strongly mark the boundaries of keeping data in one format and
another.  Strongly-typed languages can distinguish this at compile time and
stop mistakes, but that‚Äôs a rant for another day.&lt;/p&gt;

&lt;p&gt;I‚Äôm going to start talking about another encoding process, often referred to as
escaping.&lt;/p&gt;

&lt;p&gt;Pop-quiz: what‚Äôs wrong with this PHP?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Omitted: init.&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;mysql_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;INSERT INTO tblUsers VALUES (&apos;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$username&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&apos;, &apos;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&apos;)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A related question is ‚Äúwhat‚Äôs &lt;em&gt;not&lt;/em&gt; wrong with this PHP?‚Äù.  I can think of nine
separate issues with it &lt;sup id=&quot;fnref:php-issue-register&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:php-issue-register&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;, but let‚Äôs look at the obvious
one: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$username&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$password&lt;/code&gt; are inserted into the query unescaped.  Maybe.&lt;/p&gt;

&lt;p&gt;Unless you live under a rock, you‚Äôll recognise the &lt;a href=&quot;http://en.wikipedia.org/wiki/SQL_injection&quot;&gt;SQL injection attack&lt;/a&gt;,
also known as &lt;strong&gt;SQLi&lt;/strong&gt;.  The issue is because we‚Äôre substituting
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$username&lt;/code&gt;‚Äîwhich we should think of as user data‚Äîdirectly into the stream
of a MySQL command.  By doing so, we‚Äôre essentially saying that the user data
&lt;em&gt;is&lt;/em&gt; part of a MySQL command‚Äîbecause it is.  A user could enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&apos;); DROP TABLE tblUsers; --&lt;/code&gt;,
and because we failed to encode user data as user data (which really means
escaping here), it happens.&lt;/p&gt;

&lt;p&gt;So how do we ‚Äúencode‚Äù data?  The correct way is to let the layer of abstraction
handle that for you.  If you use &lt;a href=&quot;http://php.net/manual/en/book.pdo.php&quot;&gt;PDO&lt;/a&gt;,
and put the laundry list of issues with the above code aside, it looks like
this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Omitted: init, database connection in $db.&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$stmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;INSERT INTO tblUsers VALUES (:username, :password)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s1&quot;&gt;&apos;:username&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
	&lt;span class=&quot;s1&quot;&gt;&apos;:password&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We let PDO deal with constructing the query‚Äîbeing the most-informed part of
the system to deal with query parameter encoding.  If we do it ourselves, we‚Äôll
probably make a mistake.&lt;/p&gt;

&lt;p&gt;Note that &lt;strong&gt;we are &lt;em&gt;not&lt;/em&gt; escaping the data&lt;/strong&gt;‚Äîwe‚Äôre deciding that another part
of the system which knows how to do it should do it instead.  Knowing when
&lt;strong&gt;not&lt;/strong&gt; to escape is often just as important as knowing when &lt;strong&gt;to&lt;/strong&gt; escape.&lt;/p&gt;

&lt;h3 id=&quot;caveat&quot;&gt;Caveat&lt;/h3&gt;

&lt;p&gt;Q. When will the above go terribly wrong?&lt;/p&gt;

&lt;p&gt;A. &lt;a href=&quot;http://web.archive.org/web/20171002204939/http://php.net/manual/en/security.magicquotes.php&quot;&gt;When a deficient language tries to automate security&lt;/a&gt;,
and finds that‚Äôs actually not possible according to the definition of security.&lt;/p&gt;

&lt;p&gt;Hello, your database is now full of backslashes.  Unfortunately, magic quotes
is enabled at the level of the webserver, so if your host has it enabled, you
have to try to turn it off.  &lt;a href=&quot;http://web.archive.org/web/20210101040748/https://www.php.net/manual/en/security.magicquotes.disabling.php&quot;&gt;Look at that Example #2.  Mmmmmm.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do &lt;strong&gt;not&lt;/strong&gt; rely on broken auto-escaping.  Your code will become unportable (and
insecure) if you end up hosting the same stuff elsewhere where this process
does not take place.  It‚Äôs tantamount to assuming all data will come in encoded
in UTF-16 and being surprised when your application breaks at inopportune moments.&lt;/p&gt;

&lt;p&gt;(Edit 2021-02-18: I‚Äôve needed to put in archive links here, as this has been
thoroughly sweeped under the rug; deprecated in PHP 5.3 and removed in PHP 5.4.
Keep in mind you can still find PHP 4 webhosting if you search for it.)&lt;/p&gt;

&lt;h2 id=&quot;the-golden-rule&quot;&gt;The golden rule&lt;/h2&gt;

&lt;p&gt;So, what‚Äôs the guiding principle?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Data in your application should be &lt;em&gt;semantically pure&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;If this doesn‚Äôt make any sense to you, read it once more, and I‚Äôll explain.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Data in your application should be &lt;em&gt;semantically pure&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Let‚Äôs say you take a username as input in a web application.  When the client
makes the request and sends us this username, we receive it into a variable.
What does the variable contain, right from the start?  Is it the exact text
they entered?  Does it have quotes escaped?  Are characters like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;gt;&lt;/code&gt;
converted to HTML entities so we can output it back into the page if we need
to?&lt;/p&gt;

&lt;p&gt;No.  The variable contains the username.  &lt;em&gt;Nothing&lt;/em&gt; else.&lt;/p&gt;

&lt;p&gt;It is not escaped.  It has no special encoding &lt;strong&gt;other&lt;/strong&gt; than the normalisation
about textual data encoding we‚Äôve already discussed.  It is in &lt;em&gt;no way&lt;/em&gt; prepped
for output, because it is the &lt;em&gt;pure&lt;/em&gt; username.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;When&lt;/em&gt; we want to output it, we pass it to the presentation layer &lt;em&gt;pure&lt;/em&gt;, and
let the presentation layer apply as many post-processing layers of encoding as
is required for the context.  It will probably convert special characters to
entities if they could cause issues.  If it‚Äôs being put in a link URI it will
be URI encoded.  If it‚Äôs ending up in some server-side generated JavaScript it
may need to be escaped appropriately.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;When&lt;/em&gt; we want to do a match against the database, we pass it to the database
layer &lt;em&gt;pure&lt;/em&gt;, and let the database layer perform the correct escaping for the
context.&lt;/p&gt;

&lt;p&gt;Let‚Äôs say you take a user‚Äôs age as input in a web application.  You may have a
mind for UX, so you check that the field appears to contain a number.  Now,
before you start passing that variable around everywhere, what do you do?
&lt;strong&gt;You represent it internally as a number&lt;/strong&gt;.  You call
&lt;a href=&quot;http://php.net/intval&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;intval&lt;/code&gt;&lt;/a&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;list_to_integer/1&lt;/code&gt; and you &lt;strong&gt;let the
presentation layer decide what to do with a number&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Otherwise you‚Äôre going to leave yourself open for all sorts of trouble.&lt;/p&gt;

&lt;p&gt;The key is that the value is &lt;em&gt;semantically&lt;/em&gt; pure‚Äîit carries the meaning of
the value in the programming language as it does in your mind.  No extra
backslashes in your mind?  Make sure the application sees that too.  This is
why we add structs, classes, new types and so forth; to better model the
semantics of the values in the programming language.&lt;/p&gt;

&lt;h2 id=&quot;mvc&quot;&gt;MVC&lt;/h2&gt;

&lt;p&gt;The model is the purest part of the application.  You ask it for some value,
and it gives it to you, completely unadorned.  It‚Äôs the controller‚Äôs
responsibility to request data of the model, and to hand all requisite data so
gathered to the view; it‚Äôs ultimately the view‚Äôs responsibility to perform
encoding of data according to context.&lt;/p&gt;

&lt;p&gt;Similarly, when the controller receives request data, it should parse it into
semantically meaningful values, which are then passed back to the view and into
models as appropriate.&lt;/p&gt;

&lt;p&gt;If the view then, say, uses some of this data in a query string value, it URI
encodes it.  If it‚Äôs including the data on the page directly, it converts HTML
entities to avoid &lt;a href=&quot;http://en.wikipedia.org/wiki/Cross-site_scripting&quot;&gt;XSS&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;And so on.&lt;/p&gt;

&lt;h2 id=&quot;escape-data-unescape-data&quot;&gt;Escape data, unescape data&lt;/h2&gt;

&lt;p&gt;I hope this entry might have shown you some of the parallels between
character-set encoding and escaping; they are both forms of processing data
into different formats, and it‚Äôs nearly always a mistake to not know if this
form of processing has occurred yet on a given piece of data, anywhere in an
application.&lt;/p&gt;

&lt;p&gt;Repeating the process (double-escaping or double-encoding) &lt;em&gt;without intending
to&lt;/em&gt; means you‚Äôre actually talking about those bytes that represent the encoded
data &lt;em&gt;in&lt;/em&gt; the encoded data.  Without being sure of the state of your inputs,
this can happen easily, and the next time you type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ÊÅã„ÅØÊà¶‰∫â&lt;/code&gt;, you end up
seeing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;√¶&amp;lt;81&amp;gt;&amp;lt;8b&amp;gt;√£&amp;lt;81&amp;gt;¬Ø√¶&amp;lt;88&amp;gt;¬¶√§¬∫&amp;lt;89&amp;gt;&lt;/code&gt;‚Äîwhich is what happens if you interpret
the UTF-8 bytes of the string as a Latin-1 sequence&lt;sup id=&quot;fnref:encodeception&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:encodeception&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Here are some other actions analogous to encoding.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Shell escaping.&lt;/li&gt;
  &lt;li&gt;Wrapping in the jQuery object&lt;sup id=&quot;fnref:jquery-idempotency&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:jquery-idempotency&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;.&lt;/li&gt;
  &lt;li&gt;Quoting people in conversation.&lt;/li&gt;
  &lt;li&gt;Editor‚Äôs comments in a quote in a newspaper.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ultimately, it‚Äôs a matter of being certain about the &lt;em&gt;type&lt;/em&gt; of data you‚Äôre
handling, whereby type I mean anything relevant to parsing its semantic
content.  Both dynamically- and statically-typed languages are amenable to
annotating objects with metadata concerning the operations that have been
carried out with them.&lt;/p&gt;

&lt;p&gt;I‚Äôm also trying to point out that this is not restricted to programming
languages‚Äîit‚Äôs whenever you have different categories of things being spoken
of, or different levels of abstraction.&lt;/p&gt;

&lt;p&gt;Golang‚Äôs &lt;a href=&quot;http://golang.org/pkg/html/template/&quot;&gt;html/template package&lt;/a&gt;,
effectively performing the role of the view in MVC, does automatic encoding of
data that has come from the controller, depending on the context.  This is a
nifty feature, as it allows you to forget about escaping‚Äîso long as you are
passing it semantically pure data, of course.&lt;/p&gt;

&lt;p&gt;If you have the template &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;p&amp;gt;{{.}}&amp;lt;/p&amp;gt;&lt;/code&gt;, then data to be substituted at
dot will have HTML entities inserted automatically, preventing XSS attacks.
Similarly, with the template fragment 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;a href=&quot;/?action={{.}}&quot;&amp;gt;{{.}}&amp;lt;/a&amp;gt;&lt;/code&gt; dot‚Äôs content will be URI
encoded in the first instance and have HTML entities inserted in the second.&lt;/p&gt;

&lt;p&gt;As the package documentation explains:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This package assumes that template authors are trusted, that Execute‚Äôs data
parameter is not, and seeks to preserve the properties below in the face of
untrusted data:&lt;/p&gt;

  &lt;p&gt;Structure Preservation Property: ‚Äú‚Ä¶ when a template author writes an HTML
tag in a safe templating language, the browser will interpret the
corresponding portion of the output as a tag regardless of the values of
untrusted data, and similarly for other structures such as attribute
boundaries and JS and CSS string boundaries.‚Äù&lt;/p&gt;

  &lt;p&gt;Code Effect Property: ‚Äú‚Ä¶ only code specified by the template author should
run as a result of injecting the template output into a page and all code
specified by the template author should run as a result of the same.‚Äù&lt;/p&gt;

  &lt;p&gt;Least Surprise Property: ‚ÄúA developer (or code reviewer) familiar with HTML,
CSS, and JavaScript, who knows that contextual autoescaping happens should be
able to look at a {{.}} and correctly infer what sanitization happens.‚Äù&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This provides a lot of reassurances that we want‚Äîbut then if we &lt;em&gt;do&lt;/em&gt; have
some data in the controller that we &lt;em&gt;really&lt;/em&gt; want to be substituted in as HTML,
what‚Äôs a cute programmer such as yourself to do?&lt;/p&gt;

&lt;p&gt;The same package provides the
&lt;a href=&quot;http://golang.org/pkg/html/template/#HTML&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTML&lt;/code&gt; type&lt;/a&gt;
‚Äîactually, a synonym for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;string&lt;/code&gt;.  In Golang, type synonyms are different
types with respect to method sets‚Äîwe can‚Äôt use a method of one on another
(methods are not inherited)‚Äîand there is no implicit conversion between them.
Objects of different types (even where the types are synonyms) are completely
different, except that we can
&lt;a href=&quot;http://golang.org/ref/spec#Conversions&quot;&gt;convert between them&lt;/a&gt; as they have the
same &lt;a href=&quot;http://golang.org/ref/spec#Types&quot;&gt;underlying type&lt;/a&gt;.  This means that we
can take a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;string&lt;/code&gt; and turn it into a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTML&lt;/code&gt; with a simple conversion:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;c&quot;&gt;// x is of type string&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;lt;p&amp;gt;This is delicious!&amp;lt;/p&amp;gt;&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// y is of type HTML&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Passing an object of type HTML to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;html/template&lt;/code&gt; tells it that the escaping
required to sanitise HTML has already been done, and so in a context where such
escaping is necessary, the content will be included verbatim.  Of course, this
also implies you don‚Äôt let user input find its way into a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTML&lt;/code&gt;-typed object
without doing necessary encoding/normalisation yourself.  I refrain from using the word ‚Äúsanitisation‚Äù, as the term has plenty of bad connotations which I‚Äôm about to talk about.&lt;/p&gt;

&lt;p&gt;There are a range of other types for indicating that you‚Äôve taken on the
responsibility of validating the variable contents are safe for use in given
contexts, i.e. giving the developer an escape for getting some data in which
you know you don‚Äôt want re-encoded.  The important thing is that you‚Äôre
categorically stating that it‚Äôs so‚Äîno part of the system will assume it
otherwise.  It‚Äôs safe by default, but in a way that doesn‚Äôt compare to ‚Äúmagic
quotes‚Äù, because it‚Äôs happening at the view, right before output, not at data
entry, contaminating your entire application.&lt;/p&gt;

&lt;h2 id=&quot;for-the-love-of-all-that-is-good&quot;&gt;For the love of all that is good&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://coding.smashingmagazine.com/2011/01/11/keeping-web-users-safe-by-sanitizing-input-data/&quot;&gt;Don‚Äôt do this&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is an anti-pattern.  This is &lt;strong&gt;the&lt;/strong&gt; anti-pattern.  The author‚Äôs very
first suggestion is to tell you to set the server-wide configuration for PHP to
automatically do certain escaping on some variables.  The idea is that you can
now pretend that all your variables are ready to become a part of HTML
somewhere!&lt;/p&gt;

&lt;p&gt;Of course, if you insert these (safely) into the database, you‚Äôve just inserted
HTML-sanitised data into the database.  Your database is perfectly capable of
storing the text &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kivi &quot;owl&quot; kakk&lt;/code&gt;, but now you‚Äôve got a row with the value
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kivi &amp;amp;quot;owl&amp;amp;quot; kakk&lt;/code&gt;.  If you still think this is a good idea, you
should leave the classroom right now.&lt;/p&gt;

&lt;p&gt;You read this out of the database.  Maybe you want to know how many characters
long it is.  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strlen()&lt;/code&gt;?  26.  Never mind that the actual displayed string is
16 when shown in HTML.  Maybe you want to use this value in an API call to some
other webservice.  You wrap it in a few objects, maybe encode it to JSON.  Now
you have to remember to &lt;em&gt;decode&lt;/em&gt; the entities before you use it in non-HTML
contexts.  Though if you want to put it into HTML to be part of a URI, you have
to remember to decode it, then re-encode it with URI (component) encoding.  You
lose.&lt;/p&gt;

&lt;p&gt;If you treat data semantically to begin with, and only encode it as appropriate
for the output at the &lt;em&gt;time&lt;/em&gt; of output, we don‚Äôt have an issue.  Input
filtering is just a way to make sure you‚Äôll never really know what‚Äôs in a
variable.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Data in your application should &lt;em&gt;mean what it means&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;When data comes in, interpret its &lt;em&gt;meaning&lt;/em&gt; once, according to context.&lt;/p&gt;

&lt;p&gt;When data goes out, encode it &lt;em&gt;meaningfully&lt;/em&gt; according to context.&lt;/p&gt;

&lt;p&gt;This applies to charsets, escaping and more.&lt;/p&gt;

&lt;h2 id=&quot;postscript-php-strings&quot;&gt;Postscript: PHP strings&lt;/h2&gt;

&lt;p&gt;It‚Äôs interesting to note here that there is neither a PHP type which represents
a string with a given encoding‚Äî
&lt;a href=&quot;http://www.php.net/manual/en/language.types.string.php#language.types.string.details&quot;&gt;the PHP string is a byte-buffer&lt;/a&gt;
and no more‚Äînor a suitable sequence-like container for arbitrary codepoints;
you could follow the same approach that Erlang takes and store codepoints as
integers within arrays, but due to PHP‚Äôs impressive array
type&lt;sup id=&quot;fnref:array-what-array&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:array-what-array&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;, it would be incredibly inefficient.&lt;/p&gt;

&lt;p&gt;I‚Äôm also not finding any way to take an arbitrary list of codepoints (or a
single codepoint) and return it in a given encoding; the data is always assumed
to have come in as a string in some encoding.  Of course, you could take your
codepoints and convert them to UTF-8 yourself, and &lt;em&gt;then&lt;/em&gt; treat that with the
multibyte string module.  &lt;a href=&quot;http://stackoverflow.com/questions/1805802/php-convert-unicode-codepoint-to-utf-8&quot;&gt;This appears to not be
atypical&lt;/a&gt;.
Oh, PHP.&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:php-silly&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Hint: the way PHP does it is silly.  See the part on ‚ÄúText‚Äù in &lt;a href=&quot;http://me.veekun.com/blog/2012/04/09/php-a-fractal-of-bad-design/&quot;&gt;Eevee‚Äôs
blog post about
PHP&lt;/a&gt;.¬†&lt;a href=&quot;#fnref:php-silly&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:love-is-war&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Japanese &lt;em&gt;koi wa sensou&lt;/em&gt;, meaning &lt;a href=&quot;http://supercell.sc/koisen/&quot;&gt;‚Äúlove is war‚Äù&lt;/a&gt;.¬†&lt;a href=&quot;#fnref:love-is-war&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:mb-encoding&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;All encodings mentioned so far, except ASCII, are examples of
&lt;a href=&quot;http://en.wikipedia.org/wiki/Variable-width_encoding&quot;&gt;variable-width
encodings&lt;/a&gt;, or
&lt;em&gt;multibyte encodings&lt;/em&gt;.¬†&lt;a href=&quot;#fnref:mb-encoding&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:inconvenient-truth&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Well, there are binaries, but &lt;strong&gt;sshhhh&lt;/strong&gt;, I‚Äôm in the middle of pointmaking.¬†&lt;a href=&quot;#fnref:inconvenient-truth&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:utf-32-clusterfuck&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Of course, they shot themselves in all thirty-two of their feet when
English-language text in UTF-32 resembles UTF-16 so much that browsers
trying to auto-detect encoding when the server doesn‚Äôt declare it &lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-32#Non-use_in_HTML5&quot;&gt;detect
it as UTF-16&lt;/a&gt;, not to
mention endianness problems also found in UTF-16 and &lt;a href=&quot;http://en.wikipedia.org/wiki/Byte_order_mark&quot;&gt;the terrible kludges
to work around
them&lt;/a&gt;.&lt;/p&gt;

      &lt;p&gt;Given UTF-16 doesn‚Äôt solve any problem (well), and creates many, I find
myself wondering why they bothered.¬†&lt;a href=&quot;#fnref:utf-32-clusterfuck&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:whose-encoding-is-it-anyway&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;And how do you know the encoding?  You don‚Äôt.  The browser encodes it in
the &lt;em&gt;same encoding as it determined the page to be&lt;/em&gt;.  Think about what that
means for a bit.¬†&lt;a href=&quot;#fnref:whose-encoding-is-it-anyway&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:php-issue-register&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;ol&gt;
        &lt;li&gt;may need to check &lt;a href=&quot;http://php.net/get_magic_quotes_gpc&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get_magic_quotes_gpc()&lt;/code&gt;&lt;/a&gt; to know if data is encoded.&lt;/li&gt;
        &lt;li&gt;password stored unhashed.&lt;/li&gt;
        &lt;li&gt;we don‚Äôt specify a connection object.&lt;/li&gt;
        &lt;li&gt;we‚Äôre using an antique MySQL library.&lt;/li&gt;
        &lt;li&gt;inputs are unescaped (maybe‚Äîsee point 1).&lt;/li&gt;
        &lt;li&gt;escape inputs when you could use placeholders? Doing so successfully means ensuring data is &lt;em&gt;not&lt;/em&gt; escaped by now; see point 1.&lt;/li&gt;
        &lt;li&gt;specifying columns; inserted columns &lt;em&gt;may&lt;/em&gt; cause failure, or just data going in the wrong places.&lt;/li&gt;
        &lt;li&gt;use placeholders when you can use an ORM?&lt;/li&gt;
        &lt;li&gt;checking return value; because who cares about data integrity?&lt;/li&gt;
      &lt;/ol&gt;

      &lt;p&gt;This list itself is an example of poorly encoded data.  Note how it‚Äôs
inconsistent as to whether the items mentioned are the issues, or the fixes.¬†&lt;a href=&quot;#fnref:php-issue-register&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:encodeception&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Of course, note that these characters are of course embedded in &lt;em&gt;this&lt;/em&gt; document with UTF-8.¬†&lt;a href=&quot;#fnref:encodeception&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:jquery-idempotency&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;jQuery is special in that it‚Äôs never a mistake to rewrap in jQuery; the
jQuery wrapper function is idempotent.  This is because you can
unambiguously distinguish between an wrapped object and a not-wrapped
object; note that the same does not hold of arbitrary strings without
metadata attached to the string describing what encoding it should be.
Ruby‚Äôs strings, for instance, have no issues, as they carry knowledge of
their encoding.&lt;/p&gt;

      &lt;p&gt;A common practice is to prefix a variable name with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; if it‚Äôs known to
be wrapped in jQuery‚Äîbecause you‚Äôve guaranteed it at the point of naming
the variable, typically.  This is a way of making the assertion about the
encoding obvious. Because you can‚Äôt accidentally overwrap an object in
JavaScript, usually an absence of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; prefix implies no guarantee‚Äîit may
be wrapped or unwrapped, and the only way to guarantee e.g. a DOM object,
is by wrapping and then using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get&lt;/code&gt;.  The point is that you can never
mistakenly assume something to be jQuery wrapped when it isn‚Äôt; you‚Äôll
always know.¬†&lt;a href=&quot;#fnref:jquery-idempotency&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:array-what-array&quot; role=&quot;doc-endnote&quot;&gt;

      &lt;p&gt;Hint: there is none.  I know where you can get a hash-table-y kinda thing,
though.¬†&lt;a href=&quot;#fnref:array-what-array&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
    
 </entry>
 

</feed>
